<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html"><meta property="og:site_name" content="Ryan's Notebook"><meta property="og:title" content="5.CephX 认证机制"><meta property="og:description" content="Ceph使用cephx协议对客户端进行身份认证cephx用于对ceph保存的数据进行认证访问和授权，用于对访问ceph的请求进行认证和授权检测，与mon通信的请求都要经过ceph认证通过，但是也可以在mon节点关闭cephx认证，但是关闭认证之后任何访问都将被允许，因此无法保证数据的安全性, 5.1 授权流程 每个mon节点都可以对客户端进行身份认证并分发秘钥，因此多个mon节点就不存在单点故障和认证性能瓶颈。mon节点会返回用于身份认证的数据结构，其中包含获取ceph服务时用到的session key,session key通过客户端秘钥进行加密，秘钥是在客户端提前配置好的，/etc/ceph/ceph.client.admin.keyring"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-05-02T00:25:35.000Z"><meta property="article:tag" content="分布式存储"><meta property="article:published_time" content="2023-01-04T12:12:22.000Z"><meta property="article:modified_time" content="2023-05-02T00:25:35.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"5.CephX 认证机制","image":[""],"datePublished":"2023-01-04T12:12:22.000Z","dateModified":"2023-05-02T00:25:35.000Z","author":[]}</script><title>5.CephX 认证机制 | Ryan's Notebook</title><meta name="description" content="Ceph使用cephx协议对客户端进行身份认证cephx用于对ceph保存的数据进行认证访问和授权，用于对访问ceph的请求进行认证和授权检测，与mon通信的请求都要经过ceph认证通过，但是也可以在mon节点关闭cephx认证，但是关闭认证之后任何访问都将被允许，因此无法保证数据的安全性, 5.1 授权流程 每个mon节点都可以对客户端进行身份认证并分发秘钥，因此多个mon节点就不存在单点故障和认证性能瓶颈。mon节点会返回用于身份认证的数据结构，其中包含获取ceph服务时用到的session key,session key通过客户端秘钥进行加密，秘钥是在客户端提前配置好的，/etc/ceph/ceph.client.admin.keyring">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-e9ac4e0d.css" as="style"><link rel="stylesheet" href="/assets/style-e9ac4e0d.css">
    <link rel="modulepreload" href="/assets/app-982fbdc9.js"><link rel="modulepreload" href="/assets/framework-8eb1d601.js"><link rel="modulepreload" href="/assets/5. CephX认证机制.html-bfffc91b.js"><link rel="modulepreload" href="/assets/5. CephX认证机制.html-5d5be880.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Ryan&#39;s Notebook"><!----><span class="site-name hide-in-pad">Ryan&#39;s Notebook</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="濼鑫的知识库"><span class="font-icon icon iconfont icon-home" style=""></span>濼鑫的知识库<!----></a></div><div class="nav-item hide-in-mobile"><a href="/category/" class="nav-link" aria-label="归档🗂️"><span class="font-icon icon iconfont icon-beaker" style=""></span>归档🗂️<!----></a></div><div class="nav-item hide-in-mobile"><a href="/article/" class="nav-link" aria-label="文章🌱"><span class="font-icon icon iconfont icon-beaker" style=""></span>文章🌱<!----></a></div><div class="nav-item hide-in-mobile"><a href="/timeline/" class="nav-link" aria-label="时间线⏰"><span class="font-icon icon iconfont icon-beaker" style=""></span>时间线⏰<!----></a></div><div class="nav-item hide-in-mobile"><a href="/about/" class="nav-link" aria-label="关于🤷"><span class="font-icon icon iconfont icon-beaker" style=""></span>关于🤷<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="小记📌"><span class="title"><!---->小记📌</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>小记</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/xj/" class="nav-link" aria-label="一些知识的碎片🌠"><span class="font-icon icon iconfont icon-exercise" style=""></span>一些知识的碎片🌠<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>常用工具</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://imageresizer.com/" rel="noopener noreferrer" target="_blank" aria-label="图片压缩" class="nav-link"><span class="font-icon icon iconfont icon-more" style=""></span>图片压缩<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://www.flaticon.com/" rel="noopener noreferrer" target="_blank" aria-label="免费图标素材" class="nav-link"><span class="font-icon icon iconfont icon-more" style=""></span>免费图标素材<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://emojipedia.org/" rel="noopener noreferrer" target="_blank" aria-label="emojipedia" class="nav-link"><span class="font-icon icon iconfont icon-more" style=""></span>emojipedia<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/ryanxin7/xxlog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">搜索</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/ceph/" class="nav-link sidebar-link sidebar-page" aria-label="Ceph"><!---->Ceph<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading active"><!----><span class="title"></span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/ceph/log/1.Ceph%E7%AE%80%E4%BB%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="1.Ceph 简介"><!---->1.Ceph 简介<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ceph/log/3.Ceph-FS%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="3.Ceph-FS 文件存储"><!---->3.Ceph-FS 文件存储<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ceph/log/4.Ceph%E9%9B%86%E7%BE%A4%E7%BB%B4%E6%8A%A4.html" class="nav-link sidebar-link sidebar-page" aria-label="4.Ceph 集群维护"><!---->4.Ceph 集群维护<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="5.CephX 认证机制"><!---->5.CephX 认证机制<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-1-授权流程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.1 授权流程"><!---->5.1 授权流程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-2-访问流程" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2 访问流程"><!---->5.2 访问流程<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-3-ceph用户" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.3 ceph用户"><!---->5.3 ceph用户<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-3-1-列出指定用户信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.3.1 列出指定用户信息:"><!---->5.3.1 列出指定用户信息:<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-4-ceph授权和使能" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.4 ceph授权和使能"><!---->5.4 ceph授权和使能<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-ceph用户管理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.5 ceph用户管理"><!---->5.5 ceph用户管理<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-1-ceph-auth-add" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.5.1 ceph auth add"><!---->5.5.1 ceph auth add<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-2-ceph-auth-get-or-create" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.5.2 ceph auth get-or-create"><!---->5.5.2 ceph auth get-or-create<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-3-ceph-auth-get-or-create-key" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.5.3 ceph auth get-or-create-key"><!---->5.5.3 ceph auth get-or-create-key<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-4-ceph-auth-print-key" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.5.4  ceph auth print-key"><!---->5.5.4  ceph auth print-key<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-5-修改用户能力" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.5.5 修改用户能力"><!---->5.5.5 修改用户能力<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-6-删除用户" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.5.6 删除用户"><!---->5.5.6 删除用户<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-6-秘钥环管理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.6 秘钥环管理"><!---->5.6 秘钥环管理<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-6-1-通过秘钥环文件备份与恢复用户" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.6.1 通过秘钥环文件备份与恢复用户"><!---->5.6.1 通过秘钥环文件备份与恢复用户<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-6-2-从keyring文件恢复用户认证信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.6.2 从keyring文件恢复用户认证信息"><!---->5.6.2 从keyring文件恢复用户认证信息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-6-3-秘钥环文件添加多用户" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.6.3 秘钥环文件添加多用户"><!---->5.6.3 秘钥环文件添加多用户<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/ceph/log/6.%20Ceph-RBD%E4%BD%BF%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="6.Ceph RBD"><!---->6.Ceph RBD<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ceph/log/7.%20Ceph-FS%E4%BD%BF%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="7.Ceph FS"><!---->7.Ceph FS<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ceph/log/8.%20%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E7%BD%91%E5%85%B3RGW.html" class="nav-link sidebar-link sidebar-page" aria-label="8.RGW对象存储网关"><!---->8.RGW对象存储网关<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ceph/log/9.%20ceph-crush%E8%BF%9B%E9%98%B6.html" class="nav-link sidebar-link sidebar-page" aria-label="9.Ceph crush算法进阶"><!---->9.Ceph crush算法进阶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/ceph/log/10.%20ceph-dashboard%E5%8F%8A%E7%9B%91%E6%8E%A7.html" class="nav-link sidebar-link sidebar-page" aria-label="10.Ceph Dashboard及监控"><!---->10.Ceph Dashboard及监控<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->5.CephX 认证机制</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="http://ryanxin.live" target="_blank" rel="noopener noreferrer">Ryan</a></span><span property="author" content="Ryan"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-01-04T12:12:22.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 11 分钟</span><meta property="timeRequired" content="PT11M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category6 clickable" role="navigation">Ceph</span><meta property="articleSection" content="Ceph"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag7 clickable" role="navigation">分布式存储</span><meta property="keywords" content="分布式存储"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-1-授权流程" class="router-link-active router-link-exact-active toc-link level3">5.1 授权流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-2-访问流程" class="router-link-active router-link-exact-active toc-link level2">5.2 访问流程</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-3-ceph用户" class="router-link-active router-link-exact-active toc-link level2">5.3 ceph用户</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-3-1-列出指定用户信息" class="router-link-active router-link-exact-active toc-link level3">5.3.1 列出指定用户信息:</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-4-ceph授权和使能" class="router-link-active router-link-exact-active toc-link level2">5.4 ceph授权和使能</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-ceph用户管理" class="router-link-active router-link-exact-active toc-link level2">5.5 ceph用户管理</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-1-ceph-auth-add" class="router-link-active router-link-exact-active toc-link level3">5.5.1 ceph auth add</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-2-ceph-auth-get-or-create" class="router-link-active router-link-exact-active toc-link level3">5.5.2 ceph auth get-or-create</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-3-ceph-auth-get-or-create-key" class="router-link-active router-link-exact-active toc-link level3">5.5.3 ceph auth get-or-create-key</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-4-ceph-auth-print-key" class="router-link-active router-link-exact-active toc-link level3">5.5.4  ceph auth print-key</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-5-修改用户能力" class="router-link-active router-link-exact-active toc-link level3">5.5.5 修改用户能力</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-5-6-删除用户" class="router-link-active router-link-exact-active toc-link level3">5.5.6 删除用户</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-6-秘钥环管理" class="router-link-active router-link-exact-active toc-link level2">5.6 秘钥环管理</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-6-1-通过秘钥环文件备份与恢复用户" class="router-link-active router-link-exact-active toc-link level3">5.6.1 通过秘钥环文件备份与恢复用户</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-6-2-从keyring文件恢复用户认证信息" class="router-link-active router-link-exact-active toc-link level3">5.6.2 从keyring文件恢复用户认证信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/ceph/log/5.%20CephX%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6.html#_5-6-3-秘钥环文件添加多用户" class="router-link-active router-link-exact-active toc-link level3">5.6.3 秘钥环文件添加多用户</a></li><!----><!--]--></ul><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p><strong>Ceph使用cephx协议对客户端进行身份认证</strong><br>cephx用于对ceph保存的数据进行认证访问和授权，用于对访问ceph的请求进行认证和授权检测，与mon通信的请求都要经过ceph认证通过，但是也可以在mon节点关闭cephx认证，但是关闭认证之后任何访问都将被允许，因此无法保证数据的安全性,</p><h3 id="_5-1-授权流程" tabindex="-1"><a class="header-anchor" href="#_5-1-授权流程" aria-hidden="true">#</a> 5.1 授权流程</h3><p>每个mon节点都可以对客户端进行身份认证并分发秘钥，因此多个mon节点就不存在单点故障和认证性能瓶颈。<br>mon节点会返回用于身份认证的数据结构，其中包含获取ceph服务时用到的<strong>session key</strong>,<br><strong>session key</strong>通过客户端秘钥进行加密，秘钥是在客户端提前配置好的，<br><code>/etc/ceph/ceph.client.admin.keyring</code></p><p>客户端使用<strong>session key</strong>向mon请求所需要的服务，mon 向客户端提供一个tiket, 用于向实际处理数据的OSD等服务验证客户端身份，MON和OSD共享同一个secret,因此OSD会信任所有MON发放的tiket<br>tiket存在有效期</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>注意:<br>CephX身份验证功能仅限制在Ceph的各组件之间，不能扩展到其他非ceph组件<br>Ceph 只负责认证授权，不能解决数据传输的加密问题</p></div><figure><img src="http://cdn1.ryanxin.live/xxlog/1669880681089-7d7ac090-141d-4258-9cd2-362cff88d9ac.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h2 id="_5-2-访问流程" tabindex="-1"><a class="header-anchor" href="#_5-2-访问流程" aria-hidden="true">#</a> 5.2 访问流程</h2><p>无论ceph客户端是哪种类型，例如块设备、对象存储、文件系统，ceph 都会在存储池中将所有数据存储为对象: <br><strong>ceph用户需要拥有存储池访问权限，才能读取和写入数据</strong><br><strong>ceph用户必须拥有执行权限才能使用ceph的管理命令</strong></p><figure><img src="http://cdn1.ryanxin.live/xxlog/1669887090529-269fdedb-ce5f-4e1e-b436-7ec9eb8a9ccf.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="http://cdn1.ryanxin.live/xxlog/1669887247816-2873ce26-50ff-4f30-a6e0-50011624a5e9.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>查看key</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>cephaceph-dep Loy:~/ ceph-cluster$ <span class="token function">cat</span> ceph. C lient <span class="token builtin class-name">.</span> admin. key ring
<span class="token punctuation">[</span>client. admin<span class="token punctuation">]</span>
         key <span class="token operator">=</span> AQA3dhdhMd/UABAAr 2SNpJ+hcK1dD5 L2Hj <span class="token assign-left variable">5XMg</span><span class="token operator">==</span>
         caps mds <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
         caps mgr <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
         caps mon <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
         caps osd <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-3-ceph用户" tabindex="-1"><a class="header-anchor" href="#_5-3-ceph用户" aria-hidden="true">#</a> 5.3 ceph用户</h2><p>用户是指个人(ceph管理者)或系统参与者**(MON/OSD/MDS)**.<br>通过创建用户，可以控制用户或哪个参与者能够访问ceph存储集群、以及可访问的存储池及存储池中的数据。<br>ceph支持多种类型的用户，但可管理的用户都属于client类型区分用户类型的原因在于, <strong>MON/OSD/MDS 等系统组件特使用cephx协议</strong>,但是它们为非客户端。</p><p>通过点号来分割用户类型和用户名，格式为<strong><a href="http://TYPE.ID" target="_blank" rel="noopener noreferrer">TYPE.ID<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong>,例如<strong>client. admin</strong> 通常容器和服务器使用client类型</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>cephaceph-dep Loy:~/ ceph-cluster$ <span class="token function">cat</span> ceph.Client.admin.key ring
<span class="token punctuation">[</span>client.admin<span class="token punctuation">]</span>
         key <span class="token operator">=</span> AQA3dhdhMd/UABAAr 2SNpJ+hcK1dD5 L2Hj <span class="token assign-left variable">5XMg</span><span class="token operator">==</span>
         caps mds <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
         caps mgr <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
         caps mon <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
         caps osd <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-1-列出指定用户信息" tabindex="-1"><a class="header-anchor" href="#_5-3-1-列出指定用户信息" aria-hidden="true">#</a> 5.3.1 列出指定用户信息:<br><br></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">(</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth get osd.10
exported keyring <span class="token keyword">for</span> osd.10
<span class="token punctuation">[</span>osd.10<span class="token punctuation">]</span>
key <span class="token operator">=</span> AQCKF6JfL aEpBRAAbY/P +cHPFPUtnkzljruyXw<span class="token operator">==</span>
caps mgr <span class="token operator">=</span> <span class="token string">&quot;allow profile osd&quot;</span>
caps mon <span class="token operator">=</span> <span class="token string">&quot;allow profile osd&quot;</span>
caps osd <span class="token operator">=</span> <span class="token string">&quot;allow



[ceph@ceph-deploy ceph-cluter$ ceph auth get client.admin
exported keyring for client.admin
[client.admin]
          key = AQAGDKJfQk/dAxAA3Y +9xoE/p8in6QjoHeXmeg==
          caps mds = &quot;</span>allow *<span class="token string">&quot;
          caps mgr = &quot;</span>allow *<span class="token string">&quot;
          caps mon = &quot;</span>allow *<span class="token string">&quot;
          caps osd = &quot;</span>allow *&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-4-ceph授权和使能" tabindex="-1"><a class="header-anchor" href="#_5-4-ceph授权和使能" aria-hidden="true">#</a> 5.4 ceph授权和使能</h2><p><strong>ceph基于使能/能力(Capabilities,简称caps )<strong>来描述用户可针对</strong>MON/OSD或MDS</strong>使用的授权范围或级别，<br>通用的语法格式: <code>daemon-type &#39;allow caps&#39; [...]</code></p><p><strong>能力一览表:</strong></p><p><code>r</code>: 向用户授子读取权限，访问监视器(mon)以检索CRUSH运行图时需具有此能力。<br><code>W</code>: 向用户授子针对对象的写人权限。<br><code>x</code>: 授予用户调用类方法(包括读取和写人)的能力，以及在监视器中执行auth操作的能力。<br><code>*</code>: 授予用户对特定守护进程/存储池的读取、写入和执行权限，以及执行管理命令的能力</p><p><code>class-read</code>:授子用户调用类读取方法的能力，属于是x 能力的子集.<br><code>class-write</code>:授子用户调用类写人方法的能力，属于是x 能力的子集。</p><p>集群组件权限<br><code>profile osd</code>: 授予用户以某个OSD身份连接到其他OSD或监视器的权限.授予OSD权限，使OSD 能够处理复制检测信号流量和状态报告(获取OSD的状态信息).<br><code>profile mds</code>: 授予用户以某个MDS身份连接到其他MDS或监视器的权限。<br><code>profile bootstrap-osd</code>: 授予用户引导OSD的权限(初始化OSD并将OSD加人ceph集群)，授权给部署工具，使其在引导OSD时有权添加密钥。<br><code>profile bootstrap-mds</code>: 授子用户引导元数据服务器的权限，授权部署工具权限，使其在引导元数据服务器时有权添加密钥.</p><p><strong>MON能力:</strong><br>包括r/w/x和allow profile cap(ceph的运行图)<br>例如:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mon <span class="token string">&#39;allow rwx&#39;</span>
mon <span class="token string">&#39;allow profile osd&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>OSD能力:</strong><br>包括r、w、 x、class-read、 class-write(类读取) 和profile osd(类写入)，另外OSD能力还允许进行存储池和名称空间设置。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>osd <span class="token string">&#39;llow capability&#39;</span> <span class="token punctuation">[</span>pool<span class="token operator">=</span>poolname<span class="token punctuation">]</span> <span class="token punctuation">[</span>namespace <span class="token operator">=</span>namespace-name<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>MDS能力:</strong><br>只需要allow 或空都表示允许.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mds <span class="token string">&#39;allow&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_5-5-ceph用户管理" tabindex="-1"><a class="header-anchor" href="#_5-5-ceph用户管理" aria-hidden="true">#</a> 5.5 ceph用户管理</h2><p><br>用户管理功能可让 Ceph集群管理员能够直接在 Ceph集群中创建更新和删除用户。<br>在Ceph集群中创建或删除用户时，可能需要将密钥分发到客户端，以便将密钥添加到密钥环文件中<code>/etc/ceph/ceph.client.admin.keyring</code>，此文件中可以包含一个或 者多个用户认证信息，凡是拥有此文件的节点，将具备访问ceph的权限，而且可以使用其中任何一个账户的权限，此文件类似于linux系统的中的**/etc/passwd**文件.</p><blockquote><p>注意: TYPEID 表示法针对用户采用<strong><a href="http://TYPE.ID" target="_blank" rel="noopener noreferrer">TYPE.ID<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong>表示法 例如osd.0指定是osd类并且ID为0的用户(节点), client.admin是client类型的用户，其ID为admin, 另请注意，每个项包含一个 key=xxx项，以及一个或多个caps项。 可以结合使用-0文件名选项和ceph auth list 将输出保存到某个文件, [ceph@ceph-deploy ceph-cluster]$ ceph auth list -o 123.key</p></blockquote><p>添加一个用户会创建用户名(<strong><a href="http://TYPE.ID" target="_blank" rel="noopener noreferrer">TYPE.ID<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong>). 机密密钥，以及包含在命令中用于创建该用户的所有能力,用户可使用其密钥向Ceph 存储集群进行身份验证。<br>用户的能力授予该用户在<strong>Ceph monitor (mon)</strong>、<strong>Ceph OSD (osd)<strong>或</strong>Ceph元数据服务器(mds)</strong> 上进行读取、写入或执行的能力,可以使用以下几个命令来添加用户:</p><h3 id="_5-5-1-ceph-auth-add" tabindex="-1"><a class="header-anchor" href="#_5-5-1-ceph-auth-add" aria-hidden="true">#</a> 5.5.1 ceph auth add</h3><p>此命令是添加用户的规范方法。它会创建用户、生成密钥，并添加所有指定的能力。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth <span class="token parameter variable">-h</span>
auth <span class="token function">add</span> <span class="token operator">&lt;</span>entity<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token operator">&lt;</span>caps<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token operator">&lt;</span>caps<span class="token operator">&gt;</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token comment">#添加认证key: </span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth <span class="token function">add</span> client.tom mon <span class="token string">&#39;allow r&#39;</span> osd <span class="token string">&#39;allow rwx pool=mypool&#39;</span>
added key <span class="token keyword">for</span> client.tom

<span class="token comment">#tom用户只能在mypool存储池对mon有读权限、对osd有读写执行权限</span>

<span class="token comment">#验证key</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth get client.tom
exported keyring <span class="token keyword">for</span> client.tom
<span class="token punctuation">[</span>client.tom<span class="token punctuation">]</span>
key <span class="token operator">=</span> AQCErsdftuumL BAADUiAfQUI42ZIX1e/4PjpdA<span class="token operator">==</span>
  caps mon <span class="token operator">=</span> <span class="token string">&quot;allow r&quot;</span>
  caps osd <span class="token operator">=</span> <span class="token string">&quot;allow rwx  pool=mypool&quot;</span>
  exported keyring <span class="token keyword">for</span> client.tom
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-2-ceph-auth-get-or-create" tabindex="-1"><a class="header-anchor" href="#_5-5-2-ceph-auth-get-or-create" aria-hidden="true">#</a> 5.5.2 ceph auth get-or-create</h3><p><code>ceph auth get-or-create</code>此命令是创建用户较为常见的方式之一, 它会返回包含用户名(在方括号中)和密钥的密钥文，如果该用户已存在，此命令只以密钥文件格式返回用户名和密钥，还可以使用 -o 指定文件名选项将输出保存到某个文件。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#创建用户</span>

<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth get-or-create client,jack mon <span class="token string">&#39;allow r osd &#39;</span>allow rwx <span class="token assign-left variable">pool</span><span class="token operator">=</span>mypool<span class="token string">&#39;
[client.jack]
     key = AQAtr8dfi37XMhAADbHWEZOshY1QZ5A8eBpeoQ==

#验证用户

[ceph@ceph-deploy ceph-clusterI$ ceph auth get client.jack
exported keyring for cliet,jack
[client.jack]
     key = AQAtr8dfi37XMhAADbHWEZOshY1QZ5A8eBpeoQ==
     caps mon=&quot;allow r&quot;
     caps osd =&quot;allow rwx  pool=mypool&quot;

#再次创建就不会创建了会打印key信息

 [ceph@ceph-deploy ceph-cluster]$ ceph auth get-or-create client.jack mon &#39;</span>allow r
osd &#39;allow rwx <span class="token assign-left variable">pool</span><span class="token operator">=</span>mypool
<span class="token punctuation">[</span>client.jack<span class="token punctuation">]</span>
     key <span class="token operator">=</span> <span class="token assign-left variable">AQAtr8dfiI37XMhAADbHWEZ0shY1QZ5A8eBpeoQ</span><span class="token operator">==</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-3-ceph-auth-get-or-create-key" tabindex="-1"><a class="header-anchor" href="#_5-5-3-ceph-auth-get-or-create-key" aria-hidden="true">#</a> 5.5.3 ceph auth get-or-create-key</h3><p>此命令是创建用户并仅返回用户密钥，对于只需要密钥的客户端(例如libvirt) ，此命令非常有用。<br>如果该用户已存在，此命令只返回密钥。您可以使用-o文件名选项将输出保存到某个文件。</p><p>创建客户端用户时，可以创建不具有能力的用户.不具有能力的用户可以进行身份验证，但不能执行其他操作，此类客户端无法从监视器检索集群地图,但是,如果希望稍后再添加能力，可以使用<code>ceph auth caps</code>命令创建一个不具有能力的用户。<br>典型的用户至少对Ceph monitor具有读取功能，并对Ceph OSD具有读取和写人功能.此外，用户的OSD 权限通常限制为只能访问特定的存储池。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth get-or-create-key client.jack mon <span class="token string">&#39;allow r&#39;</span> osd <span class="token string">&#39;allow rwx pool=mypool&#39;</span>
<span class="token assign-left variable">AQAtr8dfi37XMhAADbHWEZ0shY1QZ5A8eBpeoQ</span><span class="token operator">==</span> <span class="token comment">#用户有key就显示没有就创建</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-4-ceph-auth-print-key" tabindex="-1"><a class="header-anchor" href="#_5-5-4-ceph-auth-print-key" aria-hidden="true">#</a> 5.5.4 ceph auth print-key</h3><p>只获取单个指定用户的key信息</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster$ ceph auth print-key client.jack
AQAtr8dfi37XMhAADbHWEZ0shY <span class="token assign-left variable">1QZ5A8eBpeoQ</span><span class="token operator">==</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-5-修改用户能力" tabindex="-1"><a class="header-anchor" href="#_5-5-5-修改用户能力" aria-hidden="true">#</a> 5.5.5 修改用户能力</h3><p>使用<code>ceph auth caps</code>命令可以指定用户以及更改该用户的能力，设置新能力会完全覆盖当前的能力，因此要加上之前的用户已经拥有的能和新的能力，如果看当前能力，可以运行<code>ceph auth get USERTYPE.USERID</code>,如果要添加能力，使用以下格式时还需要指定现有能力:</p><p><strong>权限修改后立即生效</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#查看用户当前权限</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth get client.jack
exported keyring <span class="token keyword">for</span> client.jack
<span class="token punctuation">[</span>client.jack<span class="token punctuation">]</span>
     key <span class="token operator">=</span> <span class="token assign-left variable">AQAtr8dfi37XMhAADbHWEZ0shY1QZ5A8eBpeoQ</span><span class="token operator">==</span>
     caps mon <span class="token operator">=</span> <span class="token string">&quot;allow r&quot;</span>
     caps osd <span class="token operator">=</span> <span class="token string">&quot;allw rwx pool=mypool&quot;</span>


<span class="token comment">#修改用户权限</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth caps client.jack mon <span class="token string">&#39;allow r&#39;</span> osd <span class="token string">&#39;allow rw pool=mypool&#39;</span>
updated caps <span class="token keyword">for</span> client.jack
<span class="token comment">#再次验证权限</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth get client.jack
exported keyring <span class="token keyword">for</span> client.jack

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-6-删除用户" tabindex="-1"><a class="header-anchor" href="#_5-5-6-删除用户" aria-hidden="true">#</a> 5.5.6 删除用户</h3><p>要删除用户使用<code>ceph auth del TYPE.ID</code>,其中TYPE是client. osd. mon 或mds之一,<br>ID是用户名或守护进程的ID.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth del client.tom
updated
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-6-秘钥环管理" tabindex="-1"><a class="header-anchor" href="#_5-6-秘钥环管理" aria-hidden="true">#</a> 5.6 秘钥环管理</h2><p>ceph的秘钥环是一个保存了<strong>secrets、keys 、certificates</strong>并且能够让客户端通认证访问ceph<br>的<strong>keyring file</strong>(集合文件），一个<strong>keyring file</strong>可以保存一个或者多个认证信息，每一个 key都<br>有一个实体名称加权限，类型为:<br><code>{client、mon、mds、osd)}.name</code></p><p><strong>当客户端访问ceph集群时，ceph 会按顺序依次使用以下四个密钥环文件预设置密钥环设置:</strong><br><strong>集群名词 + 用户类型 +用户ID+固定后缀</strong><br><code>/etc/ceph/&lt;$cluster name&gt;.&lt;user $type&gt;.&lt;user $id&gt;.keyring</code> 保存单个用户的keyring<br><code>/etc/ceph/cluster.keyring</code> 保存多个用户的keyring<br><code>/etc/ceph/keyring</code> 未定义集群名称的多个用户的keyring<br><code>/etc/ceph/keyring.bin</code> 编译后的二进制文件</p><h3 id="_5-6-1-通过秘钥环文件备份与恢复用户" tabindex="-1"><a class="header-anchor" href="#_5-6-1-通过秘钥环文件备份与恢复用户" aria-hidden="true">#</a> 5.6.1 通过秘钥环文件备份与恢复用户</h3><p>如果误删除账号可以通过秘钥环恢复用户，<strong>主要是key不会变（k8s 几十几百个pod）</strong><br>使用<code>ceph auth add</code>等命令添加的用户还需要额外使用<code>ceph-authtool</code>命令为其创建用户秘<br>钥环文件.<br>先创建空 keyring文件命令格式:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ceph-authtool --create-keyring FILE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>导出用户认证信息至keyring文件:</strong><br>将用户信息导出至keyring文件，对用户信息进行备份。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#创建用户:</span>
<span class="token punctuation">(</span>ceph@ceph-deploy ceph cluster<span class="token punctuation">]</span>$ ceph auth get-or-create client.user1 mon <span class="token string">&#39;allow r&#39;</span> osd <span class="token string">&#39;allow *pool=mypool&#39;</span>
<span class="token punctuation">[</span>client.user1<span class="token punctuation">]</span>
          key <span class="token operator">=</span>AQAUUchfjpMqGRAARV6h0ofdDEneuaRnxuHjoQ<span class="token operator">==</span>

<span class="token comment">#验证用户</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-clusterl$ ceph auth get client.user1
exported keyring <span class="token keyword">for</span> client.user1
<span class="token punctuation">[</span>client.user1<span class="token punctuation">]</span>
          key <span class="token operator">=</span> <span class="token assign-left variable">AQAUUchfjpMqGRAARV6hOofdDEneuaRnxuHjoQ</span><span class="token operator">==</span>
          caps mon <span class="token operator">=</span> <span class="token string">&quot;allow r&quot;</span>
          caps osd <span class="token operator">=</span> <span class="token string">&quot;allow *pool=mypool&quot;</span>

<span class="token comment">#创建keyring文件:</span>
<span class="token punctuation">(</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph-authtool --create-keyring ceph.client.user1.keyring


<span class="token comment">#验证keyring文件:</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ <span class="token function">cat</span> ceph.client.user1.keyring
<span class="token comment">#是个空文件</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ <span class="token function">file</span> ceph.client.user1.keyring
ceph.client.user1.keyring: empty

<span class="token comment">#导出keyring至指定文件</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span><span class="token variable">$ceph</span> auth get client.user1 <span class="token parameter variable">-o</span> ceph.client.user1.keyring
exported keyring <span class="token keyword">for</span> client.user1

<span class="token comment">#验证指定用户的keyring文件:</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ <span class="token function">cat</span> ceph.client.user1.keyring
<span class="token punctuation">[</span>client.user1<span class="token punctuation">]</span>
     key <span class="token operator">=</span> <span class="token assign-left variable">AQAUUchfjpMqGRAARV6hOofdDEneuaRnxuHjoQ</span><span class="token operator">==</span>
     caps mon <span class="token operator">=</span> <span class="token string">&quot;allow r&quot;</span>
     caps osd <span class="token operator">=</span> <span class="token string">&quot;allow * pool=mypool&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在创建包含单个用户的密钥环时，通常建议使用ceph集群名称、用户类型和用户名及<br>keyring来命名，并将其保存在**/etc/ceph** 目录中，例如为<strong>client.user1</strong>用户创建<br><strong>ceph.client.user1.keyring</strong></p><h3 id="_5-6-2-从keyring文件恢复用户认证信息" tabindex="-1"><a class="header-anchor" href="#_5-6-2-从keyring文件恢复用户认证信息" aria-hidden="true">#</a> 5.6.2 从keyring文件恢复用户认证信息</h3><p>可以使用<strong>ceph auth import +指定keyring文件</strong>并导人到ceph,其实就是起到用户备份和恢复的目的:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph auth <span class="token function">import</span> <span class="token parameter variable">-i</span> ceph.client.user1.keyring
<span class="token comment">#导入用户</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-6-3-秘钥环文件添加多用户" tabindex="-1"><a class="header-anchor" href="#_5-6-3-秘钥环文件添加多用户" aria-hidden="true">#</a> 5.6.3 秘钥环文件添加多用户</h3><p>一个keyring文件中可以包含多个不同用户的认证文件。<br><strong>将多用户导出至秘钥环:</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#创建keyring文件:</span>
$ ceph-authtool --create-keyring ceph.client.user.keyring <span class="token comment">#创建空的keyring文件</span>
creating ceph.client.user.keyring

<span class="token comment">#把指定的admin用户的keyring文件内容导人到user用户的keyring文件:</span>
<span class="token variable">$ceph</span>-authtool ./ceph.client.user.keyring --import-keyring ./ceph.client.admin.keyring
importing contents of ./ceph.client.admin.keyring into ./ceph.client.user.keyring

<span class="token comment">#验证keyring文件:</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph-authtool <span class="token parameter variable">-I</span> ./ceph.client.user.keyring
<span class="token punctuation">[</span>client.admin<span class="token punctuation">]</span>
    key <span class="token operator">=</span> AQAGDKJfQk/dAxAA3Y +9xoE/p8in6QjoHeXmeg<span class="token operator">==</span>
    caps mds <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
    caps mgr <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
    caps mon <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
    caps osd <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>

<span class="token comment">#再导入一个其他用户的keyring:</span>
<span class="token punctuation">(</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span><span class="token variable">$ceph</span>-authtool ./ceph.client.user.keyring --import-kevring ./ceph.client.user1.kevring


<span class="token comment">#再次验证keyring文件是否包含多个用户的认证信息:</span>
<span class="token punctuation">[</span>ceph@ceph-deploy ceph-cluster<span class="token punctuation">]</span>$ ceph- authtool <span class="token parameter variable">-I</span> ./ceph.client.user.keyring
<span class="token punctuation">[</span>client.admin<span class="token punctuation">]</span>
     key <span class="token operator">=</span> AQAGDKJfQk/dAxAA3Y +9xoE/p8in6QjoHeXmeg<span class="token operator">==</span>
     caps mds <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
     caps mgr <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
     caps mon <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
     caps osd <span class="token operator">=</span> <span class="token string">&quot;allow *&quot;</span>
<span class="token punctuation">[</span>client.user1<span class="token punctuation">]</span>
key <span class="token operator">=</span> <span class="token assign-left variable">AQAUUchfjpMqGRAARV6h0ofdDEneuaRnxuHjoQ</span><span class="token operator">==</span>
     caps mon <span class="token operator">=</span> <span class="token string">&quot;allow r&quot;</span>
     caps osd <span class="token operator">=</span> <span class="token string">&quot;allow * pool=mypool&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: xinxincn0506@outlook.com">ryanxin7</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/ceph/log/4.Ceph%E9%9B%86%E7%BE%A4%E7%BB%B4%E6%8A%A4.html" class="nav-link prev" aria-label="4.Ceph 集群维护"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->4.Ceph 集群维护</div></a><a href="/ceph/log/6.%20Ceph-RBD%E4%BD%BF%E7%94%A8.html" class="nav-link next" aria-label="6.Ceph RBD"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">6.Ceph RBD<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Ryan's Notebook</div><div class="copyright">Copyright © 2023 Ryan</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-982fbdc9.js" defer></script>
  </body>
</html>

import{_ as i,V as o,W as l,$ as s,a0 as n,Y as t,Z as a,C as p}from"./framework-91fce522.js";const r={},c=a(`<h1 id="å¸¸ç”¨æ—¥å¿—æ–‡ä»¶ç±»å‹ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨æ—¥å¿—æ–‡ä»¶ç±»å‹ä»‹ç»" aria-hidden="true">#</a> å¸¸ç”¨æ—¥å¿—æ–‡ä»¶ç±»å‹ä»‹ç»</h1><h2 id="æ—¥å¿—ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—ç®¡ç†" aria-hidden="true">#</a> æ—¥å¿—ç®¡ç†</h2><br><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1.png" alt="æ—¥å¿—ç®¡ç†1" tabindex="0" loading="lazy"><figcaption>æ—¥å¿—ç®¡ç†1</figcaption></figure><br><ul><li>é”™è¯¯æ—¥å¿—æ˜¯ç”¨æ¥æ‹é”™</li><li>æ…¢é€ŸæŸ¥è¯¢ç”¨æ¥è°ƒä¼˜</li><li>äºŒè¿›åˆ¶æ—¥å¿—æ¢å¤æ•°æ®å¦å¤–ä¸ä¸»ä»å¤åˆ¶ç›¸å…³</li></ul><br><h3 id="_1-é”™è¯¯æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_1-é”™è¯¯æ—¥å¿—" aria-hidden="true">#</a> <strong>1. é”™è¯¯æ—¥å¿—</strong></h3><h4 id="_1-1-ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_1-1-ä½œç”¨" aria-hidden="true">#</a> 1.1 ä½œç”¨</h4><p>ç”¨æ¥æ’æŸ¥ MySQL æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„æ•…éšœã€‚</p><br><br><h4 id="_1-2-é»˜è®¤é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-2-é»˜è®¤é…ç½®" aria-hidden="true">#</a> 1.2 é»˜è®¤é…ç½®</h4><p><strong>é»˜è®¤å¼€å¯</strong></p><p><strong>é»˜è®¤è·¯å¾„å’Œåå­—</strong>: <code>datadir/hostname.err</code></p><p><strong>æŸ¥çœ‹æ–¹æ³•</strong>: <code>[ERROR]</code> é‡ç‚¹å…³æ³¨</p><br><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-2.png" alt="æ—¥å¿—ç®¡ç†2" tabindex="0" loading="lazy"><figcaption>æ—¥å¿—ç®¡ç†2</figcaption></figure><br><h4 id="_1-3-è‡ªå®šä¹‰æ—¥å¿—å­˜å‚¨ä½ç½®" tabindex="-1"><a class="header-anchor" href="#_1-3-è‡ªå®šä¹‰æ—¥å¿—å­˜å‚¨ä½ç½®" aria-hidden="true">#</a> 1.3 è‡ªå®šä¹‰æ—¥å¿—å­˜å‚¨ä½ç½®</h4><p>å»ºè®®å¼‚åœ°å­˜æ”¾ï¼Œæ—¥å¿—ä½ç½®å’Œæ•°æ®å­˜å‚¨åˆ†å¼€ï¼Œé¿å…ç›®å½•ç£ç›˜åäº†æ—¶æ—¥å¿—æ–‡ä»¶ä¹Ÿä¸¢å¤±äº†å¯èƒ½å¯¼è‡´æ— æ³•æ¢å¤ã€‚</p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-3.png" alt="æ—¥å¿—ç®¡ç†3" tabindex="0" loading="lazy"><figcaption>æ—¥å¿—ç®¡ç†3</figcaption></figure><p><code>vim /etc/my.cnf</code> æ·»åŠ åˆ°é…ç½®æ–‡ä»¶</p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-4.png" alt="æ—¥å¿—ç®¡ç†4" tabindex="0" loading="lazy"><figcaption>æ—¥å¿—ç®¡ç†4</figcaption></figure><p>å¯ä»¥çœ‹åˆ°å·²ç»æœ‰è¿™ä¸ªæ–‡ä»¶äº†</p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-5.png" alt="æ—¥å¿—ç®¡ç†5" tabindex="0" loading="lazy"><figcaption>æ—¥å¿—ç®¡ç†5</figcaption></figure><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>log_error<span class="token operator">=</span><span class="token operator">/</span>tmp<span class="token operator">/</span>mysql3306<span class="token punctuation">.</span>log <span class="token comment">-- é‡å¯ç”Ÿæ•ˆ</span>
<span class="token keyword">select</span> @<span class="token variable">@log_error</span><span class="token punctuation">;</span> <span class="token comment">--æŸ¥è¯¢é”™è¯¯æ—¥å¿—ä½ç½®</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><br><ol><li><h3 id="äºŒè¿›åˆ¶æ—¥å¿—-é‡è¦çŸ¥è¯†ç‚¹" tabindex="-1"><a class="header-anchor" href="#äºŒè¿›åˆ¶æ—¥å¿—-é‡è¦çŸ¥è¯†ç‚¹" aria-hidden="true">#</a> äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆé‡è¦çŸ¥è¯†ç‚¹ğŸŒŸï¼‰</h3></li></ol><br><h4 id="_2-1-ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_2-1-ä½œç”¨" aria-hidden="true">#</a> 2.1 ä½œç”¨</h4><ul><li>éƒ¨ç½²ä¸»ä»å¤åˆ¶ä¾èµ–äºŒè¿›åˆ¶æ—¥å¿—</li><li>æ•°æ®æ¢å¤æ—¶éœ€è¦ä¾èµ–äºäºŒè¿›åˆ¶æ—¥å¿—</li></ul><h3 id="_2-2-å¦‚ä½•é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-2-å¦‚ä½•é…ç½®" aria-hidden="true">#</a> 2.2 å¦‚ä½•é…ç½®ï¼Ÿ</h3><p>(1) å‚æ•°ä»‹ç»</p><p>é»˜è®¤æ²¡æœ‰å¼€å¯éœ€è¦æ‰‹åŠ¨å®šä¹‰å¼€å¯ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">6</span>    ä¸€å…±65535
<span class="token assign-left variable">log_bin</span><span class="token operator">=</span>/data/binlog/mysql-bin  è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„ä½ç½®
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¯´æ˜</strong>ï¼š</p><p><code>/data/binlog</code> : æå‰å®šåˆ¶å¥½çš„ç›®å½•, è€Œä¸”è¦æœ‰<code>mysql.mysql</code> çš„æƒé™ <code>mysql-bin</code> : äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åçš„å‰ç¼€ ä¾‹å¦‚: <code>mysql-bin.000001</code> ,<code>mysql-bin.000002</code> ......</p><p>(2) å‚æ•°é…ç½®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">6</span>
<span class="token assign-left variable">log_bin</span><span class="token operator">=</span>/data/binlog/mysql-bin
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>row
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) åˆ›å»ºç›®å½•å’Œæˆæƒ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/binlog/
<span class="token function">chown</span> <span class="token parameter variable">-R</span> mysql.mysql /data
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>(4)é‡å¯ç”Ÿæ•ˆ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@db01 tmp<span class="token punctuation">]</span><span class="token comment"># /etc/init.d/mysqld restart</span>
Shutting down MySQL<span class="token punctuation">..</span> SUCCESS<span class="token operator">!</span> 
Starting MySQL. SUCCESS<span class="token operator">!</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><br><h3 id="_3-äºŒè¿›åˆ¶æ–‡ä»¶è®°å½•äº†ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_3-äºŒè¿›åˆ¶æ–‡ä»¶è®°å½•äº†ä»€ä¹ˆ" aria-hidden="true">#</a> 3. äºŒè¿›åˆ¶æ–‡ä»¶è®°å½•äº†ä»€ä¹ˆï¼Ÿ</h3><h4 id="_3-1-æ¦‚æ‹¬" tabindex="-1"><a class="header-anchor" href="#_3-1-æ¦‚æ‹¬" aria-hidden="true">#</a> 3.1 æ¦‚æ‹¬</h4><p>è®°å½•çš„æ•°æ®åº“æ‰€æœ‰å˜æ›´ç±»çš„æ“ä½œæ—¥å¿— å¦‚ï¼š</p><ul><li>DDL ä»¥è¯­å¥çš„æ–¹å¼,åŸæ¨¡åŸæ ·çš„è®°å½•.</li><li>DCL ä»¥è¯­å¥çš„æ–¹å¼,åŸæ¨¡åŸæ ·çš„è®°å½•.</li><li>DML insert update delete æ“ä½œ ï¼ˆè®°å½•çš„å·²æäº¤çš„äº‹åŠ¡DMLè¯­å¥ï¼‰</li></ul><p>DMLè®°å½•æ ¼å¼(statement,row,mixed),é€šè¿‡<code>binlog_format=row</code>å‚æ•°æ§åˆ¶</p><br><p><strong>è¯´æ˜:</strong></p><ul><li><strong>statement</strong>:SBR,è¯­å¥æ¨¡å¼è®°å½•æ—¥å¿—,åšä»€ä¹ˆå‘½ä»¤,è®°å½•ä»€ä¹ˆå‘½ä»¤.</li><li><strong>row</strong> :RBR,è¡Œæ¨¡å¼, è®°å½•æ•°æ®è¡Œçš„å˜åŒ– è®°å½•æ•°æ®è¡Œ ç”±A=1 å˜æˆ A=2çš„å˜åŒ–è¿‡ç¨‹ redoæ˜¯è®°å½•æ•°æ®é¡µçš„å˜åŒ–</li><li><strong>mixed</strong>:MBR,æ··åˆæ¨¡å¼ç”±MySQLè‡ªå·±è°ƒæ•´å†³å®šç”¨é‚£ç§æ¨¡å¼ ã€‚ ä¸€èˆ¬ä¸ç”¨</li></ul><br><p><strong>é¢è¯•é—®é¢˜:</strong> SBRå’ŒRBRä»€ä¹ˆåŒºåˆ«? æ€ä¹ˆé€‰æ‹©?</p><p><strong>SBR</strong>: å¯è¯»æ€§è¾ƒå¼º,å¯¹äºèŒƒå›´æ“ä½œæ—¥å¿—é‡å°‘,ä½†æ˜¯å¯èƒ½ä¼šå‡ºç°è®°å½•ä¸å‡†ç¡®çš„æƒ…å†µ.</p><p><strong>å¦‚</strong>ï¼š<code>update t1 set name=&#39;zs&#39; where id &gt; 5</code> å¯¹äº”è¡Œæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œä½†åªè®°å½•å‘½ä»¤ã€‚</p><p><code>instart into t1 values ï¼ˆ1ï¼Œ&#39;zs&#39;,now()ï¼‰</code>; æ—¶é—´åˆ—å½•å…¥æ—¶æ˜¯ä»¥å‰çš„æ—¶é—´ï¼Œæœ‰å¯èƒ½å‡ºç°è®°å½•ä¸å‡†ç¡®é—®é¢˜</p><br><p><strong>RBR</strong>: å¯è¯»æ€§è¾ƒå¼±,å¯¹äºèŒƒå›´æ“ä½œæ—¥å¿—å¤§,ä¸ä¼šå‡ºç°è®°å½•é”™è¯¯.</p><p>é«˜å¯ç”¨ç¯å¢ƒä¸­çš„æ–°ç‰¹æ€§è¦ä¾èµ–äºRBR</p><p><strong>å¦‚</strong>ï¼šåŒä¸€ä¸ªè¯­å¥è¦è®°å½•5è¡Œæ“ä½œ å“ªä¸€è¡Œå˜åŠ¨äº†å°±è®°å½•å‡ è¡Œ</p><p>æˆ‘ä»¬å…¬å¸å¯¹æ•°æ®çš„ä¸¥è°¨æ€§è¦æ±‚è¾ƒé«˜,ä¹Ÿç”¨ç”¨åˆ°äº†æ–°å‹çš„æ¶æ„,æ‰€ä»¥é€‰æ‹©RBRã€‚</p><br><br><h3 id="_4-äºŒè¿›åˆ¶æ—¥å¿—è®°å½•å•å…ƒ" tabindex="-1"><a class="header-anchor" href="#_4-äºŒè¿›åˆ¶æ—¥å¿—è®°å½•å•å…ƒ" aria-hidden="true">#</a> 4 äºŒè¿›åˆ¶æ—¥å¿—è®°å½•å•å…ƒ</h3><h4 id="_4-1-event-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#_4-1-event-äº‹ä»¶" aria-hidden="true">#</a> 4.1 event äº‹ä»¶</h4><p>äºŒè¿›åˆ¶æ—¥å¿—çš„æœ€å°å•å…ƒ</p><br><p><strong>å¦‚</strong>ï¼šDDL <code>create database xin;</code> äº‹ä»¶1</p><p>å¯¹äºDDLç­‰è¯­å¥æ˜¯æ¯ä¸€ä¸ªè¯­å¥å°±æ˜¯ä¸€ä¸ªäº‹ä»¶</p><br><p>è€Œ DML: ä¸€ä¸ªäº‹åŠ¡åŒ…å«äº†å¤šä¸ªè¯­å¥</p><p><code>begin;</code> äº‹ä»¶1 <code>a</code> äº‹ä»¶2 <code>b</code> äº‹ä»¶3 <code>commit;</code> äº‹ä»¶4</p><br><h4 id="_4-2-event-äº‹ä»¶çš„å¼€å§‹å’Œç»“æŸä½ç½®" tabindex="-1"><a class="header-anchor" href="#_4-2-event-äº‹ä»¶çš„å¼€å§‹å’Œç»“æŸä½ç½®" aria-hidden="true">#</a> 4.2 event äº‹ä»¶çš„å¼€å§‹å’Œç»“æŸä½ç½®</h4><p>æ–¹ä¾¿æˆ‘ä»¬ä»æ—¥å¿—ä¸­æˆªå–æˆ‘ä»¬æƒ³è¦çš„æ—¥å¿—äº‹ä»¶.</p><br><br><h3 id="_5-äºŒè¿›åˆ¶æ—¥å¿—çš„ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_5-äºŒè¿›åˆ¶æ—¥å¿—çš„ç®¡ç†" aria-hidden="true">#</a> 5. äºŒè¿›åˆ¶æ—¥å¿—çš„ç®¡ç†</h3><h4 id="_5-1-æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—å­˜å‚¨ä½ç½®" tabindex="-1"><a class="header-anchor" href="#_5-1-æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—å­˜å‚¨ä½ç½®" aria-hidden="true">#</a> 5.1 æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—å­˜å‚¨ä½ç½®</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;%log_bin%&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-6.png" alt="Section6-1-6.png" tabindex="0" loading="lazy"><figcaption>Section6-1-6.png</figcaption></figure><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-7.png" alt="Section6-1-7.png" loading="lazy"><br></p><h4 id="_5-2-æŸ¥çœ‹æ‰€æœ‰å·²å­˜åœ¨çš„äºŒè¿›åˆ¶æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_5-2-æŸ¥çœ‹æ‰€æœ‰å·²å­˜åœ¨çš„äºŒè¿›åˆ¶æ—¥å¿—" aria-hidden="true">#</a> 5.2 æŸ¥çœ‹æ‰€æœ‰å·²å­˜åœ¨çš„äºŒè¿›åˆ¶æ—¥å¿—</h4><br><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">binary</span> logs<span class="token punctuation">;</span>
flush logs<span class="token punctuation">;</span> <span class="token comment">--æ»šåŠ¨ä¸€ä¸ªæ–°çš„æ—¥å¿—</span>
<span class="token keyword">show</span> <span class="token keyword">binary</span> logs<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-8.png" alt="Section6-1-8.png" tabindex="0" loading="lazy"><figcaption>Section6-1-8.png</figcaption></figure><br><p><strong>æŸ¥çœ‹æ­£åœ¨ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> master <span class="token keyword">status</span> <span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-9.png" alt="Section6-1-9.png" loading="lazy"><br></p><p><strong>æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>æ¨¡æ‹Ÿå»ºè¡¨æ“ä½œ
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">database</span> binlog <span class="token keyword">charset</span> utf8mb4<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> binlog
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t1<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ› ï¸æ³¨æ„ï¼šäºŒè¿›åˆ¶æ—¥å¿—åªè®°å½•äº‹åŠ¡æäº¤åçš„æ—¥å¿—</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> master <span class="token keyword">status</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+----------+--------------+------------------+-------------------+</span>
<span class="token operator">|</span> <span class="token keyword">File</span>       <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+----------+--------------+------------------+-------------------+</span>
<span class="token operator">|</span> mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000004</span> <span class="token operator">|</span>   <span class="token number">501</span> <span class="token operator">|</span>       <span class="token operator">|</span>         <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+----------+--------------+------------------+-------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æŸ¥çœ‹æ—¥å¿—ï¼š</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">&#39;mysql-bin.000004&#39;</span> <span class="token keyword">limit</span> <span class="token number">5</span><span class="token punctuation">;</span> åªçœ‹å‰äº”è¡Œå†…å®¹
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>å‰ä¸¤è¡Œä¸ºäºŒè¿›åˆ¶æ–‡ä»¶çš„å¤´éƒ¨æ ¼å¼ä¿¡æ¯ä½•ç‰ˆæœ¬ä¿¡æ¯</strong></p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-10.png" alt="Section6-1-10.png" tabindex="0" loading="lazy"><figcaption>Section6-1-10.png</figcaption></figure><p>ç»è¿‡æŸ¥æ‰¾ä»ç¬¬ä¸‰è¡Œå¼€å§‹</p><p>æ ¹æ®Positionå·ç æˆªå–äº‹åŠ¡ 219-335 æ ‡è¯†äº‹åŠ¡å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®</p><p>åªè®°å½•äº‹åŠ¡æäº¤åçš„æ—¥å¿—æäº¤åï¼š</p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-11.png" alt="Section6-1-11.png" tabindex="0" loading="lazy"><figcaption>Section6-1-11.png</figcaption></figure><h4 id="_5-3-æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹" tabindex="-1"><a class="header-anchor" href="#_5-3-æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹" aria-hidden="true">#</a> 5.3 <strong>æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹</strong></h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlbinlog mysql-bin.000004 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">&#39;^SET&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-12.png" alt="Section6-1-12.png" tabindex="0" loading="lazy"><figcaption>Section6-1-12.png</figcaption></figure><p><strong>ç¿»è¯‘ä¸€ä¸‹ï¼š</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlbinlog --base64-output<span class="token operator">=</span>decode-rows <span class="token parameter variable">-vvv</span> mysql-bin.000004 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>sssss</p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-13.png" alt="Section6-1-13.png" tabindex="0" loading="lazy"><figcaption>Section6-1-13.png</figcaption></figure><p>æ„æ€æ˜¯ åœ¨1å·åˆ—æ’å…¥å€¼1</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlbinlog <span class="token parameter variable">-d</span> haoge mysql-bin.000004 æŒ‰åº“è¿‡æ»¤æ—¥å¿— 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><h4 id="_5-4-æˆªå–äºŒè¿›åˆ¶æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_5-4-æˆªå–äºŒè¿›åˆ¶æ—¥å¿—" aria-hidden="true">#</a> 5.4 æˆªå–äºŒè¿›åˆ¶æ—¥å¿—</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@db01 binlog<span class="token punctuation">]</span><span class="token comment"># mysqlbinlog --start-position=219 --stop-position=335 mysql-bin.000004 &gt;/tmp/a.sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><h4 id="_5-5-é€šè¿‡binlogæ¢å¤æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_5-5-é€šè¿‡binlogæ¢å¤æ•°æ®" aria-hidden="true">#</a> 5.5 é€šè¿‡binlogæ¢å¤æ•°æ®</h4><p>åªè¦äºŒè¿›åˆ¶æ—¥å¿—å…¨å°±ä¼šæ¢å¤ä»»ä½•æ—¶é—´ç‚¹çš„æ•°æ®ï¼Œå› ä¸ºè®°å½•æ—¥å¿—è¿˜åšä¸€éå°±æ¢å¤äº†</p><p><strong>(1) æ¨¡æ‹Ÿæ•°æ®</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">database</span> test11 <span class="token keyword">charset</span> utf8mb4<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> haoge<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t1<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">commit</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>(2)æ¨¡æ‹Ÿæ•…éšœ</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">drop</span> <span class="token keyword">database</span> test11<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>(3)åˆ†æå’Œæˆªå– binlog</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> master <span class="token keyword">status</span> <span class="token punctuation">;</span>    		<span class="token comment">---&gt;ç¡®è®¤ä½¿ç”¨çš„æ˜¯å“ªä¸€ä¸ªæ—¥å¿— ç¡®è®¤æ˜¯004å·æ—¥å¿—æ–‡ä»¶</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">&#39;mysql-bin.000004&#39;</span> <span class="token punctuation">;</span>   <span class="token comment">---&gt;æŸ¥çœ‹äº‹ä»¶</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-14.png" alt="æ—¥å¿—æˆªå–" tabindex="0" loading="lazy"><figcaption>æ—¥å¿—æˆªå–</figcaption></figure><p><strong>è¯´æ˜:</strong> æ‰¾åˆ°èµ·ç‚¹å’Œç»ˆç‚¹,è¿›è¡Œæˆªå–</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlbinlog --start-position<span class="token operator">=</span><span class="token number">823</span> --stop-position<span class="token operator">=</span><span class="token number">1420</span> /data/binlog/mysql-bin.000004 <span class="token operator">&gt;</span>/tmp/bin.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-15.png" alt="æ—¥å¿—æˆªå–2" tabindex="0" loading="lazy"><figcaption>æ—¥å¿—æˆªå–2</figcaption></figure><p><strong>(4) æ¢å¤binlog</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> sql_log_bin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">---&gt;åœ¨æ­¤ä¼šè¯ä¸­ä¸´æ—¶å…³é—­äºŒè¿›åˆ¶æ—¥å¿—    é¿å…æ¢å¤æ—¶äº§ç”Ÿçš„æ–°æ—¥å¿—</span>
mysql<span class="token operator">&gt;</span> source <span class="token operator">/</span>tmp<span class="token operator">/</span>bin<span class="token punctuation">.</span><span class="token keyword">sql</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> sql_log_bin<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">set</span> sql_log_bin<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">---&gt;æ”¹å›æ¥</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-16.png" alt="æ—¥å¿—æˆªå–" tabindex="0" loading="lazy"><figcaption>æ—¥å¿—æˆªå–</figcaption></figure><p><strong>é—®é¢˜æ¥äº†ï¼Œ å¦‚æœä¸šåŠ¡è·‘äº†ä¸¤å¹´äº†ï¼Œæ€ä¹ˆæ‰¾æ—¥å¿—ï¼Ÿ</strong></p><p>äºŒè¿›åˆ¶è™½ç„¶å¯ä»¥æ•°æ®æ¢å¤ï¼Œä½†æ˜¯å®ƒçš„åŠŸèƒ½æ€§ä¸Šæ˜¯æœ‰ç¼ºé™·çš„å¯¼è‡´å®ƒåªèƒ½ä½œä¸ºæ•°æ®æ¢å¤çš„è¾…åŠ©æ‰‹æ®µ</p><p><strong>å¦‚</strong>ï¼š å…¨å¤‡ä»½ +äºŒè¿›åˆ¶æ—¥å¿—æ¢å¤ï¼Œå…ˆæ‰¾åˆ°æœ€æ–°çš„å…¨å¤‡ä»½ç„¶ååœ¨ç”¨äºŒè¿›åˆ¶æ—¥å¿—æ¢å¤åˆ°ä»Šå¤©çš„æ•°æ®å°±è¡Œã€‚</p><br><br><h3 id="_6-gtid-è®°å½•æ¨¡å¼ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_6-gtid-è®°å½•æ¨¡å¼ç®¡ç†" aria-hidden="true">#</a> 6. GTID è®°å½•æ¨¡å¼ç®¡ç† â­</h3><h4 id="_6-1-gtid-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_6-1-gtid-ä»‹ç»" aria-hidden="true">#</a> 6.1 GTID ä»‹ç»</h4><ul><li><p>å¯¹äºbinlogä¸­çš„æ¯ä¸€ä¸ªäº‹åŠ¡,éƒ½ä¼šç”Ÿæˆä¸€ä¸ªGTIDå·ç </p></li><li><p>DDL ,DCL ä¸€ä¸ªeventå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡,å°±ä¼šæœ‰ä¸€ä¸ªGTIDå·.</p></li><li><p>DMLè¯­å¥æ¥è®²,beginåˆ°commit,æ˜¯ä¸€ä¸ªäº‹åŠ¡,å°±æ˜¯ä¸€ä¸ªGTIDå·</p></li></ul><br><h4 id="_6-2-gtidçš„ç»„æˆ" tabindex="-1"><a class="header-anchor" href="#_6-2-gtidçš„ç»„æˆ" aria-hidden="true">#</a> <strong>6.2 GTIDçš„ç»„æˆ</strong></h4><p>ç”±ä¸¤éƒ¨åˆ†ç»„æˆ <strong>severi_uuid:TID</strong> äº‹åŠ¡çš„å·ç </p><p><strong>severi_uuid</strong> åœ¨ <code>auto.cnf</code> ä¸­æŸ¥çœ‹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@db01 data<span class="token punctuation">]</span><span class="token comment"># cat auto.cnf </span>
<span class="token punctuation">[</span>auto<span class="token punctuation">]</span>
server-uuid<span class="token operator">=</span>d60b549f-9e10-11e9-ab04-000c294a1b3b
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**TID **æ˜¯ä¸€ä¸ªè‡ªå¢é•¿çš„æ•°æ®,ä»1å¼€å§‹ å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>d60b549f-9e10-11e9-ab04-000c294a1b3b:1-15
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><br><h4 id="_6-3-gtidçš„å¹‚ç­‰æ€§" tabindex="-1"><a class="header-anchor" href="#_6-3-gtidçš„å¹‚ç­‰æ€§" aria-hidden="true">#</a> 6.3 GTIDçš„å¹‚ç­‰æ€§</h4><p>å¦‚æœæ‹¿æœ‰GTIDçš„æ—¥å¿—å»æ¢å¤æ—¶,æ£€æŸ¥å½“å‰ç³»ç»Ÿä¸­æ˜¯å¦æœ‰ç›¸åŒGTIDå·,æœ‰ç›¸åŒçš„å°±è‡ªåŠ¨è·³è¿‡</p><p>åŒAnsibleå‰§æœ¬è·³è¿‡åŒç†ä¼šå½±å“åˆ°binlogæ¢å¤å’Œä¸»ä»å¤åˆ¶ã€‚</p><br><br><h4 id="_6-4-gtidçš„å¼€å¯å’Œé…ç½®" tabindex="-1"><a class="header-anchor" href="#_6-4-gtidçš„å¼€å¯å’Œé…ç½®" aria-hidden="true">#</a> 6.4 GTIDçš„å¼€å¯å’Œé…ç½®</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/my.cnf
gtid-mode<span class="token operator">=</span>on
enforce-gtid-consistency<span class="token operator">=</span>true å¼ºåˆ¶gtidä¸€è‡´æ€§
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-17.png" alt="GTID" tabindex="0" loading="lazy"><figcaption>GTID</figcaption></figure><p><strong>æ³¨æ„</strong>ï¼šå¼€å¯åæ­¢å½±å“ä»¥åçš„äº‹åŠ¡ ä»¥å‰çš„ç®¡ä¸ç€</p><br><h4 id="_6-5-æŸ¥çœ‹gtidä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_6-5-æŸ¥çœ‹gtidä¿¡æ¯" aria-hidden="true">#</a> 6.5 æŸ¥çœ‹GTIDä¿¡æ¯</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">database</span> gtid <span class="token keyword">charset</span> utf8mb4<span class="token punctuation">;</span> åˆ›å»ºä¸€ä¸ªåº“
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> master <span class="token keyword">status</span><span class="token punctuation">;</span> æŸ¥çœ‹gtidå·ç  å·²ç»äº§ç”Ÿgtid
mysql<span class="token operator">&gt;</span> <span class="token keyword">use</span> gtid<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t1<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span> åˆ›å»ºä¸€ä¸ªè¡¨
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> master <span class="token keyword">status</span><span class="token punctuation">;</span>  æŸ¥çœ‹gtidå·ç  å·²ç»äº§ç”Ÿgtid <span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-18.png" alt="GTID2" tabindex="0" loading="lazy"><figcaption>GTID2</figcaption></figure><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">commit</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> master <span class="token keyword">status</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æäº¤ä¹‹åæ‰ç®—ä¸€ä¸ªäº‹åŠ¡</strong></p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-19.png" alt="GTID3" loading="lazy"><br></p><p><strong>å¼€äº†GTID åçš„æ—¥å¿—ä¿¡æ¯</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">&#39;mysql-bin.000005&#39;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-20.png" alt="GTID3" tabindex="0" loading="lazy"><figcaption>GTID3</figcaption></figure><br><br><h3 id="_7-åŸºäºgtid-æ¢å¤æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_7-åŸºäºgtid-æ¢å¤æ•°æ®" aria-hidden="true">#</a> 7. åŸºäºGTID æ¢å¤æ•°æ®</h3><p>å¼€å¯GTID ååªéœ€æˆªå–GTIDæ—¥å¿—å°±å¯ä»¥äº†ï¼ŒGTIDæ˜¯å…¨å±€äº‹åŠ¡å”¯ä¸€æ ‡å·ã€‚</p><br><h4 id="_7-1-æˆªå–æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_7-1-æˆªå–æ—¥å¿—" aria-hidden="true">#</a> 7.1 <strong>æˆªå–æ—¥å¿—</strong></h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@db01 data<span class="token punctuation">]</span><span class="token comment"># cd /data/binlog/</span>
<span class="token punctuation">[</span>root@db01 binlog<span class="token punctuation">]</span><span class="token comment"># mysqlbinlog --include-gtids=&#39;d60b549f-9e10-11e9-ab04-000c294a1b3b:1-3&#39; mysql-bin.000005 &gt;/tmp/gtid.sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><br><h4 id="_7-2-æ¢å¤æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_7-2-æ¢å¤æ•°æ®" aria-hidden="true">#</a> 7.2 æ¢å¤æ•°æ®</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> sql_log_bin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> æš‚æ—¶å…³é—­æ—¥å¿—
mysql<span class="token operator">&gt;</span> source <span class="token operator">/</span>tmp<span class="token operator">/</span>gtid<span class="token punctuation">.</span><span class="token keyword">sql</span> æ¢å¤
mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> sql_log_bin<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> å¼€å¯æ—¥å¿—
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-21.png" alt="GTIDæ¢å¤" loading="lazy"><br></p><br><h4 id="_7-3-æŠ¥é”™" tabindex="-1"><a class="header-anchor" href="#_7-3-æŠ¥é”™" aria-hidden="true">#</a> 7.3 æŠ¥é”™</h4><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>ERROR <span class="token number">1049</span> <span class="token punctuation">(</span><span class="token number">42000</span><span class="token punctuation">)</span>: Unknown <span class="token keyword">database</span> <span class="token string">&#39;gtid&#39;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
ERROR <span class="token number">1046</span> <span class="token punctuation">(</span><span class="token number">3</span>D000<span class="token punctuation">)</span>: <span class="token keyword">No</span> <span class="token keyword">database</span> selected
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-22.png" alt="GTIDæ¢å¤æŠ¥é”™" loading="lazy"><br></p><p><strong>ä¸ºä»€ä¹ˆæŠ¥é”™?</strong></p><p>å› ä¸ºå¹‚ç­‰æ€§çš„æ£€æŸ¥,1-3äº‹åŠ¡å·²ç»åšè¿‡äº†ã€‚</p><p><strong>æ­£ç¡®çš„åšæ³•</strong>ï¼š</p><p>åœ¨å¯¼å‡ºçš„æ—¶å€™åº”è¯¥å¿½ç•¥GTIDçš„å¹‚ç­‰æ€§ã€‚ å½“æˆæ–°çš„äº‹åŠ¡æ¥å¯¹å¾… 1-4 è·³è¿‡å¹¶è®°å½•æ–°IDå·</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlbinlog --skip-gtids --include-gtids<span class="token operator">=</span><span class="token string">&#39;d60b549f-9e10-11e9-ab04-000c294a1b3b:1-3&#39;</span> mysql-bin.000005 <span class="token operator">&gt;</span>/tmp/gtid.sql
--skip-gtids 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½œç”¨</strong>:åœ¨å¯¼å‡ºæ—¶,å¿½ç•¥åŸæœ‰çš„gtidä¿¡æ¯,æ¢å¤æ—¶ç”Ÿæˆæœ€æ–°çš„ GTID ä¿¡æ¯</p><p><strong>æ¢å¤æ•°æ®</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">set</span> sql_log_bin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
source <span class="token operator">/</span>tmp<span class="token operator">/</span>gtid<span class="token punctuation">.</span><span class="token keyword">sql</span>
<span class="token keyword">set</span> sql_log_bin<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p><strong>GTIDç›¸å…³çš„å‚æ•°</strong>ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>--skip-gtids <span class="token comment">#å¿½ç•¥åŸæœ‰çš„GTID ä¿¡æ¯,æ¢å¤æ—¶ç”Ÿæˆæœ€æ–°çš„ GTID ä¿¡æ¯</span>
--include-gtids<span class="token operator">=</span><span class="token string">&#39;d60b549f-9e10-11e9-ab04-000c294a1b3b:6&#39;</span>,<span class="token string">&#39;d60b549f-9e10-11e9-ab04-000c294a1b3b:8&#39;</span> <span class="token comment">#åªæˆªå–6å’Œ8</span>
--exclude-gtids<span class="token operator">=</span><span class="token string">&#39;d60b549f-9e10-11e9-ab04-000c294a1b3b:6&#39;</span>,<span class="token string">&#39;d60b549f-9e10-11e9-ab04-000c294a1b3b:8&#39;</span> <span class="token comment">#æ’é™¤</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><br><h3 id="_8-æ…¢æ—¥å¿—-slow-log" tabindex="-1"><a class="header-anchor" href="#_8-æ…¢æ—¥å¿—-slow-log" aria-hidden="true">#</a> 8. æ…¢æ—¥å¿— ï¼ˆslow-log ï¼‰</h3><br><p><strong>ä½œç”¨</strong>ï¼šè®°å½•è¿è¡Œè¾ƒæ…¢çš„è¯­å¥,ä¼˜åŒ–è¿‡ç¨‹ä¸­å¸¸ç”¨çš„å·¥å…·æ—¥å¿—ã€‚</p><h4 id="_8-1-æ…¢æ—¥å¿—é…ç½®" tabindex="-1"><a class="header-anchor" href="#_8-1-æ…¢æ—¥å¿—é…ç½®" aria-hidden="true">#</a> 8.1 æ…¢æ—¥å¿—é…ç½®</h4><p><strong>å¼€å…³</strong></p><p><code>slow_query_log=1</code></p><p><strong>æ–‡ä»¶ä½ç½®åŠåå­—</strong></p><p><code>slow_query_log_file=/data/mysql/slow.log</code></p><p><strong>è®¾å®šæ…¢æŸ¥è¯¢æ—¶é—´</strong></p><p><code>long_query_time=0.1</code></p><p><strong>æ²¡èµ°ç´¢å¼•çš„è¯­å¥ä¹Ÿè®°å½•</strong></p><p><code>log_queries_not_using_indexes</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/my.cnf
<span class="token assign-left variable">slow_query_log</span><span class="token operator">=</span><span class="token number">1</span> 
<span class="token assign-left variable">slow_query_log_file</span><span class="token operator">=</span>/data/mysql/slow.log
<span class="token assign-left variable">long_query_time</span><span class="token operator">=</span><span class="token number">0.1</span>
log_queries_not_using_indexes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é»˜è®¤å®šä¹‰æ…¢è¯­å¥çš„æ—¶é—´ åç§’</p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-23.png" alt="GTIDæ¢å¤æŠ¥é”™" tabindex="0" loading="lazy"><figcaption>GTIDæ¢å¤æŠ¥é”™</figcaption></figure><br><br><h4 id="_8-2-æ¨¡æ‹Ÿæ…¢æŸ¥è¯¢åˆ†ææ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_8-2-æ¨¡æ‹Ÿæ…¢æŸ¥è¯¢åˆ†ææ—¥å¿—" aria-hidden="true">#</a> 8.2 æ¨¡æ‹Ÿæ…¢æŸ¥è¯¢åˆ†ææ—¥å¿—</h4><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-24.png" alt="æ…¢æ—¥å¿—åˆ†æ" loading="lazy"><br></p><p><strong>åˆ†ææ…¢æ—¥å¿—</strong></p><p><code>mysqldumpslow -s c -t 10 /data/mysql/slow.log</code> ä¼˜åŒ–å‰åä¸ª è‡ªåŠ¨ä»¥æ—¶é—´ä¸ºç¬¬äºŒç»´åº¦ <code>-s</code> æ’åº <code>-c</code> æ¬¡æ•° <code>-t</code> å‰åä¸ªè®°å½•</p><ul><li>ä¸æ˜¾ç¤ºé‡å¤çš„ æœ€æ…¢çš„ä¼˜å…ˆå¤„ç†</li><li>ä¼˜å…ˆå¤„ç†ä¼˜åŒ–ä½¿ç”¨æ¬¡æ•°æœ€å¤šçš„è¯­å¥</li></ul><br><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-25.png" alt="æ…¢æ—¥å¿—åˆ†æ" loading="lazy"><br></p><p><strong>è¶…è¿‡01ç§’çš„å’Œä¸èµ°ç´¢å¼•çš„è¯­å¥</strong></p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-26.png" alt="æ…¢æ—¥å¿—åˆ†æ2" tabindex="0" loading="lazy"><figcaption>æ…¢æ—¥å¿—åˆ†æ2</figcaption></figure><p><strong>ç»“è®º</strong>ï¼šä»¥æŸ¥è¯¢æ—¶é—´å’Œè¿è¡Œæ¬¡æ•°ä¸ºåˆ†æç»“è®º</p><p>1.è¿è¡Œæ¬¡æ•° 2.æ—¶é—´</p><h3 id="_9-ç¬¬ä¸‰æ–¹å·¥å…·" tabindex="-1"><a class="header-anchor" href="#_9-ç¬¬ä¸‰æ–¹å·¥å…·" aria-hidden="true">#</a> 9. ç¬¬ä¸‰æ–¹å·¥å…·</h3><br>`,228),d={href:"https://www.percona.com/downloads/percona-toolkit/LATEST/",target:"_blank",rel:"noopener noreferrer"},g=a(`<p>Pt-query-digestæ˜¯ç”¨äºåˆ†æMySQLæ…¢æŸ¥è¯¢çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒä¹Ÿå¯ä»¥åˆ†æbinlogã€General logã€slowlogï¼Œä¹Ÿå¯ä»¥é€šè¿‡SHOWPROCESSLISTæˆ–è€…é€šè¿‡tcpdumpæŠ“å–çš„MySQLåè®®æ•°æ®æ¥è¿›è¡Œåˆ†æã€‚å¯ä»¥æŠŠåˆ†æç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ä¸­ï¼Œåˆ†æè¿‡ç¨‹æ˜¯å…ˆå¯¹æŸ¥è¯¢è¯­å¥çš„æ¡ä»¶è¿›è¡Œå‚æ•°åŒ–ï¼Œç„¶åå¯¹å‚æ•°åŒ–ä»¥åçš„æŸ¥è¯¢è¿›è¡Œåˆ†ç»„ç»Ÿè®¡ï¼Œç»Ÿè®¡å‡ºå„æŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´ã€æ¬¡æ•°ã€å æ¯”ç­‰ï¼Œå¯ä»¥å€ŸåŠ©åˆ†æç»“æœæ‰¾å‡ºé—®é¢˜è¿›è¡Œä¼˜åŒ–ã€‚</p><br><br><h4 id="_9-1-ä¸‹è½½å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_9-1-ä¸‹è½½å®‰è£…" aria-hidden="true">#</a> 9.1 ä¸‹è½½å®‰è£…</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://www.percona.com/downloads/percona-toolkit/3.2.0/binary/redhat/7/x86_64/percona-toolkit-3.2.0-1.el7.x86_64.rpm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>å®‰è£…ä¾èµ–
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> perl-DBI perl-DBD-MySQL perl-Time-HiRes perl-IO-Socket-SSL perl-Digest-MD5
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> percona-toolkit-3.2.0-1.el7.x86_64.rpm 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h4 id="_9-2-ä½¿ç”¨è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_9-2-ä½¿ç”¨è¯´æ˜" aria-hidden="true">#</a> 9.2 ä½¿ç”¨è¯´æ˜</h4><br><p><code>shell&gt; pt-query-digest [OPTIONS] [DSN]</code></p><p><strong>è¯¦æƒ…å¯å‚è€ƒ</strong></p><p><code>shell&gt;pt-query-digest --help</code></p><p><strong>å¸¸ç”¨å‚æ•°</strong>ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>--create-review-table ï¼šå½“ä½¿ç”¨--reviewå‚æ•°æŠŠåˆ†æç»“æœè¾“å‡ºåˆ°è¡¨ä¸­æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¡¨å°±è‡ªåŠ¨åˆ›å»ºã€‚
--create-history-tableï¼šå½“ä½¿ç”¨--historyå‚æ•°æŠŠåˆ†æç»“æœè¾“å‡ºåˆ°è¡¨ä¸­æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¡¨å°±è‡ªåŠ¨åˆ›å»ºã€‚
<span class="token parameter variable">--filter</span> ï¼š å¯¹è¾“å…¥çš„æ…¢æŸ¥è¯¢æŒ‰æŒ‡å®šçš„å­—ç¬¦ä¸²è¿›è¡ŒåŒ¹é…è¿‡æ»¤åå†è¿›è¡Œåˆ†æ
--limitï¼šé™åˆ¶è¾“å‡ºç»“æœç™¾åˆ†æ¯”æˆ–æ•°é‡ï¼Œé»˜è®¤å€¼æ˜¯20,å³å°†æœ€æ…¢çš„20æ¡è¯­å¥è¾“å‡ºï¼Œå¦‚æœæ˜¯95%åˆ™æŒ‰æ€»å“åº”æ—¶é—´å æ¯”ä»å¤§åˆ°å°æ’åºï¼Œè¾“å‡ºåˆ°æ€»å’Œè¾¾åˆ°95%ä½ç½®æˆªæ­¢ã€‚
<span class="token parameter variable">--log</span><span class="token operator">=</span>s ï¼šæŒ‡å®šè¾“å‡ºçš„æ—¥å¿—æ–‡ä»¶
<span class="token parameter variable">--history</span> å°†åˆ†æç»“æœä¿å­˜åˆ°è¡¨ä¸­ï¼Œåˆ†æç»“æœæ¯”è¾ƒè¯¦ç»†ï¼Œä¸‹æ¬¡å†ä½¿ç”¨--historyæ—¶ï¼Œå¦‚æœå­˜åœ¨ç›¸åŒçš„è¯­å¥ï¼Œä¸”æŸ¥è¯¢æ‰€åœ¨çš„æ—¶é—´åŒºé—´å’Œå†å²è¡¨ä¸­çš„ä¸åŒï¼Œåˆ™ä¼šè®°å½•åˆ°æ•°æ®è¡¨ä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢åŒä¸€CHECKSUMæ¥æ¯”è¾ƒæŸç±»å‹æŸ¥è¯¢çš„å†å²å˜åŒ–ã€‚
--reviewï¼šå°†åˆ†æç»“æœä¿å­˜åˆ°è¡¨ä¸­ï¼Œè¿™ä¸ªåˆ†æåªæ˜¯å¯¹æŸ¥è¯¢æ¡ä»¶è¿›è¡Œå‚æ•°åŒ–ï¼Œä¸€ä¸ªç±»å‹çš„æŸ¥è¯¢ä¸€æ¡è®°å½•ï¼Œæ¯”è¾ƒç®€å•ã€‚å½“ä¸‹æ¬¡ä½¿ç”¨--reviewæ—¶ï¼Œå¦‚æœå­˜åœ¨ç›¸åŒçš„è¯­å¥åˆ†æï¼Œå°±ä¸ä¼šè®°å½•åˆ°æ•°æ®è¡¨ä¸­ã€‚
<span class="token parameter variable">--output</span> åˆ†æç»“æœè¾“å‡ºç±»å‹ï¼Œå€¼å¯ä»¥æ˜¯report<span class="token punctuation">(</span>æ ‡å‡†åˆ†ææŠ¥å‘Š<span class="token punctuation">)</span>ã€slowlog<span class="token punctuation">(</span>Mysql slow log<span class="token punctuation">)</span>ã€jsonã€json-anonï¼Œä¸€èˆ¬ä½¿ç”¨reportï¼Œä»¥ä¾¿äºé˜…è¯»ã€‚
--sinceï¼šä»è¯¥æŒ‡å®šæ—¥æœŸå¼€å§‹åˆ†æã€‚
--untilï¼šæˆªæ­¢æ—¶é—´ï¼Œé…åˆâ€”sinceå¯ä»¥åˆ†æä¸€æ®µæ—¶é—´å†…çš„æ…¢æŸ¥è¯¢ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><br><p><strong>9.3 ä½¿ç”¨ç¤ºä¾‹</strong></p><br><p><strong>Toolkitå·¥å…·åŒ…ä¸­çš„å‘½ä»¤:</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pt-query-diagest  /data/mysql/slow.log
<span class="token comment">#pt-query-digeståˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—</span>
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--report</span> slow.log
<span class="token comment">#æŠ¥å‘Šæœ€è¿‘åŠä¸ªå°æ—¶çš„æ…¢æŸ¥è¯¢ï¼š</span>
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--report</span> <span class="token parameter variable">--since</span> 1800s slow.log
<span class="token comment">#æŠ¥å‘Šä¸€ä¸ªæ—¶é—´æ®µçš„æ…¢æŸ¥è¯¢ï¼š</span>
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--report</span> <span class="token parameter variable">--since</span> <span class="token string">&#39;2013-02-10 21:48:59&#39;</span> <span class="token parameter variable">--until</span> <span class="token string">&#39;2013-02-16 02:33:50&#39;</span> slow.log
<span class="token comment">#æŠ¥å‘Šåªå«selectè¯­å¥çš„æ…¢æŸ¥è¯¢:</span>
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--filter</span> <span class="token string">&#39;$event-&gt;{fingerprint} =~ m/^select/i&#39;</span> slow.log
<span class="token comment">#æŠ¥å‘Šé’ˆå¯¹æŸä¸ªç”¨æˆ·çš„æ…¢æŸ¥è¯¢:</span>
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--filter</span> <span class="token string">&#39;($event-&gt;{user} || &quot;&quot;) =~ m/^root/i&#39;</span> slow.log
<span class="token comment">#æŠ¥å‘Šæ‰€æœ‰çš„å…¨è¡¨æ‰«ææˆ–full joinçš„æ…¢æŸ¥è¯¢:</span>
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--filter</span> <span class="token string">&#39;(($event-&gt;{Full_scan} || &quot;&quot;) eq &quot;yes&quot;) || (($event-&gt;{Full_join} || &quot;&quot;) eq &quot;yes&quot;)&#39;</span> slow.log
<span class="token comment">#æŠŠæŸ¥è¯¢ä¿å­˜åˆ°query_reviewè¡¨</span>
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--user</span><span class="token operator">=</span>root â€“password<span class="token operator">=</span>abc123 <span class="token parameter variable">--review</span> <span class="token assign-left variable">h</span><span class="token operator">=</span>localhost,D<span class="token operator">=</span>test,t<span class="token operator">=</span>query_review --create-review-table  slow.log
<span class="token comment">#æŠŠæŸ¥è¯¢ä¿å­˜åˆ°query_historyè¡¨</span>
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--user</span><span class="token operator">=</span>root â€“password<span class="token operator">=</span>abc123 <span class="token parameter variable">--history</span>  <span class="token assign-left variable">h</span><span class="token operator">=</span>localhost,D<span class="token operator">=</span>test,t<span class="token operator">=</span>query_history --create-history-table  slow.log
<span class="token comment">#é€šè¿‡tcpdumpæŠ“å–mysqlçš„tcpåè®®æ•°æ®ï¼Œç„¶åå†åˆ†æ</span>
shell<span class="token operator">&gt;</span> tcpdump <span class="token parameter variable">-s</span> <span class="token number">65535</span> <span class="token parameter variable">-x</span> <span class="token parameter variable">-nn</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-tttt</span> <span class="token parameter variable">-i</span> any <span class="token parameter variable">-c</span> <span class="token number">1000</span> port <span class="token number">3306</span> <span class="token operator">&gt;</span> mysql.tcp.txt
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--type</span> tcpdump mysql.tcp.txt<span class="token operator">&gt;</span> slow_report.log
<span class="token comment">#åˆ†æbinlog</span>
shell<span class="token operator">&gt;</span> mysqlbinlog mysql-bin.000093 <span class="token operator">&gt;</span> mysql-bin000093.sql
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--type</span><span class="token operator">=</span>binlog mysql-bin000093.sql <span class="token operator">&gt;</span> slow_report.log
<span class="token comment">#åˆ†ægeneral log</span>
shell<span class="token operator">&gt;</span> pt-query-digest <span class="token parameter variable">--type</span><span class="token operator">=</span>genlog localhost.log <span class="token operator">&gt;</span> slow_report.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><br><p>å¦‚ä¸‹ä¸ºè¾“å…¥ç»“æœç¤ºä¾‹ï¼š</p><br><br><h4 id="_9-4-å°†åˆ†æç»“æœå¯è§†åŒ–" tabindex="-1"><a class="header-anchor" href="#_9-4-å°†åˆ†æç»“æœå¯è§†åŒ–" aria-hidden="true">#</a> 9.4 å°†åˆ†æç»“æœå¯è§†åŒ–</h4><p><strong>åŸç†</strong>ï¼šä½¿ç”¨pt-query-digeståˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—å¹¶å°†æŸ¥è¯¢åˆ†ææ•°æ®ä¿å­˜åˆ°MySQLæ•°æ®åº“è¡¨ä¸­ï¼Œç„¶åä½¿ç”¨åº”ç”¨ç¨‹åºæ¥å±•ç¤ºåˆ†æç»“æœ.</p><p>ç›®å‰æœ‰åŸºäºLAMPçš„Query-Digest-UIã€Anemometerå¼€æºé¡¹ç›®æ”¯æŒã€‚</p><br><br><p><strong>ä»‹ç»ï¼š</strong></p>`,31),u={href:"https://github.com/box/Anemometer",target:"_blank",rel:"noopener noreferrer"},b=a(`<p>ç»“åˆPercona-toolkitä¸­pt-query-digestï¼ŒAnemometerå¯ä»¥å¾ˆè½»æ¾çš„å¸®ä½ å»åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®©ä½ å¾ˆå®¹æ˜“å°±èƒ½æ‰¾åˆ°å“ªäº›SQLéœ€è¦ä¼˜åŒ–ã€‚</p><br><p><strong>éœ€è¦å®‰è£…çš„æ­¥éª¤å¦‚ä¸‹ï¼š</strong></p><ol><li>percona-toolkitå·¥å…·çš„å®‰è£…</li><li>php webç¯å¢ƒçš„æ­å»º</li><li>å®‰è£…Anemometerå¹¶é…ç½®</li><li>å¯¼å…¥æ…¢æŸ¥è¯¢æ—¥å¿—</li><li>è®¿é—®ç•Œé¢ï¼ŒæŸ¥çœ‹æ…¢æŸ¥è¯¢</li><li>å…¶ä»–ç›¸å…³å’Œé—®é¢˜è§£å†³</li></ol><br><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-34.png" alt="Anemometeæ„æ¶å›¾" loading="lazy"><br></p><br><p><strong>php&amp;webç¯å¢ƒçš„æ­å»º</strong></p><p><strong>LAMPç¯å¢ƒçš„å®‰è£…</strong></p><br><p><strong>å®‰è£…apache</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> httpd httpd-devel <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><p><strong>å®‰è£…php</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> php php-mysql php-common php-bcmath php-dba php-cli php-gd php-mbstring php-mcrypt php-devel php-xml php-pdo <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><p><strong>ä¿®æ”¹æ—¶åŒº</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/php.iniï¼Œ
<span class="token comment">#ä¿®æ”¹ä¸º </span>
date.timezone <span class="token operator">=</span> PRC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p><strong>LAMPç¯å¢ƒå¯åŠ¨</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl start httpd
systemctl stop httpd
systemctl restart httpd
systemctl status httpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><br><p><strong>å®‰è£…Anemometerå¹¶é…ç½®</strong></p><p><strong>1.ä¸‹è½½å®‰è£…</strong></p>`,25),m=s("strong",null,"ä¸‹è½½åœ°å€",-1),v={href:"https://github.com/box/Anemometer",target:"_blank",rel:"noopener noreferrer"},k=a(`<br><p><strong>ä¸‹è½½åä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">unzip</span> Anemometer.master.zip
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><p><strong>ç§»åŠ¨åˆ°webæ ¹ç›®å½•</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mv</span> Anemometer /var/www/html/anemometer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><p><strong>2.æˆäºˆæƒé™</strong></p><p>ç›®æ ‡æ…¢æŸ¥è¯¢æ•°æ®åº“ä¸Šéœ€è¦æˆäºˆAnemometerä¸»æœºå¯¹åº”çš„æƒé™ï¼Œç”¨äºåˆ†æç›®æ ‡æ…¢æŸ¥è¯¢æ•°æ®åº“<strong>explain</strong>æ‰§è¡Œè®¡åˆ’</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">grant</span> <span class="token keyword">select</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">&#39;anemometer&#39;</span><span class="token variable">@&#39;$ip&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>  <span class="token comment">--ï¼ˆ$ipä¸ºAnemometerä¸»æœºå¯¹åº”ipåœ°å€ï¼‰</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><br><br><p><strong>3.ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><p>å¢åŠ <strong>explain</strong>è¯»å–ç”¨æˆ·å¯†ç ä¿¡æ¯</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cp</span> conf/sample.config.inc.php conf/config.inc.php
<span class="token function">vim</span> conf/config.inc.php
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><br><br><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-28.png" alt="ä¿®æ”¹é…ç½®æ–‡ä»¶2" tabindex="0" loading="lazy"><figcaption>ä¿®æ”¹é…ç½®æ–‡ä»¶2</figcaption></figure><br><p>ä¿®æ”¹é…ç½®æ–‡ä»¶æŒ‡å‘æ•°æ®æºæ–‡ä»¶</p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-41.png" alt="ä¿®æ”¹é…ç½®æ–‡ä»¶2" tabindex="0" loading="lazy"><figcaption>ä¿®æ”¹é…ç½®æ–‡ä»¶2</figcaption></figure><p>åˆå§‹åŒ–æ•°æ®æºçš„æ•°æ®åº“è¡¨çš„é…ç½®</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-40.png" alt="ä¿®æ”¹é…ç½®æ–‡ä»¶3" loading="lazy"><br></p><p><strong>4.æ¨é€æ…¢è¯­å¥åˆ†æ</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pt-query-digest <span class="token parameter variable">--user</span><span class="token operator">=</span>slowlog <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token number">1</span> 
<span class="token parameter variable">--review</span> <span class="token assign-left variable">h</span><span class="token operator">=</span><span class="token number">10.0</span>.0.51,D<span class="token operator">=</span>slow_query_log,t<span class="token operator">=</span>global_query_review
<span class="token parameter variable">--history</span> <span class="token assign-left variable">h</span><span class="token operator">=</span><span class="token number">10.0</span>.0.51,D<span class="token operator">=</span>slow_query_log,t<span class="token operator">=</span>global_query_review_history --no-report 
<span class="token parameter variable">--limit</span><span class="token operator">=</span><span class="token number">0</span>% <span class="token parameter variable">--filter</span><span class="token operator">=</span><span class="token string">&quot; \\<span class="token variable">$event</span>-&gt;{Bytes} = length(\\<span class="token variable">$event</span>-&gt;{arg}) and \\<span class="token variable">$event</span>-&gt;{hostname}=<span class="token entity" title="\\&quot;">\\&quot;</span><span class="token environment constant">$HOSTNAME</span><span class="token entity" title="\\&quot;">\\&quot;</span>&quot;</span> 
slow.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><br><p><strong>5.è®¿é—®ç½‘é¡µï¼ŒæŸ¥çœ‹æ…¢è¯­å¥å¯è§†åŒ–åˆ†æ</strong></p>`,28),h={href:"http://127.0.0.1/anemometer",target:"_blank",rel:"noopener noreferrer"},_=a(`<figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-32.png" alt="webç•Œé¢1" tabindex="0" loading="lazy"><figcaption>webç•Œé¢1</figcaption></figure><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-33.png" alt="webç•Œé¢2" tabindex="0" loading="lazy"><figcaption>webç•Œé¢2</figcaption></figure><p><strong>Query-Digest-UI</strong> åº”ç”¨</p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-31.png" alt="Query-Digest-UI" tabindex="0" loading="lazy"><figcaption>Query-Digest-UI</figcaption></figure><br><br><p><strong>6.è¸©å‘é—®é¢˜è§£å†³</strong></p><p><strong>MySQL 5.7 æ—¶é—´æ ¼å¼é—®é¢˜</strong></p><p>MySQLå‡çº§5.7åï¼Œå‡ºç°å¼‚å¸¸<code>Invalid default value for &#39;create_time&#39;</code> <br></p><p>5.7ä¹‹åç‰ˆæœ¬ datetime é»˜è®¤å€¼è®¾ç½® &#39;0000-00-00&#39;<br></p><br><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><p>æ‰“å¼€MySQLå®‰è£…ä½ç½®ï¼Œæ‰¾åˆ°<code>my.ini</code>é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æˆ–ä¿®æ”¹å¦‚ä¸‹é…ç½®ï¼š<br></p><p>åœ¨ <code>[mysqld]</code> ä¸­æ·»åŠ <br></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>sql-mode<span class="token operator">=</span>ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,
NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,15),y=a(`<br><p><strong>ä¸´æ—¶è§£å†³æ–¹æ¡ˆ</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">session</span> sql_mode<span class="token operator">=</span><span class="token string">&#39;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><br> <br></p><p><code>Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggre</code> é—®é¢˜è§£å†³</p><p><strong>é—®é¢˜å‡ºç°çš„åŸå› ï¼š</strong></p><p><strong>MySQL 5.7.5åŠä»¥ä¸ŠåŠŸèƒ½ä¾èµ–æ£€æµ‹åŠŸèƒ½ã€‚å¦‚æœå¯ç”¨äº†ONLY_FULL_GROUP_BY SQLæ¨¡å¼ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ï¼ŒMySQLå°†æ‹’ç»é€‰æ‹©åˆ—è¡¨ï¼ŒHAVINGæ¡ä»¶æˆ–ORDER BYåˆ—è¡¨çš„æŸ¥è¯¢å¼•ç”¨åœ¨GROUP BYå­å¥ä¸­æ—¢æœªå‘½åçš„éé›†åˆåˆ—ï¼Œä¹Ÿä¸åœ¨åŠŸèƒ½ä¸Šä¾èµ–äºå®ƒä»¬ã€‚ï¼ˆ5.7.5ä¹‹å‰ï¼ŒMySQLæ²¡æœ‰æ£€æµ‹åˆ°åŠŸèƒ½ä¾èµ–å…³ç³»ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸å¯ç”¨ONLY_FULL_GROUP_BYã€‚æœ‰å…³5.7.5ä¹‹å‰çš„è¡Œä¸ºçš„è¯´æ˜ï¼Œè¯·å‚è§â€œMySQL 5.6å‚è€ƒæ‰‹å†Œâ€ã€‚ï¼‰</strong></p><p><strong>è§£å†³æ–¹æ³•ä¸€ï¼š</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> @<span class="token variable">@global.sql_mode</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŸ¥è¯¢å‡ºæ¥çš„å€¼ä¸ºï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token string">&#39;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å»æ‰ <strong>ONLY_FULL_GROUP_BY</strong>ï¼Œé‡æ–°è®¾ç½®å€¼ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">set</span> @<span class="token variable">@global.sql_mode</span> <span class="token operator">=</span><span class="token string">&#39;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>è§£å†³æ–¹æ³•äºŒï¼š</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token function">vim</span> /etc/mysql/conf.d/mysql.cnf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span> 
<span class="token assign-left variable">sql_mode</span><span class="token operator">=</span>STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
<span class="token function">service</span> mysqld restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><br><p><strong>3.æ—¶é—´ä¸åŒæ­¥é—®é¢˜</strong></p><p><strong>é—®é¢˜æè¿°</strong>ï¼šMySQL 5.7 å¼€å¯æ…¢æ—¥å¿—åå‘ç°æ—¥å¿—çš„æ—¶é—´ä¸ç³»ç»Ÿæ—¶é—´ç›¸å·®8å°æ—¶</p><br><p><strong>Time</strong>: <strong>2020-08-05T05:35:50.667976K</strong>ï¼Œå®é™…æ—¶é—´åº”è¯¥æ˜¯<strong>12:24:30</strong><br></p><p>è¿™æ˜¯ç”±äº<strong>log_timestamps</strong>è¿™ä¸ªå‚æ•°è®¾ç½®é€ æˆçš„ï¼ŒæŸ¥è¯¢å½“å‰è®¾ç½®<br></p><br><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;%log_time%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token operator">|</span> log_timestamps <span class="token operator">|</span> UTC   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>UTC</strong>æ˜¯ä¸–ç•Œç»Ÿä¸€æ—¶é—´ï¼Œè€Œç°åœ¨çš„ç³»ç»Ÿä¸ºåŒ—äº¬æ—¶é—´æ˜¯ä¸œå…«åŒºï¼Œæ¯”<strong>UTC</strong>æ—©äº†8ä¸ªå°æ—¶ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸º<strong>SYSTEM</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> log_timestamps<span class="token operator">=</span>SYSTEM<span class="token punctuation">;</span>

Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

 mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;%log_time%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+--------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------+</span>
<span class="token operator">|</span> log_timestamps <span class="token operator">|</span> SYSTEM <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,27),q=a(`<br><br><p>Mysql 5.7 æ—¶é—´å­—æ®µä¸å¾—ä¸ºç©ºæˆ–0000-00-00 00:00:00</p><p><strong>é—®é¢˜åŸå› ï¼š</strong></p><p><code>NO_ZERO_IN_DATE</code>,<code>NO_ZERO_DATE</code> é™åˆ¶æ— æ³•é»˜è®¤ä¸º <code>0000-00-00 00:00:</code>00</p><p><code>NO_ZERO_IN_DATE</code>ï¼šåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¸æ¥å—æœˆæˆ–æ—¥éƒ¨åˆ†ä¸º0çš„æ—¥æœŸ</p><p><code>NO_ZERO_DATE</code>ï¼šåœ¨ä¸¥æ ¼æ¨¡å¼ï¼Œ<code>0000-00-00</code>æŠ¥é”™</p><br><br><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><p>1ã€ä½¿ç”¨rootç™»é™†æ•°æ®åº“ï¼Œå‘½ä»¤ç•Œé¢æ‰§è¡Œ ï¼ŒæŸ¥çœ‹sql_mode</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> @<span class="token variable">@sql_mode</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token string">&#39;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¿®æ”¹ <code>sql_mode</code></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> sql_mode<span class="token operator">=</span><span class="token string">&#39;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_10-æ…¢æŸ¥è¯¢å¯è§†åŒ–å¸®åŠ©æ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#_10-æ…¢æŸ¥è¯¢å¯è§†åŒ–å¸®åŠ©æ–‡æ¡£" aria-hidden="true">#</a> 10. æ…¢æŸ¥è¯¢å¯è§†åŒ–å¸®åŠ©æ–‡æ¡£</h3>`,17),f={href:"https://www.jianshu.com/p/092fd6359e43",target:"_blank",rel:"noopener noreferrer"},w=a('<p>è¯¥ç³»ç»Ÿä½¿ç”¨pt-query-digestæœé›†æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œç›®å‰ç­–ç•¥æ˜¯æ¯10åˆ†é’Ÿæœé›†åˆ†æä¸€æ¬¡ã€‚</p><p>å°†æ•°æ®å­˜å‚¨åœ¨ä¸¤å¼ è¡¨ä¸­ï¼šè¯¥ç³»ç»Ÿä½¿ç”¨pt-query-digestæœé›†æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œç›®å‰ç­–ç•¥æ˜¯æ¯10åˆ†é’Ÿæœé›†åˆ†æä¸€æ¬¡ã€‚å°†æ•°æ®å­˜å‚¨åœ¨ä¸¤å¼ è¡¨ä¸­ï¼š<code>global_query_review</code> å’Œ <code>global_query_review_history</code>ã€‚å°†æ•°æ®å±•ç°å‡ºæ¥ï¼Œæ–¹ä¾¿æŸ¥è¯¢åˆ†æã€‚</p><br><p>è¡¨ç»“æ„</p><p><code>global_query_review</code> è¡¨ç»“æ„ï¼š</p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-35.png" alt="è¡¨ç»“æ„1" tabindex="0" loading="lazy"><figcaption>è¡¨ç»“æ„1</figcaption></figure><p><br><br></p><p><strong>ä¸»è¦å­—æ®µè¯´æ˜</strong>ï¼š</p><ul><li>checksum : ä¸»é”®ï¼Œæ˜¯æŒ‰fingerprintç®—å‡ºæ¥çš„hashå€¼</li><li>finger : æ˜¯æ¯æ¡sqlè¯­å¥çš„æŒ‡çº¹ï¼Œå»æ‰äº†ä¸€äº›å˜åŒ–çš„å€¼åŒä¸€ç±»å‹çš„sqlè¯­å¥ï¼Œæ¡ä»¶å€¼ä¸ä¸€æ ·åœ¨è¯¥è¡¨ä¸­åªä¼šå­˜åœ¨ä¸€æ¡è®°å½•</li><li>sample: ç¬¦åˆfingerçš„ä¸€æ¡sqlç¤ºä¾‹</li></ul><br><br><p><code>global_query_review_history</code> è¡¨ç»“æ„</p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-36.png" alt="è¡¨ç»“æ„2" tabindex="0" loading="lazy"><figcaption>è¡¨ç»“æ„2</figcaption></figure><p><strong>ä¸»è¦å­—æ®µè¯´æ˜</strong>ï¼š</p><ul><li><strong>hostname_max</strong> : MySQLæœåŠ¡æ‰€åœ¨ä¸»æœºåç§°</li><li><strong>db_max</strong>: æ•°æ®åº“åç§°</li><li><strong>checksum</strong> : åŒglobal_query_reviewè¡¨ä¸­çš„checksumï¼Œä¸¤å¼ è¡¨é€šè¿‡è¯¥å€¼å…³è”</li><li><strong>sample</strong> : sqlç¤ºä¾‹</li><li><strong>ts_min</strong> : æœ¬æ¬¡ç»Ÿè®¡(æ¯10åˆ†é’Ÿä¸€æ¬¡)è¯¥ç±»å‹sqlè¯­å¥å‡ºç°çš„æœ€å°æ—¶é—´</li><li><strong>ts_max</strong>: æœ¬æ¬¡ç»Ÿè®¡(æ¯10åˆ†é’Ÿä¸€æ¬¡)è¯¥ç±»å‹sqlè¯­å¥å‡ºç°çš„æœ€å¤§æ—¶é—´</li><li><strong>ts_cnt</strong> : æœ¬æ¬¡ç»Ÿè®¡è¯¥sqlè¯­å¥å‡ºç°çš„æ¬¡æ•°</li><li><strong>Query_time_sum</strong> : æœ¬æ¬¡ç»Ÿè®¡è¯¥ç±»å‹sqlè¯­å¥èŠ±è´¹çš„æ€»æ—¶é—´</li><li><strong>Query_time_min</strong> : æœ¬æ¬¡ç»Ÿè®¡è¯¥ç±»å‹sqlè¯­å¥æ‰§è¡Œæœ€å¿«çš„é‚£ä¸ªsqlè¯­å¥èŠ±è´¹çš„æ—¶é—´</li><li><strong>Query_time_max</strong>: æœ¬æ¬¡ç»Ÿè®¡è¯¥ç±»å‹sqlè¯­å¥æ‰§è¡Œæœ€æ…¢çš„é‚£ä¸ªsqlè¯­å¥èŠ±è´¹çš„æ—¶é—´</li><li><strong>Query_time_pct_95</strong>: æœ¬æ¬¡ç»Ÿè®¡è¯¥ç±»å‹sqlè¯­å¥æ‰§è¡Œæ—¶é—´ä½äº95%åˆ†ä½çš„sqlæ‰§è¡Œæ—¶é—´</li><li><strong>Query_time_stddev</strong>: æœ¬æ¬¡ç»Ÿè®¡è¯¥ç±»å‹sqlè¯­å¥æ‰§è¡Œæ—¶é—´æ ‡å‡†å·®ï¼ˆç»Ÿè®¡å­¦æ¦‚å¿µï¼‰</li><li><strong>Query_time_median</strong>: æœ¬æ¬¡ç»Ÿè®¡è¯¥ç±»å‹sqlè¯­å¥æ‰§è¡Œæ—¶é—´ä½äºä¸­ä½æ•°ä½ç½®çš„sqlæ‰§è¡Œæ—¶é—´</li><li><strong>index_ratio</strong>ï¼šè¡¨ç¤ºçš„æ˜¯æ‰«æçš„è¡Œæ•°/è¿”å›çš„ç»“æœè¡Œæ•°</li></ul><p><br><br></p><p><strong>Anemometer</strong> åº”ç”¨</p><p><strong>1.ä¸»é¡µé¢è¯´æ˜å¦‚ä¸‹</strong></p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-37.png" alt="ç•Œé¢1" loading="lazy"><br></p><p><strong>2.ç‚¹å‡»checksumå€¼è¿›å…¥åˆ†æé¡µé¢</strong></p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-38.png" alt="ç•Œé¢2" tabindex="0" loading="lazy"><figcaption>ç•Œé¢2</figcaption></figure><br><p><strong>ä¸‹é¢å›¾å½¢æ˜¯è¯¥é¡µé¢çš„ä¸­é—´éƒ¨åˆ†</strong></p><figure><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-DBA/Section6-1-39.png" alt="ç•Œé¢3" tabindex="0" loading="lazy"><figcaption>ç•Œé¢3</figcaption></figure>',24);function x(S,T){const e=p("ExternalLinkIcon");return o(),l("div",null,[c,s("p",null,[s("a",d,[n("Percona Toolkit 3.2.0"),t(e)])]),g,s("p",null,[s("a",u,[n("Anemometer"),t(e)]),n(" æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–æ˜¾ç¤ºMySQLæ…¢æ—¥å¿—çš„å·¥å…·ã€‚")]),b,s("p",null,[m,n("ï¼š"),s("a",v,[n("https://github.com/box/Anemometer"),t(e)])]),k,s("p",null,[s("a",h,[n("http://127.0.0.1/anemometer"),t(e)])]),_,n(),y,n(),q,s("p",null,[s("a",f,[n("æ–‡ç« æ¥æº"),t(e)])]),w])}const R=i(r,[["render",x],["__file","dba06.html.vue"]]);export{R as default};

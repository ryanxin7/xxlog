<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/k8s/log/kubernetes-1.html"><meta property="og:site_name" content="Ryan's Notebook"><meta property="og:title" content="1.kubernetes äºŒè¿›åˆ¶éƒ¨ç½²"><meta property="og:description" content="k8s-å®æˆ˜æ¡ˆä¾‹_v1.21.x-éƒ¨ç½².pdf 1.åŸºç¡€ç¯å¢ƒé…ç½® 1.1 æ—¶é—´åŒæ­¥ ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime cat /etc/default/locale LANG=en_US.UTF-8 LC_TIME=en_DK.UTF-8 */5 * * * * /usr/sbin/ntpdate time1.aliyun.com &amp;&gt; /dev/null &amp;&amp; hwclock -w/usr/sbin/ntpdate"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-03-01T10:28:19.000Z"><meta property="article:tag" content="k8sè¿›é˜¶è®­ç»ƒè¥"><meta property="article:published_time" content="2022-06-01T12:12:22.000Z"><meta property="article:modified_time" content="2023-03-01T10:28:19.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"1.kubernetes äºŒè¿›åˆ¶éƒ¨ç½²","image":[""],"datePublished":"2022-06-01T12:12:22.000Z","dateModified":"2023-03-01T10:28:19.000Z","author":[]}</script><title>1.kubernetes äºŒè¿›åˆ¶éƒ¨ç½² | Ryan's Notebook</title><meta name="description" content="k8s-å®æˆ˜æ¡ˆä¾‹_v1.21.x-éƒ¨ç½².pdf 1.åŸºç¡€ç¯å¢ƒé…ç½® 1.1 æ—¶é—´åŒæ­¥ ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime cat /etc/default/locale LANG=en_US.UTF-8 LC_TIME=en_DK.UTF-8 */5 * * * * /usr/sbin/ntpdate time1.aliyun.com &amp;&gt; /dev/null &amp;&amp; hwclock -w/usr/sbin/ntpdate">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-e9ac4e0d.css" as="style"><link rel="stylesheet" href="/assets/style-e9ac4e0d.css">
    <link rel="modulepreload" href="/assets/app-d46a28fe.js"><link rel="modulepreload" href="/assets/framework-91fce522.js"><link rel="modulepreload" href="/assets/kubernetes-1.html-aa6cbaae.js"><link rel="modulepreload" href="/assets/kubernetes-1.html-a5353502.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Ryan&#39;s Notebook"><!----><span class="site-name hide-in-pad">Ryan&#39;s Notebook</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="æ¿¼é‘«çš„çŸ¥è¯†åº“"><span class="font-icon icon iconfont icon-home" style=""></span>æ¿¼é‘«çš„çŸ¥è¯†åº“<!----></a></div><div class="nav-item hide-in-mobile"><a href="/category/" class="nav-link" aria-label="å½’æ¡£ğŸ—‚ï¸"><span class="font-icon icon iconfont icon-beaker" style=""></span>å½’æ¡£ğŸ—‚ï¸<!----></a></div><div class="nav-item hide-in-mobile"><a href="/article/" class="nav-link" aria-label="æ–‡ç« ğŸŒ±"><span class="font-icon icon iconfont icon-beaker" style=""></span>æ–‡ç« ğŸŒ±<!----></a></div><div class="nav-item hide-in-mobile"><a href="/timeline/" class="nav-link" aria-label="æ—¶é—´çº¿â°"><span class="font-icon icon iconfont icon-beaker" style=""></span>æ—¶é—´çº¿â°<!----></a></div><div class="nav-item hide-in-mobile"><a href="/about/" class="nav-link" aria-label="å…³äºğŸ¤·"><span class="font-icon icon iconfont icon-beaker" style=""></span>å…³äºğŸ¤·<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å°è®°ğŸ“Œ"><span class="title"><!---->å°è®°ğŸ“Œ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å°è®°</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/xj/" class="nav-link" aria-label="ä¸€äº›çŸ¥è¯†çš„ç¢ç‰‡ğŸŒ "><span class="font-icon icon iconfont icon-exercise" style=""></span>ä¸€äº›çŸ¥è¯†çš„ç¢ç‰‡ğŸŒ <!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å¸¸ç”¨å·¥å…·</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://imageresizer.com/" rel="noopener noreferrer" target="_blank" aria-label="å›¾ç‰‡å‹ç¼©" class="nav-link"><span class="font-icon icon iconfont icon-more" style=""></span>å›¾ç‰‡å‹ç¼©<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://www.flaticon.com/" rel="noopener noreferrer" target="_blank" aria-label="å…è´¹å›¾æ ‡ç´ æ" class="nav-link"><span class="font-icon icon iconfont icon-more" style=""></span>å…è´¹å›¾æ ‡ç´ æ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://emojipedia.org/" rel="noopener noreferrer" target="_blank" aria-label="emojipedia" class="nav-link"><span class="font-icon icon iconfont icon-more" style=""></span>emojipedia<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/ryanxin7/xxlog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">æœç´¢</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/" class="nav-link sidebar-link sidebar-page" aria-label="æ¿¼é‘«çš„çŸ¥è¯†åº“"><span class="font-icon icon iconfont icon-home" style=""></span>æ¿¼é‘«çš„çŸ¥è¯†åº“<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading active"><span class="font-icon icon iconfont icon-discover" style=""></span><span class="title"></span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/k8s/log/" class="nav-link sidebar-link sidebar-page" aria-label="K8S ç®€ä»‹"><span class="font-icon icon iconfont icon-creative" style=""></span>K8S ç®€ä»‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/k8s/log/kubernetes-1.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="1.kubernetes äºŒè¿›åˆ¶éƒ¨ç½²"><!---->1.kubernetes äºŒè¿›åˆ¶éƒ¨ç½²<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-åŸºç¡€ç¯å¢ƒé…ç½®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.åŸºç¡€ç¯å¢ƒé…ç½®"><!---->1.åŸºç¡€ç¯å¢ƒé…ç½®<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-1-æ—¶é—´åŒæ­¥" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.1 æ—¶é—´åŒæ­¥"><!---->1.1 æ—¶é—´åŒæ­¥<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-2-å®‰è£docker" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2  å®‰è£docker"><!---->1.2  å®‰è£docker<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-3-å®‰è£…ansible" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.3 å®‰è£…ansible"><!---->1.3 å®‰è£…ansible<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-4-é…ç½®é›†ç¾¤å…ç§˜é’¥ç™»å½•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.4 é…ç½®é›†ç¾¤å…ç§˜é’¥ç™»å½•"><!---->1.4 é…ç½®é›†ç¾¤å…ç§˜é’¥ç™»å½•<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-5-éƒ¨ç½²èŠ‚ç‚¹ä¸‹è½½kubeaszéƒ¨ç½²é¡¹ç›®åŠç»„ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.5 éƒ¨ç½²èŠ‚ç‚¹ä¸‹è½½kubeaszéƒ¨ç½²é¡¹â½¬åŠç»„ä»¶"><!---->1.5 éƒ¨ç½²èŠ‚ç‚¹ä¸‹è½½kubeaszéƒ¨ç½²é¡¹â½¬åŠç»„ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_2-éƒ¨ç½²-harbor-é•œåƒä»“åº“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.éƒ¨ç½² harbor é•œåƒä»“åº“"><!---->2.éƒ¨ç½² harbor é•œåƒä»“åº“<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_2-1-åˆ›å»ºè‡ªç­¾sslè¯ä¹¦" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1 åˆ›å»ºè‡ªç­¾sslè¯ä¹¦"><!---->2.1 åˆ›å»ºè‡ªç­¾sslè¯ä¹¦<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_2-2-ä¿®æ”¹harboré…ç½®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2 ä¿®æ”¹harboré…ç½®"><!---->2.2 ä¿®æ”¹harboré…ç½®<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_2-3-å®‰è£…harbor" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3 å®‰è£…harbor"><!---->2.3 å®‰è£…harbor<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_2-4-harbor-è°ƒè¯•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4 harbor è°ƒè¯•"><!---->2.4 harbor è°ƒè¯•<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_3-åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹"><!---->3.åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_3-1-ç”Ÿæˆk8sé›†ç¾¤-hostsæ–‡ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1 â½£æˆk8sé›†ç¾¤ hostsâ½‚ä»¶"><!---->3.1 â½£æˆk8sé›†ç¾¤ hostsâ½‚ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_3-1-ç”Ÿæˆk8sé›†ç¾¤-config-æ–‡ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1 â½£æˆk8sé›†ç¾¤ config â½‚ä»¶"><!---->3.1 â½£æˆk8sé›†ç¾¤ config â½‚ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_4-æ­¥éª¤1-åŸºç¡€ç¯å¢ƒåˆå§‹åŒ–" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.æ­¥éª¤1-åŸºç¡€ç¯å¢ƒåˆå§‹åŒ–"><!---->4.æ­¥éª¤1-åŸºç¡€ç¯å¢ƒåˆå§‹åŒ–<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_5-æ­¥éª¤2-éƒ¨ç½²etcdé›†ç¾¤" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.æ­¥éª¤2-éƒ¨ç½²etcdé›†ç¾¤"><!---->5.æ­¥éª¤2-éƒ¨ç½²etcdé›†ç¾¤<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_6-æ­¥éª¤3-éƒ¨ç½²è¿è¡Œæ—¶ç¯å¢ƒ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.æ­¥éª¤3-éƒ¨ç½²è¿è¡Œæ—¶ç¯å¢ƒ"><!---->6.æ­¥éª¤3-éƒ¨ç½²è¿è¡Œæ—¶ç¯å¢ƒ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_6-1-kubeasz-é›†æˆå®‰è£…-containerd" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1 kubeasz é›†æˆå®‰è£… containerd"><!---->6.1 kubeasz é›†æˆå®‰è£… containerd<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_6-2-é…ç½®containerd-å¯¹æ¥ç§æœ‰harborä»“åº“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2 é…ç½®containerd å¯¹æ¥ç§æœ‰harborä»“åº“"><!---->6.2 é…ç½®containerd å¯¹æ¥ç§æœ‰harborä»“åº“<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_6-3-containerd-ä½¿ç”¨è¯ä¹¦å¯¹æ¥harborå®ç°ä¸Šä¼ ä¸‹è½½" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3 containerd ä½¿ç”¨è¯ä¹¦å¯¹æ¥harborå®ç°ä¸Šä¼ ä¸‹è½½"><!---->6.3 containerd ä½¿ç”¨è¯ä¹¦å¯¹æ¥harborå®ç°ä¸Šä¼ ä¸‹è½½<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_7-æ­¥éª¤4-éƒ¨ç½²master" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.æ­¥éª¤4-éƒ¨ç½²master"><!---->7.æ­¥éª¤4-éƒ¨ç½²master<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_8-æ­¥éª¤5-éƒ¨ç½²nodeèŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.æ­¥éª¤5-éƒ¨ç½²nodeèŠ‚ç‚¹"><!---->8.æ­¥éª¤5-éƒ¨ç½²nodeèŠ‚ç‚¹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_9-æ­¥éª¤6-éƒ¨ç½²ç½‘ç»œç»„ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.æ­¥éª¤6-éƒ¨ç½²ç½‘ç»œç»„ä»¶"><!---->9.æ­¥éª¤6-éƒ¨ç½²ç½‘ç»œç»„ä»¶<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_9-1-ä½¿ç”¨calicoç½‘ç»œç»„ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.1 ä½¿â½¤calicoâ½¹ç»œç»„ä»¶"><!---->9.1 ä½¿â½¤calicoâ½¹ç»œç»„ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_9-2-éªŒè¯calicoç½‘ç»œ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.2 éªŒè¯calicoç½‘ç»œ"><!---->9.2 éªŒè¯calicoç½‘ç»œ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_9-3-æŸ¥çœ‹æ‰€æœ‰calicoèŠ‚ç‚¹çŠ¶æ€" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.3 æŸ¥çœ‹æ‰€æœ‰calicoèŠ‚ç‚¹çŠ¶æ€"><!---->9.3 æŸ¥çœ‹æ‰€æœ‰calicoèŠ‚ç‚¹çŠ¶æ€<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_9-4-åˆ›å»ºå®¹å™¨æµ‹è¯•ç½‘ç»œé€šä¿¡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9.4 åˆ›å»ºå®¹å™¨æµ‹è¯•ç½‘ç»œé€šä¿¡"><!---->9.4 åˆ›å»ºå®¹å™¨æµ‹è¯•ç½‘ç»œé€šä¿¡<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-æ­¥éª¤7-å®‰è£…é›†ç¾¤æ’ä»¶-coredns" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.æ­¥éª¤7-å®‰è£…é›†ç¾¤æ’ä»¶-coredns"><!---->10.æ­¥éª¤7-å®‰è£…é›†ç¾¤æ’ä»¶-coredns<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-1-ä¸‹è½½äºŒè¿›åˆ¶åŒ…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.1 ä¸‹è½½äºŒè¿›åˆ¶åŒ…"><!---->10.1 ä¸‹è½½äºŒè¿›åˆ¶åŒ…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-2-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.2 ä¿®æ”¹é…ç½®æ–‡ä»¶"><!---->10.2 ä¿®æ”¹é…ç½®æ–‡ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-3-ä¸‹è½½é•œåƒå¹¶æ¨é€åˆ°harbor" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.3 ä¸‹è½½é•œåƒå¹¶æ¨é€åˆ°harbor"><!---->10.3 ä¸‹è½½é•œåƒå¹¶æ¨é€åˆ°harbor<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-4-å®‰è£…coredns" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.4 å®‰è£…coredns"><!---->10.4 å®‰è£…coredns<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-5-å¯åŠ¨å®¹å™¨æµ‹è¯•åŸŸåè§£æ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.5 å¯åŠ¨å®¹å™¨æµ‹è¯•åŸŸåè§£æ"><!---->10.5 å¯åŠ¨å®¹å™¨æµ‹è¯•åŸŸåè§£æ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-6-æµ‹è¯•-prometheus-ç›‘æ§é¡¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10.6 æµ‹è¯• prometheus ç›‘æ§é¡¹"><!---->10.6 æµ‹è¯• prometheus ç›‘æ§é¡¹<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-æ­¥éª¤8-å®‰è£…é›†ç¾¤æ’ä»¶-dashboard" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11. æ­¥éª¤8-å®‰è£…é›†ç¾¤æ’ä»¶-dashboard"><!---->11. æ­¥éª¤8-å®‰è£…é›†ç¾¤æ’ä»¶-dashboard<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-1-ä¸‹è½½å¯¹åº”kubernetesç‰ˆæœ¬çš„dashboard" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.1 ä¸‹è½½å¯¹åº”kubernetesç‰ˆæœ¬çš„dashboard"><!---->11.1 ä¸‹è½½å¯¹åº”kubernetesç‰ˆæœ¬çš„dashboard<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-2-ä¿®æ”¹serviceæš´éœ²æ–¹å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.2 ä¿®æ”¹serviceæš´éœ²æ–¹å¼"><!---->11.2 ä¿®æ”¹serviceæš´éœ²æ–¹å¼<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-3-ä¸‹è½½é•œåƒæ¨é€åˆ°harbor" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.3 ä¸‹è½½é•œåƒæ¨é€åˆ°harbor"><!---->11.3 ä¸‹è½½é•œåƒæ¨é€åˆ°harbor<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-4-ä¿®æ”¹é•œåƒåœ°å€" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.4 ä¿®æ”¹é•œåƒåœ°å€"><!---->11.4 ä¿®æ”¹é•œåƒåœ°å€<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-5-å®‰è£…dashboardç»„ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.5 å®‰è£…dashboardç»„ä»¶"><!---->11.5 å®‰è£…dashboardç»„ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-6-æŸ¥çœ‹ç»„ä»¶è¿è¡ŒçŠ¶æ€" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.6 æŸ¥çœ‹ç»„ä»¶è¿è¡ŒçŠ¶æ€"><!---->11.6 æŸ¥çœ‹ç»„ä»¶è¿è¡ŒçŠ¶æ€<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-7-è·å–ç™»é™†-token" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.7 è·å–ç™»é™† token"><!---->11.7 è·å–ç™»é™† token<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-8-ç™»å½•æµ‹è¯•" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11.8 ç™»å½•æµ‹è¯•"><!---->11.8 ç™»å½•æµ‹è¯•<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_12-é›†ç¾¤ç®¡ç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="12. é›†ç¾¤ç®¡ç†"><!---->12. é›†ç¾¤ç®¡ç†<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_12-1-æ·»åŠ nodeèŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="12.1 æ·»åŠ nodeèŠ‚ç‚¹"><!---->12.1 æ·»åŠ nodeèŠ‚ç‚¹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_12-2-æ·»åŠ master-èŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="12.2 æ·»åŠ master èŠ‚ç‚¹"><!---->12.2 æ·»åŠ master èŠ‚ç‚¹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_12-3-éªŒè¯å½“å‰èŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="12.3 éªŒè¯å½“å‰èŠ‚ç‚¹"><!---->12.3 éªŒè¯å½“å‰èŠ‚ç‚¹<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_13-é›†ç¾¤å‡çº§" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="13. é›†ç¾¤å‡çº§"><!---->13. é›†ç¾¤å‡çº§<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_13-1-å‡çº§masterèŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="13.1 å‡çº§masterèŠ‚ç‚¹"><!---->13.1 å‡çº§masterèŠ‚ç‚¹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_13-2-å‡çº§nodeèŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="13.2 å‡çº§nodeèŠ‚ç‚¹"><!---->13.2 å‡çº§nodeèŠ‚ç‚¹<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-2.html" class="nav-link sidebar-link sidebar-page" aria-label="2.etcd å®¢æˆ·ç«¯ä½¿ç”¨ã€æ•°æ®å¤‡ä»½ä¸æ¢å¤"><!---->2.etcd å®¢æˆ·ç«¯ä½¿ç”¨ã€æ•°æ®å¤‡ä»½ä¸æ¢å¤<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-3.html" class="nav-link sidebar-link sidebar-page" aria-label="3. yamlæ–‡ä»¶è¯­æ³•åŸºç¡€"><!---->3. yamlæ–‡ä»¶è¯­æ³•åŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-4.html" class="nav-link sidebar-link sidebar-page" aria-label="4.kubernetesAPIèµ„æºå¯¹è±¡"><!---->4.kubernetesAPIèµ„æºå¯¹è±¡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-5.html" class="nav-link sidebar-link sidebar-page" aria-label="5.k8så®æˆ˜æ¡ˆä¾‹-nginxä¸tomcatå®ç°åŠ¨é™åˆ†ç¦»"><!---->5.k8så®æˆ˜æ¡ˆä¾‹-nginxä¸tomcatå®ç°åŠ¨é™åˆ†ç¦»<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-6.html" class="nav-link sidebar-link sidebar-page" aria-label="6.k8sä½¿ç”¨cephå®ç°æ•°æ®æŒä¹…åŒ–"><!---->6.k8sä½¿ç”¨cephå®ç°æ•°æ®æŒä¹…åŒ–<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-7.html" class="nav-link sidebar-link sidebar-page" aria-label="7.Podçš„çŠ¶æ€å’Œæ¢é’ˆ"><!---->7.Podçš„çŠ¶æ€å’Œæ¢é’ˆ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-8.html" class="nav-link sidebar-link sidebar-page" aria-label="8.å®æˆ˜æ¡ˆä¾‹-åŸºäºStatefulSetMySQLä¸»ä»æ¶æ„"><!---->8.å®æˆ˜æ¡ˆä¾‹-åŸºäºStatefulSetMySQLä¸»ä»æ¶æ„<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-9.html" class="nav-link sidebar-link sidebar-page" aria-label="9.å®æˆ˜æ¡ˆä¾‹-è¿è¡Œjavaåº”ç”¨"><!---->9.å®æˆ˜æ¡ˆä¾‹-è¿è¡Œjavaåº”ç”¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-10.html" class="nav-link sidebar-link sidebar-page" aria-label="10.å®æˆ˜æ¡ˆä¾‹-WordPress"><!---->10.å®æˆ˜æ¡ˆä¾‹-WordPress<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-11.html" class="nav-link sidebar-link sidebar-page" aria-label="11.å®æˆ˜æ¡ˆä¾‹-åŸºäºzookeeperå®ç°å¾®æœåŠ¡åŠ¨æ€æ³¨å†Œå’Œå‘ç°"><!---->11.å®æˆ˜æ¡ˆä¾‹-åŸºäºzookeeperå®ç°å¾®æœåŠ¡åŠ¨æ€æ³¨å†Œå’Œå‘ç°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-12.html" class="nav-link sidebar-link sidebar-page" aria-label="12.ingress å®ç°åŸºäºåŸŸåçš„å¤šè™šæ‹Ÿä¸»æœº,URLè½¬å‘åŠå¤šåŸŸåHTTPSå®ç°æ¡ˆä¾‹"><!---->12.ingress å®ç°åŸºäºåŸŸåçš„å¤šè™šæ‹Ÿä¸»æœº,URLè½¬å‘åŠå¤šåŸŸåHTTPSå®ç°æ¡ˆä¾‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-13.html" class="nav-link sidebar-link sidebar-page" aria-label="13.HPAè‡ªåŠ¨ä¼¸ç¼©podæ•°é‡"><!---->13.HPAè‡ªåŠ¨ä¼¸ç¼©podæ•°é‡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-14.html" class="nav-link sidebar-link sidebar-page" aria-label="14.K8S æŒç»­é›†æˆä¸éƒ¨ç½²"><!---->14.K8S æŒç»­é›†æˆä¸éƒ¨ç½²<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->1.kubernetes äºŒè¿›åˆ¶éƒ¨ç½²</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="http://ryanxin.live" target="_blank" rel="noopener noreferrer">Ryan</a></span><span property="author" content="Ryan"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-06-01T12:12:22.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 35 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT35M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category7 clickable" role="navigation">k8s</span><meta property="articleSection" content="k8s"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag5 clickable" role="navigation">k8sè¿›é˜¶è®­ç»ƒè¥</span><meta property="keywords" content="k8sè¿›é˜¶è®­ç»ƒè¥"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-åŸºç¡€ç¯å¢ƒé…ç½®" class="router-link-active router-link-exact-active toc-link level2">1.åŸºç¡€ç¯å¢ƒé…ç½®</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-1-æ—¶é—´åŒæ­¥" class="router-link-active router-link-exact-active toc-link level3">1.1 æ—¶é—´åŒæ­¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-2-å®‰è£docker" class="router-link-active router-link-exact-active toc-link level3">1.2  å®‰è£docker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-3-å®‰è£…ansible" class="router-link-active router-link-exact-active toc-link level3">1.3 å®‰è£…ansible</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-4-é…ç½®é›†ç¾¤å…ç§˜é’¥ç™»å½•" class="router-link-active router-link-exact-active toc-link level3">1.4 é…ç½®é›†ç¾¤å…ç§˜é’¥ç™»å½•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_1-5-éƒ¨ç½²èŠ‚ç‚¹ä¸‹è½½kubeaszéƒ¨ç½²é¡¹ç›®åŠç»„ä»¶" class="router-link-active router-link-exact-active toc-link level3">1.5 éƒ¨ç½²èŠ‚ç‚¹ä¸‹è½½kubeaszéƒ¨ç½²é¡¹â½¬åŠç»„ä»¶</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_2-éƒ¨ç½²-harbor-é•œåƒä»“åº“" class="router-link-active router-link-exact-active toc-link level2">2.éƒ¨ç½² harbor é•œåƒä»“åº“</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_2-1-åˆ›å»ºè‡ªç­¾sslè¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">2.1 åˆ›å»ºè‡ªç­¾sslè¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_2-2-ä¿®æ”¹harboré…ç½®" class="router-link-active router-link-exact-active toc-link level3">2.2 ä¿®æ”¹harboré…ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_2-3-å®‰è£…harbor" class="router-link-active router-link-exact-active toc-link level3">2.3 å®‰è£…harbor</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_2-4-harbor-è°ƒè¯•" class="router-link-active router-link-exact-active toc-link level3">2.4 harbor è°ƒè¯•</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_3-åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹" class="router-link-active router-link-exact-active toc-link level2">3.åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_3-1-ç”Ÿæˆk8sé›†ç¾¤-hostsæ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">3.1 â½£æˆk8sé›†ç¾¤ hostsâ½‚ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_3-1-ç”Ÿæˆk8sé›†ç¾¤-config-æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">3.1 â½£æˆk8sé›†ç¾¤ config â½‚ä»¶</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_4-æ­¥éª¤1-åŸºç¡€ç¯å¢ƒåˆå§‹åŒ–" class="router-link-active router-link-exact-active toc-link level2">4.æ­¥éª¤1-åŸºç¡€ç¯å¢ƒåˆå§‹åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_5-æ­¥éª¤2-éƒ¨ç½²etcdé›†ç¾¤" class="router-link-active router-link-exact-active toc-link level2">5.æ­¥éª¤2-éƒ¨ç½²etcdé›†ç¾¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_6-æ­¥éª¤3-éƒ¨ç½²è¿è¡Œæ—¶ç¯å¢ƒ" class="router-link-active router-link-exact-active toc-link level2">6.æ­¥éª¤3-éƒ¨ç½²è¿è¡Œæ—¶ç¯å¢ƒ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_6-1-kubeasz-é›†æˆå®‰è£…-containerd" class="router-link-active router-link-exact-active toc-link level3">6.1 kubeasz é›†æˆå®‰è£… containerd</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_6-2-é…ç½®containerd-å¯¹æ¥ç§æœ‰harborä»“åº“" class="router-link-active router-link-exact-active toc-link level3">6.2 é…ç½®containerd å¯¹æ¥ç§æœ‰harborä»“åº“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_6-3-containerd-ä½¿ç”¨è¯ä¹¦å¯¹æ¥harborå®ç°ä¸Šä¼ ä¸‹è½½" class="router-link-active router-link-exact-active toc-link level3">6.3 containerd ä½¿ç”¨è¯ä¹¦å¯¹æ¥harborå®ç°ä¸Šä¼ ä¸‹è½½</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_7-æ­¥éª¤4-éƒ¨ç½²master" class="router-link-active router-link-exact-active toc-link level2">7.æ­¥éª¤4-éƒ¨ç½²master</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_8-æ­¥éª¤5-éƒ¨ç½²nodeèŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level2">8.æ­¥éª¤5-éƒ¨ç½²nodeèŠ‚ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_9-æ­¥éª¤6-éƒ¨ç½²ç½‘ç»œç»„ä»¶" class="router-link-active router-link-exact-active toc-link level2">9.æ­¥éª¤6-éƒ¨ç½²ç½‘ç»œç»„ä»¶</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_9-1-ä½¿ç”¨calicoç½‘ç»œç»„ä»¶" class="router-link-active router-link-exact-active toc-link level3">9.1 ä½¿â½¤calicoâ½¹ç»œç»„ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_9-2-éªŒè¯calicoç½‘ç»œ" class="router-link-active router-link-exact-active toc-link level3">9.2 éªŒè¯calicoç½‘ç»œ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_9-3-æŸ¥çœ‹æ‰€æœ‰calicoèŠ‚ç‚¹çŠ¶æ€" class="router-link-active router-link-exact-active toc-link level3">9.3 æŸ¥çœ‹æ‰€æœ‰calicoèŠ‚ç‚¹çŠ¶æ€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_9-4-åˆ›å»ºå®¹å™¨æµ‹è¯•ç½‘ç»œé€šä¿¡" class="router-link-active router-link-exact-active toc-link level3">9.4 åˆ›å»ºå®¹å™¨æµ‹è¯•ç½‘ç»œé€šä¿¡</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-æ­¥éª¤7-å®‰è£…é›†ç¾¤æ’ä»¶-coredns" class="router-link-active router-link-exact-active toc-link level2">10.æ­¥éª¤7-å®‰è£…é›†ç¾¤æ’ä»¶-coredns</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-1-ä¸‹è½½äºŒè¿›åˆ¶åŒ…" class="router-link-active router-link-exact-active toc-link level3">10.1 ä¸‹è½½äºŒè¿›åˆ¶åŒ…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-2-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">10.2 ä¿®æ”¹é…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-3-ä¸‹è½½é•œåƒå¹¶æ¨é€åˆ°harbor" class="router-link-active router-link-exact-active toc-link level3">10.3 ä¸‹è½½é•œåƒå¹¶æ¨é€åˆ°harbor</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-4-å®‰è£…coredns" class="router-link-active router-link-exact-active toc-link level3">10.4 å®‰è£…coredns</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-5-å¯åŠ¨å®¹å™¨æµ‹è¯•åŸŸåè§£æ" class="router-link-active router-link-exact-active toc-link level3">10.5 å¯åŠ¨å®¹å™¨æµ‹è¯•åŸŸåè§£æ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_10-6-æµ‹è¯•-prometheus-ç›‘æ§é¡¹" class="router-link-active router-link-exact-active toc-link level3">10.6 æµ‹è¯• prometheus ç›‘æ§é¡¹</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-æ­¥éª¤8-å®‰è£…é›†ç¾¤æ’ä»¶-dashboard" class="router-link-active router-link-exact-active toc-link level2">11. æ­¥éª¤8-å®‰è£…é›†ç¾¤æ’ä»¶-dashboard</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-1-ä¸‹è½½å¯¹åº”kubernetesç‰ˆæœ¬çš„dashboard" class="router-link-active router-link-exact-active toc-link level3">11.1 ä¸‹è½½å¯¹åº”kubernetesç‰ˆæœ¬çš„dashboard</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-2-ä¿®æ”¹serviceæš´éœ²æ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">11.2 ä¿®æ”¹serviceæš´éœ²æ–¹å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-3-ä¸‹è½½é•œåƒæ¨é€åˆ°harbor" class="router-link-active router-link-exact-active toc-link level3">11.3 ä¸‹è½½é•œåƒæ¨é€åˆ°harbor</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-4-ä¿®æ”¹é•œåƒåœ°å€" class="router-link-active router-link-exact-active toc-link level3">11.4 ä¿®æ”¹é•œåƒåœ°å€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-5-å®‰è£…dashboardç»„ä»¶" class="router-link-active router-link-exact-active toc-link level3">11.5 å®‰è£…dashboardç»„ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-6-æŸ¥çœ‹ç»„ä»¶è¿è¡ŒçŠ¶æ€" class="router-link-active router-link-exact-active toc-link level3">11.6 æŸ¥çœ‹ç»„ä»¶è¿è¡ŒçŠ¶æ€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-7-è·å–ç™»é™†-token" class="router-link-active router-link-exact-active toc-link level3">11.7 è·å–ç™»é™† token</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_11-8-ç™»å½•æµ‹è¯•" class="router-link-active router-link-exact-active toc-link level3">11.8 ç™»å½•æµ‹è¯•</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_12-é›†ç¾¤ç®¡ç†" class="router-link-active router-link-exact-active toc-link level2">12. é›†ç¾¤ç®¡ç†</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_12-1-æ·»åŠ nodeèŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level3">12.1 æ·»åŠ nodeèŠ‚ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_12-2-æ·»åŠ master-èŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level3">12.2 æ·»åŠ master èŠ‚ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_12-3-éªŒè¯å½“å‰èŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level3">12.3 éªŒè¯å½“å‰èŠ‚ç‚¹</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_13-é›†ç¾¤å‡çº§" class="router-link-active router-link-exact-active toc-link level2">13. é›†ç¾¤å‡çº§</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_13-1-å‡çº§masterèŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level3">13.1 å‡çº§masterèŠ‚ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-1.html#_13-2-å‡çº§nodeèŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level3">13.2 å‡çº§nodeèŠ‚ç‚¹</a></li><!----><!--]--></ul><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p><a href="https://www.yuque.com/attachments/yuque/0/2023/pdf/33538388/1672721011349-4455b094-61ee-4956-a375-07ad6fc387a1.pdf" target="_blank" rel="noopener noreferrer">k8s-å®æˆ˜æ¡ˆä¾‹_v1.21.x-éƒ¨ç½².pdf<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a name="lXlPc"></a></p><h2 id="_1-åŸºç¡€ç¯å¢ƒé…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-åŸºç¡€ç¯å¢ƒé…ç½®" aria-hidden="true">#</a> 1.åŸºç¡€ç¯å¢ƒé…ç½®</h2><p><a name="jRBYX"></a></p><h3 id="_1-1-æ—¶é—´åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_1-1-æ—¶é—´åŒæ­¥" aria-hidden="true">#</a> 1.1 æ—¶é—´åŒæ­¥</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ln</span> <span class="token parameter variable">-sf</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime

<span class="token function">cat</span> /etc/default/locale
<span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>en_US.UTF-8
<span class="token assign-left variable"><span class="token environment constant">LC_TIME</span></span><span class="token operator">=</span>en_DK.UTF-8 


*/5 * * * * /usr/sbin/ntpdate time1.aliyun.com <span class="token operator">&amp;&gt;</span> /dev/null <span class="token operator">&amp;&amp;</span> hwclock -w/usr/sbin/ntpdate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="EzULz"></a></p><h3 id="_1-2-å®‰è£docker" tabindex="-1"><a class="header-anchor" href="#_1-2-å®‰è£docker" aria-hidden="true">#</a> 1.2 å®‰è£docker</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/home/ceamg<span class="token comment"># cd /apps/docker/</span>
root@master01:/apps/docker<span class="token comment"># tar xvf docker-19.03.15-binary-install.tar.gz</span>
root@master01:/apps/docker<span class="token comment"># ll</span>
total <span class="token number">153128</span>
drwxr-xr-x <span class="token number">2</span> root root     <span class="token number">4096</span> Apr <span class="token number">11</span>  <span class="token number">2021</span> ./
drwxr-xr-x <span class="token number">3</span> root root     <span class="token number">4096</span> Jan  <span class="token number">2</span> 03:52 <span class="token punctuation">..</span>/
-rw-r--r-- <span class="token number">1</span> root root      <span class="token number">647</span> Apr <span class="token number">11</span>  <span class="token number">2021</span> containerd.service
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">78156440</span> Jan  <span class="token number">2</span> 03:57 docker-19.03.15-binary-install.tar.gz
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">62436240</span> Feb  <span class="token number">5</span>  <span class="token number">2021</span> docker-19.03.15.tgz
-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">16168192</span> Jun <span class="token number">24</span>  <span class="token number">2019</span> docker-compose-Linux-x86_64_1.24.1*
-rwxr-xr-x <span class="token number">1</span> root root     <span class="token number">2708</span> Apr <span class="token number">11</span>  <span class="token number">2021</span> docker-install.sh*
-rw-r--r-- <span class="token number">1</span> root root     <span class="token number">1683</span> Apr <span class="token number">11</span>  <span class="token number">2021</span> docker.service
-rw-r--r-- <span class="token number">1</span> root root      <span class="token number">197</span> Apr <span class="token number">11</span>  <span class="token number">2021</span> docker.socket
-rw-r--r-- <span class="token number">1</span> root root      <span class="token number">454</span> Apr <span class="token number">11</span>  <span class="token number">2021</span> limits.conf
-rw-r--r-- <span class="token number">1</span> root root      <span class="token number">257</span> Apr <span class="token number">11</span>  <span class="token number">2021</span> sysctl.conf

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">DIR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
<span class="token assign-left variable">PACKAGE_NAME</span><span class="token operator">=</span><span class="token string">&quot;docker-19.03.15.tgz&quot;</span>
<span class="token assign-left variable">DOCKER_FILE</span><span class="token operator">=</span><span class="token variable">${DIR}</span>/<span class="token variable">${PACKAGE_NAME}</span>
<span class="token function-name function">centos_install_docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">grep</span> <span class="token string">&quot;Kernel&quot;</span> /etc/issue <span class="token operator">&amp;&gt;</span> /dev/null
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    /bin/echo  <span class="token string">&quot;å½“å‰ç³»ç»Ÿæ˜¯<span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /etc/redhat-release<span class="token variable">`</span></span>,å³å°†å¼€å§‹ç³»ç»Ÿåˆå§‹åŒ–ã€é…ç½®docker-composeä¸å®‰è£…docker&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    systemctl stop firewalld <span class="token operator">&amp;&amp;</span> systemctl disable firewalld <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;é˜²ç«å¢™å·²å…³é—­&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    systemctl stop NetworkManager <span class="token operator">&amp;&amp;</span> systemctl disable NetworkManager <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;NetworkManager&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;</span> /etc/sysconfig/selinux <span class="token operator">&amp;&amp;</span> setenforce  <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;selinux å·²å…³é—­&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token punctuation">\</span>cp <span class="token variable">${DIR}</span>/limits.conf /etc/security/limits.conf
    <span class="token punctuation">\</span>cp <span class="token variable">${DIR}</span>/sysctl.conf /etc/sysctl.conf

    /bin/tar xvf <span class="token variable">${DOCKER_FILE}</span>
    <span class="token punctuation">\</span>cp docker/*  /usr/bin

    <span class="token punctuation">\</span>cp containerd.service /lib/systemd/system/containerd.service
    <span class="token punctuation">\</span>cp docker.service  /lib/systemd/system/docker.service
    <span class="token punctuation">\</span>cp docker.socket /lib/systemd/system/docker.socket

    <span class="token punctuation">\</span>cp <span class="token variable">${DIR}</span>/docker-compose-Linux-x86_64_1.24.1 /usr/bin/docker-compose

    <span class="token function">groupadd</span> <span class="token function">docker</span> <span class="token operator">&amp;&amp;</span> <span class="token function">useradd</span> <span class="token function">docker</span> <span class="token parameter variable">-g</span> <span class="token function">docker</span>
    <span class="token function">id</span> <span class="token parameter variable">-u</span>  magedu <span class="token operator">&amp;&gt;</span> /dev/null
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
      <span class="token function">useradd</span> magedu
      <span class="token function">usermod</span> magedu <span class="token parameter variable">-G</span> <span class="token function">docker</span>
    <span class="token keyword">fi</span>
    systemctl  <span class="token builtin class-name">enable</span> containerd.service <span class="token operator">&amp;&amp;</span> systemctl  restart containerd.service
    systemctl  <span class="token builtin class-name">enable</span> docker.service <span class="token operator">&amp;&amp;</span> systemctl  restart docker.service
    systemctl  <span class="token builtin class-name">enable</span> docker.socket <span class="token operator">&amp;&amp;</span> systemctl  restart docker.socket
  <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">ubuntu_install_docker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">grep</span> <span class="token string">&quot;Ubuntu&quot;</span> /etc/issue <span class="token operator">&amp;&gt;</span> /dev/null
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    /bin/echo  <span class="token string">&quot;å½“å‰ç³»ç»Ÿæ˜¯<span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /etc/issue<span class="token variable">`</span></span>,å³å°†å¼€å§‹ç³»ç»Ÿåˆå§‹åŒ–ã€é…ç½®docker-composeä¸å®‰è£…docker&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token punctuation">\</span>cp <span class="token variable">${DIR}</span>/limits.conf /etc/security/limits.conf
    <span class="token punctuation">\</span>cp <span class="token variable">${DIR}</span>/sysctl.conf /etc/sysctl.conf

    /bin/tar xvf <span class="token variable">${DOCKER_FILE}</span>
    <span class="token punctuation">\</span>cp docker/*  /usr/bin

    <span class="token punctuation">\</span>cp containerd.service /lib/systemd/system/containerd.service
    <span class="token punctuation">\</span>cp docker.service  /lib/systemd/system/docker.service
    <span class="token punctuation">\</span>cp docker.socket /lib/systemd/system/docker.socket

    <span class="token punctuation">\</span>cp <span class="token variable">${DIR}</span>/docker-compose-Linux-x86_64_1.24.1 /usr/bin/docker-compose
    <span class="token builtin class-name">ulimit</span>  <span class="token parameter variable">-n</span> <span class="token number">1000000</span>
    /bin/su <span class="token parameter variable">-c</span> -  ceamg <span class="token string">&quot;ulimit -n 1000000&quot;</span>
    /bin/echo <span class="token string">&quot;docker å®‰è£…å®Œæˆ!&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token function">id</span> <span class="token parameter variable">-u</span>  magedu <span class="token operator">&amp;&gt;</span> /dev/null
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
      <span class="token function">groupadd</span>  <span class="token parameter variable">-r</span> <span class="token function">docker</span>
      <span class="token function">useradd</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-m</span> <span class="token parameter variable">-g</span> <span class="token function">docker</span> <span class="token function">docker</span>
    <span class="token keyword">fi</span>
    systemctl  <span class="token builtin class-name">enable</span> containerd.service <span class="token operator">&amp;&amp;</span> systemctl  restart containerd.service
    systemctl  <span class="token builtin class-name">enable</span> docker.service <span class="token operator">&amp;&amp;</span> systemctl  restart docker.service
    systemctl  <span class="token builtin class-name">enable</span> docker.socket <span class="token operator">&amp;&amp;</span> systemctl  restart docker.socket
  <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  centos_install_docker
  ubuntu_install_docker
<span class="token punctuation">}</span>

main

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">&#39;EOF&#39;
{
  &quot;registry-mirrors&quot;: [&quot;https://lc2kkql3.mirror.aliyuncs.com&quot;],
   &quot;storage-driver&quot;: &quot;overlay&quot;,
   &quot;data-root&quot;: &quot;/data/docker&quot;
}
EOF</span>
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:~<span class="token comment"># cat /etc/sysctl.conf </span>
<span class="token assign-left variable">net.ipv4.ip_forward</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">vm.max_map_count</span><span class="token operator">=</span><span class="token number">262144</span>
<span class="token assign-left variable">kernel.pid_max</span><span class="token operator">=</span><span class="token number">4194303</span>
fs.file-max<span class="token operator">=</span><span class="token number">1000000</span>
<span class="token assign-left variable">net.ipv4.tcp_max_tw_buckets</span><span class="token operator">=</span><span class="token number">6000</span>
<span class="token assign-left variable">net.netfilter.nf_conntrack_max</span><span class="token operator">=</span><span class="token number">2097152</span>

net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
<span class="token assign-left variable">vm.swappiness</span><span class="token operator">=</span><span class="token number">0</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/apps/docker<span class="token comment"># bash docker-install.sh </span>
å½“å‰ç³»ç»Ÿæ˜¯Ubuntu <span class="token number">20.04</span>.3 LTS <span class="token punctuation">\</span>n <span class="token punctuation">\</span>l,å³å°†å¼€å§‹ç³»ç»Ÿåˆå§‹åŒ–ã€é…ç½®docker-composeä¸å®‰è£…docker
docker/
docker/dockerd
docker/docker-proxy
docker/containerd-shim
docker/docker-init
docker/docker
docker/runc
docker/ctr
docker/containerd
su: user jack does not exist
<span class="token function">docker</span> å®‰è£…å®Œæˆ<span class="token operator">!</span>
Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service â†’ /lib/systemd/system/containerd.service.
Created symlink /etc/systemd/system/multi-user.target.wants/docker.service â†’ /lib/systemd/system/docker.service.
Created symlink /etc/systemd/system/sockets.target.wants/docker.socket â†’ /lib/systemd/system/docker.socket.

<span class="token function">reboot</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="hX7ex"></a></p><h3 id="_1-3-å®‰è£…ansible" tabindex="-1"><a class="header-anchor" href="#_1-3-å®‰è£…ansible" aria-hidden="true">#</a> 1.3 å®‰è£…ansible</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#éƒ¨ç½²èŠ‚ç‚¹å®‰è£…ansible</span>
root@master01:~<span class="token comment"># apt  install python3-pip git</span>
root@master01:~<span class="token comment"># pip3 install ansible -i https://mirrors.aliyun.com/pypi/simple/</span>
root@master01:~<span class="token comment"># ansible --version</span>
ansible <span class="token punctuation">[</span>core <span class="token number">2.13</span>.7<span class="token punctuation">]</span>
  config <span class="token function">file</span> <span class="token operator">=</span> None
  configured module search path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;/root/.ansible/plugins/modules&#39;</span>, <span class="token string">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="token punctuation">]</span>
  ansible python module location <span class="token operator">=</span> /usr/local/lib/python3.8/dist-packages/ansible
  ansible collection location <span class="token operator">=</span> /root/.ansible/collections:/usr/share/ansible/collections
  executable location <span class="token operator">=</span> /usr/local/bin/ansible
  python version <span class="token operator">=</span> <span class="token number">3.8</span>.10 <span class="token punctuation">(</span>default, Nov <span class="token number">14</span> <span class="token number">2022</span>, <span class="token number">12</span>:59:47<span class="token punctuation">)</span> <span class="token punctuation">[</span>GCC <span class="token number">9.4</span>.0<span class="token punctuation">]</span>
  jinja version <span class="token operator">=</span> <span class="token number">3.1</span>.2
  libyaml <span class="token operator">=</span> True
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="sNEU4"></a></p><h3 id="_1-4-é…ç½®é›†ç¾¤å…ç§˜é’¥ç™»å½•" tabindex="-1"><a class="header-anchor" href="#_1-4-é…ç½®é›†ç¾¤å…ç§˜é’¥ç™»å½•" aria-hidden="true">#</a> 1.4 é…ç½®é›†ç¾¤å…ç§˜é’¥ç™»å½•</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#â½£æˆå¯†é’¥å¯¹</span>

root@k8s-master1:~<span class="token comment"># ssh-keygen </span>

<span class="token comment">#å®‰è£…sshpasså‘½ä»¤â½¤äºåŒæ­¥å…¬é’¥åˆ°å„k8sæœåŠ¡å™¨</span>

<span class="token comment"># apt-get install sshpass </span>
<span class="token comment">#åˆ†å‘å…¬é’¥è„šæœ¬ï¼š</span>

root@k8s-master1:~<span class="token comment"># cat scp-key.sh </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#â½¬æ ‡ä¸»æœºåˆ—è¡¨</span>
<span class="token assign-left variable">IP</span><span class="token operator">=</span><span class="token string">&quot;
10.1.0.32
10.1.0.33
10.1.0.34
10.1.0.35
10.1.0.38
&quot;</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">node</span> <span class="token keyword">in</span> <span class="token variable">${IP}</span><span class="token punctuation">;</span><span class="token keyword">do</span>
  sshpass <span class="token parameter variable">-p</span> ceamg.com ssh-copy-id <span class="token variable">${node}</span> <span class="token parameter variable">-o</span> <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${node}</span> ç§˜é’¥copyå®Œæˆ&quot;</span>
  <span class="token keyword">else</span>
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${node}</span> ç§˜é’¥copyå¤±è´¥&quot;</span>
  <span class="token keyword">fi</span>
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="ZmDPR"></a></p><h3 id="_1-5-éƒ¨ç½²èŠ‚ç‚¹ä¸‹è½½kubeaszéƒ¨ç½²é¡¹ç›®åŠç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-5-éƒ¨ç½²èŠ‚ç‚¹ä¸‹è½½kubeaszéƒ¨ç½²é¡¹ç›®åŠç»„ä»¶" aria-hidden="true">#</a> 1.5 éƒ¨ç½²èŠ‚ç‚¹ä¸‹è½½kubeaszéƒ¨ç½²é¡¹â½¬åŠç»„ä»¶</h3><p>ä½¿â½¤ **master01 **ä½œä¸ºéƒ¨ç½²èŠ‚ç‚¹<br><a href="https://github.com/easzlab/kubeasz" target="_blank" rel="noopener noreferrer">GitHub - easzlab/kubeasz: ä½¿ç”¨Ansibleè„šæœ¬å®‰è£…K8Sé›†ç¾¤ï¼Œä»‹ç»ç»„ä»¶äº¤äº’åŸç†ï¼Œæ–¹ä¾¿ç›´æ¥ï¼Œä¸å—å›½å†…ç½‘ç»œç¯å¢ƒå½±å“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@k8s-master1:~<span class="token comment"># export release=3.3.1</span>
root@k8s-master1:~<span class="token comment"># curl -C- -fLO --retry 3 https://github.com/easzlab/kubeasz/releases/download/${release}/ezdown</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:~<span class="token comment"># chmod a+x ezdown </span>

root@master01:~<span class="token comment"># ./ezdown -D</span>
<span class="token number">2023</span>-01-02 <span class="token number">13</span>:28:24 INFO Action begin: download_all
<span class="token number">2023</span>-01-02 <span class="token number">13</span>:28:24 INFO downloading <span class="token function">docker</span> binaries, version <span class="token number">19.03</span>.15
--2023-01-02 <span class="token number">13</span>:28:24--  https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/static/stable/x86_64/docker-19.03.15.tgz
Resolving mirrors.tuna.tsinghua.edu.cn <span class="token punctuation">(</span>mirrors.tuna.tsinghua.edu.cn<span class="token punctuation">)</span><span class="token punctuation">..</span>. <span class="token number">101.6</span>.15.130, <span class="token number">2402</span>:f000:1:400::2
Connecting to mirrors.tuna.tsinghua.edu.cn <span class="token punctuation">(</span>mirrors.tuna.tsinghua.edu.cn<span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">101.6</span>.15.130<span class="token operator">|</span>:443<span class="token punctuation">..</span>. connected.
HTTP request sent, awaiting response<span class="token punctuation">..</span>. <span class="token number">200</span> OK
Length: <span class="token number">62436240</span> <span class="token punctuation">(</span>60M<span class="token punctuation">)</span> <span class="token punctuation">[</span>application/octet-stream<span class="token punctuation">]</span>
Saving to: â€˜docker-19.03.15.tgzâ€™

docker-19.03.15.tgz                                   <span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">59</span>.54M  <span class="token number">11</span>.2MB/s    <span class="token keyword">in</span> <span class="token number">5</span>.5s    

<span class="token number">2023</span>-01-02 <span class="token number">13</span>:28:29 <span class="token punctuation">(</span><span class="token number">10.9</span> MB/s<span class="token punctuation">)</span> - â€˜docker-19.03.15.tgzâ€™ saved <span class="token punctuation">[</span><span class="token number">62436240</span>/62436240<span class="token punctuation">]</span>

<span class="token number">2023</span>-01-02 <span class="token number">13</span>:28:31 WARN <span class="token function">docker</span> is already running.
<span class="token number">2023</span>-01-02 <span class="token number">13</span>:28:31 INFO downloading kubeasz: <span class="token number">3.3</span>.1
<span class="token number">2023</span>-01-02 <span class="token number">13</span>:28:31 DEBUG  run a temporary container
Unable to <span class="token function">find</span> image <span class="token string">&#39;easzlab/kubeasz:3.3.1&#39;</span> locally
<span class="token number">3.3</span>.1: Pulling from easzlab/kubeasz



Status: Image is up to <span class="token function">date</span> <span class="token keyword">for</span> easzlab/kubeasz:3.3.1
docker.io/easzlab/kubeasz:3.3.1
<span class="token number">2023</span>-01-02 <span class="token number">13</span>:41:44 INFO Action successed: download_all


root@master01:~<span class="token comment"># cd /etc/kubeasz/</span>
root@master01:/etc/kubeasz/down<span class="token comment"># ll</span>
total <span class="token number">1136932</span>
drwxr-xr-x  <span class="token number">2</span> root root      <span class="token number">4096</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:41 ./
drwxrwxr-x <span class="token number">12</span> root root      <span class="token number">4096</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:32 <span class="token punctuation">..</span>/
-rw-------  <span class="token number">1</span> root root <span class="token number">383673856</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:35 calico_v3.19.4.tar
-rw-------  <span class="token number">1</span> root root  <span class="token number">48941568</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:36 coredns_1.9.3.tar
-rw-------  <span class="token number">1</span> root root <span class="token number">246784000</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:39 dashboard_v2.5.1.tar
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">62436240</span> Feb  <span class="token number">1</span>  <span class="token number">2021</span> docker-19.03.15.tgz
-rw-------  <span class="token number">1</span> root root <span class="token number">106171392</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:37 k8s-dns-node-cache_1.21.1.tar
-rw-------  <span class="token number">1</span> root root <span class="token number">179129856</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:41 kubeasz_3.3.1.tar
-rw-------  <span class="token number">1</span> root root  <span class="token number">43832320</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:40 metrics-scraper_v1.0.8.tar
-rw-------  <span class="token number">1</span> root root  <span class="token number">65683968</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:41 metrics-server_v0.5.2.tar
-rw-------  <span class="token number">1</span> root root    <span class="token number">721408</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:41 pause_3.7.tar
-rw-------  <span class="token number">1</span> root root  <span class="token number">26815488</span> Jan  <span class="token number">2</span> <span class="token number">13</span>:32 registry-2.tar


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°è„šæœ¬è¿è¡ŒæˆåŠŸåï¼Œæ‰€æœ‰æ–‡ä»¶ï¼ˆkubeaszä»£ç ã€äºŒè¿›åˆ¶ã€ç¦»çº¿é•œåƒï¼‰å‡å·²æ•´ç†å¥½æ”¾å…¥ç›®å½•/etc/kubeasz</p><p><a name="G4hdX"></a></p><h2 id="_2-éƒ¨ç½²-harbor-é•œåƒä»“åº“" tabindex="-1"><a class="header-anchor" href="#_2-éƒ¨ç½²-harbor-é•œåƒä»“åº“" aria-hidden="true">#</a> 2.éƒ¨ç½² harbor é•œåƒä»“åº“</h2><p><a name="VgFWs"></a></p><h3 id="_2-1-åˆ›å»ºè‡ªç­¾sslè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#_2-1-åˆ›å»ºè‡ªç­¾sslè¯ä¹¦" aria-hidden="true">#</a> 2.1 åˆ›å»ºè‡ªç­¾sslè¯ä¹¦</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#æœ¬åœ°è§£æ</span>
root@harbor01:~<span class="token comment"># echo &quot;10.1.0.38 harbor.ceamg.com &gt;&gt; /etc/hosts&quot;</span>


<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/cert
<span class="token builtin class-name">cd</span> /data/cert

<span class="token comment">#åˆ›å»ºcaå’Œharborè¯ä¹¦è¯·æ±‚</span>
openssl genrsa <span class="token parameter variable">-out</span> ca.key <span class="token number">4096</span>
openssl req <span class="token parameter variable">-x509</span> <span class="token parameter variable">-new</span> <span class="token parameter variable">-nodes</span> <span class="token parameter variable">-sha512</span> <span class="token parameter variable">-days</span> <span class="token number">7300</span> <span class="token parameter variable">-subj</span> <span class="token string">&quot;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=harbor.ceamg.com&quot;</span> <span class="token parameter variable">-key</span> ca.key <span class="token parameter variable">-out</span> ca.crt
openssl genrsa <span class="token parameter variable">-out</span> harbor.ceamg.com.key <span class="token number">4096</span>
openssl req <span class="token parameter variable">-sha512</span> <span class="token parameter variable">-new</span> <span class="token parameter variable">-subj</span> <span class="token string">&quot;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=harbor.ceamg.com&quot;</span> <span class="token parameter variable">-key</span> harbor.ceamg.com.key <span class="token parameter variable">-out</span> harbor.ceamg.com.csr


<span class="token comment">#åˆ›å»ºv3æ–‡ä»¶</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> v3.ext <span class="token operator">&lt;&lt;-</span><span class="token string">EOF
authorityKeyIdentifier=keyid,issuer
basicConstraints=CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
extendedKeyUsage = serverAuth
subjectAltName = @alt_names

[alt_names]
DNS.1=harbor.ceamg.com
DNS.2=harbor
DNS.3=ks-allinone
EOF</span>

<span class="token comment">#ä½¿ç”¨v3æ–‡ä»¶ç­¾å‘harborè¯ä¹¦</span>
openssl x509 <span class="token parameter variable">-req</span> <span class="token parameter variable">-sha512</span> <span class="token parameter variable">-days</span> <span class="token number">7300</span> <span class="token parameter variable">-extfile</span> v3.ext <span class="token parameter variable">-CA</span> ca.crt <span class="token parameter variable">-CAkey</span> ca.key <span class="token parameter variable">-CAcreateserial</span> <span class="token parameter variable">-in</span> harbor.ceamg.com.csr <span class="token parameter variable">-out</span> harbor.ceamg.com.crt


<span class="token comment">#è½¬æ¢æˆcert</span>
openssl x509 <span class="token parameter variable">-inform</span> PEM <span class="token parameter variable">-in</span> harbor.ceamg.com.crt <span class="token parameter variable">-out</span> harbor.ceamg.com.cert


<span class="token comment">#æ·»åŠ æ ¹è¯ä¹¦è®©ç³»ç»Ÿä¿¡ä»»è¯ä¹¦</span>
root@harbor01:/data/cert<span class="token comment"># cp harbor.ceamg.com.crt /usr/local/share/ca-certificates/</span>

root@harbor01:/data/cert<span class="token comment"># update-ca-certificates </span>
Updating certificates <span class="token keyword">in</span> /etc/ssl/certs<span class="token punctuation">..</span>.
rehash: warning: skipping ca-certificates.crt,it does not contain exactly one certificate or CRL
<span class="token number">1</span> added, <span class="token number">0</span> removed<span class="token punctuation">;</span> done.
Running hooks <span class="token keyword">in</span> /etc/ca-certificates/update.d<span class="token punctuation">..</span>.
done.


<span class="token comment">#update-ca-certificateså‘½ä»¤å°†PEMæ ¼å¼çš„æ ¹è¯ä¹¦å†…å®¹é™„åŠ åˆ°/etc/ssl/certs/ca-certificates.crt ï¼Œè€Œ/etc/ssl/certs/ca-certificates.crt åŒ…å«äº†ç³»ç»Ÿè‡ªå¸¦çš„å„ç§å¯ä¿¡æ ¹è¯ä¹¦.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="F5iRD"></a></p><h3 id="_2-2-ä¿®æ”¹harboré…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-2-ä¿®æ”¹harboré…ç½®" aria-hidden="true">#</a> 2.2 ä¿®æ”¹harboré…ç½®</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@harbor01:/apps/harbor/harbor<span class="token comment"># cp harbor.yml.tmpl harbor.yml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@harbor01:/apps/harbor/harbor<span class="token comment"># grep -v &quot;#&quot; harbor.yml | grep -v &quot;^$&quot;</span>
hostname: harbor.ceamg.com
http:
  port: <span class="token number">80</span>
https:
  port: <span class="token number">443</span>
  certificate: /data/cert/harbor.ceamg.com.crt
  private_key: /apps/harbor/certs/harbor.ceamg.com.key
harbor_admin_password: ceamg.com
database:
  password: root123
  max_idle_conns: <span class="token number">100</span>
  max_open_conns: <span class="token number">900</span>
  conn_max_lifetime: 5m
  conn_max_idle_time: <span class="token number">0</span>
data_volume: /data
trivy:
  ignore_unfixed: <span class="token boolean">false</span>
  skip_update: <span class="token boolean">false</span>
  offline_scan: <span class="token boolean">false</span>
  security_check: vuln
  insecure: <span class="token boolean">false</span>
jobservice:
  max_job_workers: <span class="token number">10</span>
notification:
  webhook_job_max_retry: <span class="token number">10</span>
chart:
  absolute_url: disabled
log:
  level: info
  local:
    rotate_count: <span class="token number">50</span>
    rotate_size: 200M
    location: /var/log/harbor
_version: <span class="token number">2.7</span>.0
proxy:
  http_proxy:
  https_proxy:
  no_proxy:
  components:
    - core
    - jobservice
    - trivy
upload_purging:
  enabled: <span class="token boolean">true</span>
  age: 168h
  interval: 24h
  dryrun: <span class="token boolean">false</span>
cache:
  enabled: <span class="token boolean">false</span>
  expire_hours: <span class="token number">24</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="nKiGV"></a></p><h3 id="_2-3-å®‰è£…harbor" tabindex="-1"><a class="header-anchor" href="#_2-3-å®‰è£…harbor" aria-hidden="true">#</a> 2.3 å®‰è£…harbor</h3><p><a href="https://goharbor.io/docs/2.3.0/install-config/reconfigure-manage-lifecycle/" target="_blank" rel="noopener noreferrer">Harbor â€“ Reconfigure Harbor and Manage the Harbor Lifecycle<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><br> æœ‰æ‰«æ<code>â€“with-trivy</code> ,æœ‰è®¤è¯<code>â€“with-notary</code>ï¼Œæœ‰helm charts æ¨¡å—é€€å‡º<code>â€“with-chartmuseum</code> å…¶ä¸­<code>â€“with-clair</code>å·²å¼ƒç”¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#æ›´æ–°é…ç½®æ–‡ä»¶</span>

root@harbor01:/apps/harbor/harbor<span class="token comment"># ./prepare </span>
root@harbor01:/apps/harbor/harbor<span class="token comment"># ./install.sh --with-notary --with-trivy --with-chartmuseum</span>

<span class="token punctuation">[</span>Step <span class="token number">0</span><span class="token punctuation">]</span>: checking <span class="token keyword">if</span> <span class="token function">docker</span> is installed <span class="token punctuation">..</span>.

Note: <span class="token function">docker</span> version: <span class="token number">19.03</span>.15

<span class="token punctuation">[</span>Step <span class="token number">1</span><span class="token punctuation">]</span>: checking <span class="token function">docker-compose</span> is installed <span class="token punctuation">..</span>.

Note: <span class="token function">docker-compose</span> version: <span class="token number">1.24</span>.1

<span class="token punctuation">[</span>Step <span class="token number">2</span><span class="token punctuation">]</span>: loading Harbor images <span class="token punctuation">..</span>.
8991ee7e1c66: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">37</span>.72MB/37.72MB
caef0c5d2fe0: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">43</span>.84MB/43.84MB
d0ae0913849c: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">66</span>.03MB/66.03MB
d6c3137fc4e6: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>   <span class="token number">18</span>.2MB/18.2MB
db156fb6962c: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">65</span>.54kB/65.54kB
578a990cf79f: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>   <span class="token number">2</span>.56kB/2.56kB
9415b3c8b317: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">1</span>.536kB/1.536kB
bdb2dfba8b17: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">12</span>.29kB/12.29kB
6a1b6c491cd2: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>  <span class="token number">2</span>.613MB/2.613MB
c35c2488b48b: Loading layer <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>    407kB/407kB
Loaded image: goharbor/prepare:v2.7.0
Loaded image: goharbor/harbor-db:v2.7.0
Loaded image: goharbor/harbor-core:v2.7.0
Loaded image: goharbor/harbor-log:v2.7.0
Loaded image: goharbor/harbor-exporter:v2.7.0
Loaded image: goharbor/nginx-photon:v2.7.0
Loaded image: goharbor/chartmuseum-photon:v2.7.0
Loaded image: goharbor/harbor-portal:v2.7.0
Loaded image: goharbor/harbor-jobservice:v2.7.0
Loaded image: goharbor/harbor-registryctl:v2.7.0
Loaded image: goharbor/registry-photon:v2.7.0
Loaded image: goharbor/notary-server-photon:v2.7.0
Loaded image: goharbor/redis-photon:v2.7.0
Loaded image: goharbor/notary-signer-photon:v2.7.0
Loaded image: goharbor/trivy-adapter-photon:v2.7.0


<span class="token punctuation">[</span>Step <span class="token number">3</span><span class="token punctuation">]</span>: preparing environment <span class="token punctuation">..</span>.

<span class="token punctuation">[</span>Step <span class="token number">4</span><span class="token punctuation">]</span>: preparing harbor configs <span class="token punctuation">..</span>.
prepare base <span class="token function">dir</span> is <span class="token builtin class-name">set</span> to /apps/harbor/harbor
Generated configuration file: /config/portal/nginx.conf
Generated configuration file: /config/log/logrotate.conf
Generated configuration file: /config/log/rsyslog_docker.conf
Generated configuration file: /config/nginx/nginx.conf
Generated configuration file: /config/core/env
Generated configuration file: /config/core/app.conf
Generated configuration file: /config/registry/config.yml
Generated configuration file: /config/registryctl/env
Generated configuration file: /config/registryctl/config.yml
Generated configuration file: /config/db/env
Generated configuration file: /config/jobservice/env
Generated configuration file: /config/jobservice/config.yml
Generated and saved secret to file: /data/secret/keys/secretkey
Successfully called func: create_root_cert
Generated configuration file: /config/trivy-adapter/env
Generated configuration file: /compose_location/docker-compose.yml
Clean up the input <span class="token function">dir</span>


Note: stopping existing Harbor instance <span class="token punctuation">..</span>.
Removing network harbor_harbor
WARNING: Network harbor_harbor not found.


<span class="token punctuation">[</span>Step <span class="token number">5</span><span class="token punctuation">]</span>: starting Harbor <span class="token punctuation">..</span>.
Creating network <span class="token string">&quot;harbor_harbor&quot;</span> with the default driver
Creating harbor-log <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating redis         <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating harbor-portal <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating registry      <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating harbor-db     <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating registryctl   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating trivy-adapter <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating harbor-core   <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating harbor-jobservice <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating nginx             <span class="token punctuation">..</span>. <span class="token keyword">done</span>
âœ” ----Harbor has been installed and started successfully.----
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="atgJF"></a></p><h3 id="_2-4-harbor-è°ƒè¯•" tabindex="-1"><a class="header-anchor" href="#_2-4-harbor-è°ƒè¯•" aria-hidden="true">#</a> 2.4 harbor è°ƒè¯•</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#å…³é—­ harbor</span>
$~ <span class="token function">sudo</span> <span class="token function">docker-compose</span> down <span class="token parameter variable">-v</span>

<span class="token comment">#æ›´æ–°é…ç½®</span>
<span class="token function">vim</span> /apps/harbor.yml
prepare 

<span class="token comment">#é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶,å¢åŠ ä¸Šå…¶ä»–chartåŠŸèƒ½ç­‰</span>
<span class="token function">sudo</span> prepare --with-notary --with-trivy --with-chartmuseum

<span class="token comment">#å¯åŠ¨ harbor</span>
$~ <span class="token function">sudo</span> <span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="l5j1t"></a></p><p><a name="MlcUL"></a></p><p><a name="FZ0m4"></a></p><h2 id="_3-åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#_3-åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹" aria-hidden="true">#</a> 3.åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹</h2><p><a name="cV5Z6"></a></p><h3 id="_3-1-ç”Ÿæˆk8sé›†ç¾¤-hostsæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_3-1-ç”Ÿæˆk8sé›†ç¾¤-hostsæ–‡ä»¶" aria-hidden="true">#</a> 3.1 â½£æˆk8sé›†ç¾¤ hostsâ½‚ä»¶</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># ./ezctl new k8s-01</span>
<span class="token number">2023</span>-01-03 04:52:33 DEBUG generate custom cluster files <span class="token keyword">in</span> /etc/kubeasz/clusters/k8s-01
<span class="token number">2023</span>-01-03 04:52:33 DEBUG <span class="token builtin class-name">set</span> versions
<span class="token number">2023</span>-01-03 04:52:33 DEBUG cluster k8s-01: files successfully created.
<span class="token number">2023</span>-01-03 04:52:33 INFO next steps <span class="token number">1</span>: to config <span class="token string">&#39;/etc/kubeasz/clusters/k8s-01/hosts&#39;</span>
<span class="token number">2023</span>-01-03 04:52:33 INFO next steps <span class="token number">2</span>: to config <span class="token string">&#39;/etc/kubeasz/clusters/k8s-01/config.yml&#39;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># &#39;NEW_INSTALL&#39;: &#39;true&#39; to install a harbor server; &#39;false&#39; to integrate with existed one</span>
<span class="token punctuation">[</span>harbor<span class="token punctuation">]</span>
<span class="token number">10.1</span>.0.38 <span class="token assign-left variable">NEW_INSTALL</span><span class="token operator">=</span>false

<span class="token comment"># [optional] loadbalance for accessing k8s from outside</span>
<span class="token punctuation">[</span>ex_lb<span class="token punctuation">]</span>
<span class="token comment">#192.168.1.6 LB_ROLE=backup EX_APISERVER_VIP=192.168.1.250 EX_APISERVER_PORT=8443</span>
<span class="token comment">#192.168.1.7 LB_ROLE=master EX_APISERVER_VIP=192.168.1.250 EX_APISERVER_PORT=8443</span>

<span class="token comment"># [optional] ntp server for the cluster</span>
<span class="token punctuation">[</span>chrony<span class="token punctuation">]</span>
<span class="token comment">#192.168.1.1</span>

<span class="token punctuation">[</span>all:vars<span class="token punctuation">]</span>
<span class="token comment"># --------- Main Variables ---------------</span>
<span class="token comment"># Secure port for apiservers</span>
<span class="token assign-left variable">SECURE_PORT</span><span class="token operator">=</span><span class="token string">&quot;6443&quot;</span>

<span class="token comment"># Cluster container-runtime supported: docker, containerd</span>
<span class="token comment"># if k8s version &gt;= 1.24, docker is not supported</span>
<span class="token assign-left variable">CONTAINER_RUNTIME</span><span class="token operator">=</span><span class="token string">&quot;containerd&quot;</span>

<span class="token comment"># Network plugins supported: calico, flannel, kube-router, cilium, kube-ovn</span>
<span class="token assign-left variable">CLUSTER_NETWORK</span><span class="token operator">=</span><span class="token string">&quot;calico&quot;</span>

<span class="token comment"># Service proxy mode of kube-proxy: &#39;iptables&#39; or &#39;ipvs&#39;</span>
<span class="token assign-left variable">PROXY_MODE</span><span class="token operator">=</span><span class="token string">&quot;ipvs&quot;</span>

<span class="token comment"># K8S Service CIDR, not overlap with node(host) networking</span>
<span class="token assign-left variable">SERVICE_CIDR</span><span class="token operator">=</span><span class="token string">&quot;10.10.0.0/16&quot;</span>

<span class="token comment"># Cluster CIDR (Pod CIDR), not overlap with node(host) networking</span>
<span class="token assign-left variable">CLUSTER_CIDR</span><span class="token operator">=</span><span class="token string">&quot;10.20.0.0/16&quot;</span>

<span class="token comment"># NodePort Range</span>
<span class="token assign-left variable">NODE_PORT_RANGE</span><span class="token operator">=</span><span class="token string">&quot;30000-65535&quot;</span>

<span class="token comment"># Cluster DNS Domain</span>
<span class="token assign-left variable">CLUSTER_DNS_DOMAIN</span><span class="token operator">=</span><span class="token string">&quot;ceamg.local&quot;</span>

<span class="token comment"># -------- Additional Variables (don&#39;t change the default value right now) ---</span>
<span class="token comment"># Binaries Directory</span>
<span class="token assign-left variable">bin_dir</span><span class="token operator">=</span><span class="token string">&quot;/usr/local/bin&quot;</span>

<span class="token comment"># Deploy Directory (kubeasz workspace)</span>
<span class="token assign-left variable">base_dir</span><span class="token operator">=</span><span class="token string">&quot;/etc/kubeasz&quot;</span>

<span class="token comment"># Directory for a specific cluster</span>
<span class="token assign-left variable">cluster_dir</span><span class="token operator">=</span><span class="token string">&quot;{{ base_dir }}/clusters/k8s-01&quot;</span>

<span class="token comment"># CA and other components cert/key Directory</span>
<span class="token assign-left variable">ca_dir</span><span class="token operator">=</span><span class="token string">&quot;/etc/kubernetes/ssl&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="kbYzM"></a></p><h3 id="_3-1-ç”Ÿæˆk8sé›†ç¾¤-config-æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_3-1-ç”Ÿæˆk8sé›†ç¾¤-config-æ–‡ä»¶" aria-hidden="true">#</a> 3.1 â½£æˆk8sé›†ç¾¤ config â½‚ä»¶</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># vim /etc/kubeasz/clusters/k8s-01/config.yml </span>

<span class="token comment">############################</span>
<span class="token comment"># prepare</span>
<span class="token comment">############################</span>
<span class="token comment"># å¯é€‰ç¦»çº¿å®‰è£…ç³»ç»Ÿè½¯ä»¶åŒ… (offline|online)</span>
INSTALL_SOURCE: <span class="token string">&quot;online&quot;</span>

<span class="token comment"># å¯é€‰è¿›è¡Œç³»ç»Ÿå®‰å…¨åŠ å›º github.com/dev-sec/ansible-collection-hardening</span>
OS_HARDEN: <span class="token boolean">false</span>


<span class="token comment">############################</span>
<span class="token comment"># role:deploy</span>
<span class="token comment">############################</span>
<span class="token comment"># default: ca will expire in 100 years</span>
<span class="token comment"># default: certs issued by the ca will expire in 50 years</span>
CA_EXPIRY: <span class="token string">&quot;876000h&quot;</span>
CERT_EXPIRY: <span class="token string">&quot;438000h&quot;</span>

<span class="token comment"># kubeconfig é…ç½®å‚æ•°</span>
CLUSTER_NAME: <span class="token string">&quot;cluster1&quot;</span>
CONTEXT_NAME: <span class="token string">&quot;context-{{ CLUSTER_NAME }}&quot;</span>

<span class="token comment"># k8s version</span>
K8S_VER: <span class="token string">&quot;1.24.2&quot;</span>

<span class="token comment">############################</span>
<span class="token comment"># role:etcd</span>
<span class="token comment">############################</span>
<span class="token comment"># è®¾ç½®ä¸åŒçš„walç›®å½•ï¼Œå¯ä»¥é¿å…ç£ç›˜ioç«äº‰ï¼Œæé«˜æ€§èƒ½</span>
ETCD_DATA_DIR: <span class="token string">&quot;/var/lib/etcd&quot;</span>
ETCD_WAL_DIR: <span class="token string">&quot;&quot;</span>


<span class="token comment">############################</span>
<span class="token comment"># role:runtime [containerd,docker]</span>
<span class="token comment">############################</span>
<span class="token comment"># ------------------------------------------- containerd</span>
<span class="token comment"># [.]å¯ç”¨å®¹å™¨ä»“åº“é•œåƒ</span>
ENABLE_MIRROR_REGISTRY: <span class="token boolean">true</span>

<span class="token comment"># [containerd]åŸºç¡€å®¹å™¨é•œåƒ</span>
SANDBOX_IMAGE: <span class="token string">&quot;easzlab.io.local:5000/easzlab/pause:3.7&quot;</span>

<span class="token comment"># [containerd]å®¹å™¨æŒä¹…åŒ–å­˜å‚¨ç›®å½•</span>
CONTAINERD_STORAGE_DIR: <span class="token string">&quot;/var/lib/containerd&quot;</span>

<span class="token comment"># ------------------------------------------- docker</span>
<span class="token comment"># [docker]å®¹å™¨å­˜å‚¨ç›®å½•</span>
DOCKER_STORAGE_DIR: <span class="token string">&quot;/var/lib/docker&quot;</span>

<span class="token comment"># [docker]å¼€å¯Restful API</span>
ENABLE_REMOTE_API: <span class="token boolean">false</span>

<span class="token comment"># [docker]ä¿¡ä»»çš„HTTPä»“åº“</span>
INSECURE_REG: <span class="token string">&#39;[&quot;http://easzlab.io.local:5000&quot;]&#39;</span>


<span class="token comment">############################</span>
<span class="token comment"># role:kube-master</span>
<span class="token comment">############################</span>
<span class="token comment"># k8s é›†ç¾¤ master èŠ‚ç‚¹è¯ä¹¦é…ç½®ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªipå’ŒåŸŸåï¼ˆæ¯”å¦‚å¢åŠ å…¬ç½‘ipå’ŒåŸŸåï¼‰</span>
MASTER_CERT_HOSTS:
  - <span class="token string">&quot;10.1.1.1&quot;</span>
  - <span class="token string">&quot;k8s.easzlab.io&quot;</span>
  <span class="token comment">#- &quot;www.test.com&quot;</span>

<span class="token comment"># node èŠ‚ç‚¹ä¸Š pod ç½‘æ®µæ©ç é•¿åº¦ï¼ˆå†³å®šæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šèƒ½åˆ†é…çš„pod ipåœ°å€ï¼‰</span>
<span class="token comment"># å¦‚æœflannel ä½¿ç”¨ --kube-subnet-mgr å‚æ•°ï¼Œé‚£ä¹ˆå®ƒå°†è¯»å–è¯¥è®¾ç½®ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ†é…podç½‘æ®µ</span>
<span class="token comment"># https://github.com/coreos/flannel/issues/847</span>
NODE_CIDR_LEN: <span class="token number">24</span>


<span class="token comment">############################</span>
<span class="token comment"># role:kube-node</span>
<span class="token comment">############################</span>
<span class="token comment"># Kubelet æ ¹ç›®å½•</span>
KUBELET_ROOT_DIR: <span class="token string">&quot;/var/lib/kubelet&quot;</span>

<span class="token comment"># nodeèŠ‚ç‚¹æœ€å¤§pod æ•°</span>
MAX_PODS: <span class="token number">300</span>

<span class="token comment"># é…ç½®ä¸ºkubeç»„ä»¶ï¼ˆkubelet,kube-proxy,dockerdç­‰ï¼‰é¢„ç•™çš„èµ„æºé‡</span>
<span class="token comment"># æ•°å€¼è®¾ç½®è¯¦è§templates/kubelet-config.yaml.j2</span>
KUBE_RESERVED_ENABLED: <span class="token string">&quot;yes&quot;</span>

<span class="token comment"># k8s å®˜æ–¹ä¸å»ºè®®è‰ç‡å¼€å¯ system-reserved, é™¤éä½ åŸºäºé•¿æœŸç›‘æ§ï¼Œäº†è§£ç³»ç»Ÿçš„èµ„æºå ç”¨çŠ¶å†µï¼›</span>
<span class="token comment"># å¹¶ä¸”éšç€ç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼Œéœ€è¦é€‚å½“å¢åŠ èµ„æºé¢„ç•™ï¼Œæ•°å€¼è®¾ç½®è¯¦è§templates/kubelet-config.yaml.j2</span>
<span class="token comment"># ç³»ç»Ÿé¢„ç•™è®¾ç½®åŸºäº 4c/8g è™šæœºï¼Œæœ€å°åŒ–å®‰è£…ç³»ç»ŸæœåŠ¡ï¼Œå¦‚æœä½¿ç”¨é«˜æ€§èƒ½ç‰©ç†æœºå¯ä»¥é€‚å½“å¢åŠ é¢„ç•™</span>
<span class="token comment"># å¦å¤–ï¼Œé›†ç¾¤å®‰è£…æ—¶å€™apiserverç­‰èµ„æºå ç”¨ä¼šçŸ­æ—¶è¾ƒå¤§ï¼Œå»ºè®®è‡³å°‘é¢„ç•™1gå†…å­˜</span>
SYS_RESERVED_ENABLED: <span class="token string">&quot;no&quot;</span>


<span class="token comment">############################</span>
<span class="token comment"># role:network [flannel,calico,cilium,kube-ovn,kube-router]</span>
<span class="token comment">############################</span>
<span class="token comment"># ------------------------------------------- flannel</span>
<span class="token comment"># [flannel]è®¾ç½®flannel åç«¯&quot;host-gw&quot;,&quot;vxlan&quot;ç­‰</span>
FLANNEL_BACKEND: <span class="token string">&quot;vxlan&quot;</span>
DIRECT_ROUTING: <span class="token boolean">false</span>

<span class="token comment"># [flannel] flanneld_image: &quot;quay.io/coreos/flannel:v0.10.0-amd64&quot;</span>
flannelVer: <span class="token string">&quot;v0.15.1&quot;</span>
flanneld_image: <span class="token string">&quot;easzlab.io.local:5000/easzlab/flannel:{{ flannelVer }}&quot;</span>

<span class="token comment"># ------------------------------------------- calico</span>
<span class="token comment"># [calico]è®¾ç½® CALICO_IPV4POOL_IPIP=â€œoffâ€,å¯ä»¥æé«˜ç½‘ç»œæ€§èƒ½ï¼Œæ¡ä»¶é™åˆ¶è¯¦è§ docs/setup/calico.md</span>
CALICO_IPV4POOL_IPIP: <span class="token string">&quot;Always&quot;</span>

<span class="token comment"># [calico]è®¾ç½® calico-nodeä½¿ç”¨çš„host IPï¼Œbgpé‚»å±…é€šè¿‡è¯¥åœ°å€å»ºç«‹ï¼Œå¯æ‰‹å·¥æŒ‡å®šä¹Ÿå¯ä»¥è‡ªåŠ¨å‘ç°</span>
IP_AUTODETECTION_METHOD: <span class="token string">&quot;can-reach={{ groups[&#39;kube_master&#39;][0] }}&quot;</span>

<span class="token comment"># [calico]è®¾ç½®calico ç½‘ç»œ backend: brid, vxlan, none</span>
CALICO_NETWORKING_BACKEND: <span class="token string">&quot;brid&quot;</span>

<span class="token comment"># [calico]è®¾ç½®calico æ˜¯å¦ä½¿ç”¨route reflectors</span>
<span class="token comment"># å¦‚æœé›†ç¾¤è§„æ¨¡è¶…è¿‡50ä¸ªèŠ‚ç‚¹ï¼Œå»ºè®®å¯ç”¨è¯¥ç‰¹æ€§</span>
CALICO_RR_ENABLED: <span class="token boolean">false</span>

<span class="token comment"># CALICO_RR_NODES é…ç½®route reflectorsçš„èŠ‚ç‚¹ï¼Œå¦‚æœæœªè®¾ç½®é»˜è®¤ä½¿ç”¨é›†ç¾¤masterèŠ‚ç‚¹ </span>
<span class="token comment"># CALICO_RR_NODES: [&quot;192.168.1.1&quot;, &quot;192.168.1.2&quot;]</span>
CALICO_RR_NODES: <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># [calico]æ›´æ–°æ”¯æŒcalico ç‰ˆæœ¬: [v3.3.x] [v3.4.x] [v3.8.x] [v3.15.x]</span>
calico_ver: <span class="token string">&quot;v3.19.4&quot;</span>

<span class="token comment"># [calico]calico ä¸»ç‰ˆæœ¬</span>
calico_ver_main: <span class="token string">&quot;{{ calico_ver.split(&#39;.&#39;)[0] }}.{{ calico_ver.split(&#39;.&#39;)[1] }}&quot;</span>

<span class="token comment"># ------------------------------------------- cilium</span>
<span class="token comment"># [cilium]é•œåƒç‰ˆæœ¬</span>
cilium_ver: <span class="token string">&quot;1.11.6&quot;</span>
cilium_connectivity_check: <span class="token boolean">true</span>
cilium_hubble_enabled: <span class="token boolean">false</span>
cilium_hubble_ui_enabled: <span class="token boolean">false</span>

<span class="token comment"># ------------------------------------------- kube-ovn</span>
<span class="token comment"># [kube-ovn]é€‰æ‹© OVN DB and OVN Control Plane èŠ‚ç‚¹ï¼Œé»˜è®¤ä¸ºç¬¬ä¸€ä¸ªmasterèŠ‚ç‚¹</span>
OVN_DB_NODE: <span class="token string">&quot;{{ groups[&#39;kube_master&#39;][0] }}&quot;</span>

<span class="token comment"># [kube-ovn]ç¦»çº¿é•œåƒtaråŒ…</span>
kube_ovn_ver: <span class="token string">&quot;v1.5.3&quot;</span>

<span class="token comment"># ------------------------------------------- kube-router</span>
<span class="token comment"># [kube-router]å…¬æœ‰äº‘ä¸Šå­˜åœ¨é™åˆ¶ï¼Œä¸€èˆ¬éœ€è¦å§‹ç»ˆå¼€å¯ ipinipï¼›è‡ªæœ‰ç¯å¢ƒå¯ä»¥è®¾ç½®ä¸º &quot;subnet&quot;</span>
OVERLAY_TYPE: <span class="token string">&quot;full&quot;</span>

<span class="token comment"># [kube-router]NetworkPolicy æ”¯æŒå¼€å…³</span>
FIREWALL_ENABLE: <span class="token boolean">true</span>

<span class="token comment"># [kube-router]kube-router é•œåƒç‰ˆæœ¬</span>
kube_router_ver: <span class="token string">&quot;v0.3.1&quot;</span>
busybox_ver: <span class="token string">&quot;1.28.4&quot;</span>


<span class="token comment">############################</span>
<span class="token comment"># role:cluster-addon</span>
<span class="token comment">############################</span>
<span class="token comment"># coredns è‡ªåŠ¨å®‰è£…</span>
dns_install: <span class="token string">&quot;no&quot;</span>
corednsVer: <span class="token string">&quot;1.9.3&quot;</span>
ENABLE_LOCAL_DNS_CACHE: <span class="token boolean">false</span>
dnsNodeCacheVer: <span class="token string">&quot;1.21.1&quot;</span>
<span class="token comment"># è®¾ç½® local dns cache åœ°å€</span>
LOCAL_DNS_CACHE: <span class="token string">&quot;169.254.20.10&quot;</span>

<span class="token comment"># metric server è‡ªåŠ¨å®‰è£…</span>
metricsserver_install: <span class="token string">&quot;no&quot;</span>
metricsVer: <span class="token string">&quot;v0.5.2&quot;</span>

<span class="token comment"># dashboard è‡ªåŠ¨å®‰è£…</span>
dashboard_install: <span class="token string">&quot;no&quot;</span>
dashboardVer: <span class="token string">&quot;v2.5.1&quot;</span>
dashboardMetricsScraperVer: <span class="token string">&quot;v1.0.8&quot;</span>

<span class="token comment"># prometheus è‡ªåŠ¨å®‰è£…</span>
prom_install: <span class="token string">&quot;no&quot;</span>
prom_namespace: <span class="token string">&quot;monitor&quot;</span>
prom_chart_ver: <span class="token string">&quot;35.5.1&quot;</span>

<span class="token comment"># nfs-provisioner è‡ªåŠ¨å®‰è£…</span>
nfs_provisioner_install: <span class="token string">&quot;no&quot;</span>
nfs_provisioner_namespace: <span class="token string">&quot;kube-system&quot;</span>
nfs_provisioner_ver: <span class="token string">&quot;v4.0.2&quot;</span>
nfs_storage_class: <span class="token string">&quot;managed-nfs-storage&quot;</span>
nfs_server: <span class="token string">&quot;192.168.1.10&quot;</span>
nfs_path: <span class="token string">&quot;/data/nfs&quot;</span>

<span class="token comment"># network-check è‡ªåŠ¨å®‰è£…</span>
network_check_enabled: <span class="token boolean">false</span>
network_check_schedule: <span class="token string">&quot;*/5 * * * *&quot;</span>

<span class="token comment">############################</span>
<span class="token comment"># role:harbor</span>
<span class="token comment">############################</span>
<span class="token comment"># harbor versionï¼Œå®Œæ•´ç‰ˆæœ¬å·</span>
HARBOR_VER: <span class="token string">&quot;v2.1.3&quot;</span>
HARBOR_DOMAIN: <span class="token string">&quot;harbor.easzlab.io.local&quot;</span>
HARBOR_TLS_PORT: <span class="token number">8443</span>

<span class="token comment"># if set &#39;false&#39;, you need to put certs named harbor.pem and harbor-key.pem in directory &#39;down&#39;</span>
HARBOR_SELF_SIGNED_CERT: <span class="token boolean">true</span>

<span class="token comment"># install extra component</span>
HARBOR_WITH_NOTARY: <span class="token boolean">false</span>
HARBOR_WITH_TRIVY: <span class="token boolean">false</span>
HARBOR_WITH_CLAIR: <span class="token boolean">false</span>
HARBOR_WITH_CHARTMUSEUM: <span class="token boolean">true</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="dwcT1"></a></p><h2 id="_4-æ­¥éª¤1-åŸºç¡€ç¯å¢ƒåˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#_4-æ­¥éª¤1-åŸºç¡€ç¯å¢ƒåˆå§‹åŒ–" aria-hidden="true">#</a> 4.æ­¥éª¤1-åŸºç¡€ç¯å¢ƒåˆå§‹åŒ–</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># ./ezctl help setup</span>
Usage: ezctl setup <span class="token operator">&lt;</span>cluster<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>step<span class="token operator">&gt;</span>
available steps:
    01  prepare            to prepare CA/certs <span class="token operator">&amp;</span> kubeconfig <span class="token operator">&amp;</span> other system settings 
    02  etcd               to setup the etcd cluster
    03  container-runtime  to setup the container runtime<span class="token punctuation">(</span>docker or containerd<span class="token punctuation">)</span>
    04  kube-master        to setup the master nodes
    05  kube-node          to setup the worker nodes
    06  network            to setup the network plugin
    07  cluster-addon      to setup other useful plugins
    <span class="token number">90</span>  all                to run 01~07 all at once
    <span class="token number">10</span>  ex-lb              to <span class="token function">install</span> external loadbalance <span class="token keyword">for</span> accessing k8s from outside
    <span class="token number">11</span>  harbor             to <span class="token function">install</span> a new harbor server or to integrate with an existed one

examples: ./ezctl setup test-k8s 01  <span class="token punctuation">(</span>or ./ezctl setup test-k8s prepare<span class="token punctuation">)</span>
	  ./ezctl setup test-k8s 02  <span class="token punctuation">(</span>or ./ezctl setup test-k8s etcd<span class="token punctuation">)</span>
          ./ezctl setup test-k8s all
          ./ezctl setup test-k8s 04 <span class="token parameter variable">-t</span> restart_master

<span class="token function">vim</span> playbooks/01.prepare.yml 
<span class="token comment">#ç³»ç»ŸåŸºç¡€åˆå§‹åŒ–ä¸»æœºé…ç½®</span>

root@master01:/etc/kubeasz<span class="token comment"># ./ezctl setup k8s-01 01</span>
<span class="token comment">#å‡†å¤‡CAå’ŒåŸºç¡€ç³»ç»Ÿè®¾ç½®</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="QkYNt"></a></p><h2 id="_5-æ­¥éª¤2-éƒ¨ç½²etcdé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_5-æ­¥éª¤2-éƒ¨ç½²etcdé›†ç¾¤" aria-hidden="true">#</a> 5.æ­¥éª¤2-éƒ¨ç½²etcdé›†ç¾¤</h2><p>å¯æ›´æ”¹å¯åŠ¨è„šæœ¬è·¯å¾„åŠç‰ˆæœ¬ç­‰â¾ƒå®šä¹‰é…ç½®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># ./ezctl setup k8s-01 02</span>
ansible-playbook <span class="token parameter variable">-i</span> clusters/k8s-01/hosts <span class="token parameter variable">-e</span> @clusters/k8s-01/config.yml  playbooks/02.etcd.yml
<span class="token number">2023</span>-01-03 <span class="token number">13</span>:39:13 INFO cluster:k8s-01 setup step:02 begins <span class="token keyword">in</span> 5s, press any key to abort


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¥åº·æ£€æŸ¥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">NODE_IPS</span><span class="token operator">=</span><span class="token string">&quot;10.1.0.34 10.1.0.35&quot;</span>

root@etcd01:~<span class="token comment"># for ip in ${NODE_IPS}; do ETCDCTL_API=3 /usr/local/bin/etcdctl --endpoints=https://${ip}:2379 --cacert=/etc/kubernetes/ssl/ca.pem --cert=/etc/kubernetes/ssl/etcd.pem --key=/etc/kubernetes/ssl/etcd-key.pem endpoint health; done</span>
https://10.1.0.34:2379 is healthy: successfully committed proposal: took <span class="token operator">=</span> <span class="token number">14</span>.95631ms
https://10.1.0.35:2379 is healthy: successfully committed proposal: took <span class="token operator">=</span> <span class="token number">15</span>.037491ms

æ³¨ï¼šä»¥ä¸Šè¿”å›ä¿¡æ¯è¡¨ç¤ºetcdé›†ç¾¤è¿â¾æ­£å¸¸ï¼Œå¦åˆ™å¼‚å¸¸ï¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éƒ¨ç½²containerd</p><p>åŒæ­¥dockerè¯ä¹¦è„šæœ¬ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#â½¬æ ‡ä¸»æœºåˆ—è¡¨</span>
<span class="token assign-left variable">IP</span><span class="token operator">=</span><span class="token string">&quot;
10.1.0.32
10.1.0.33
10.1.0.34
10.1.0.35
&quot;</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">node</span> <span class="token keyword">in</span> <span class="token variable">${IP}</span><span class="token punctuation">;</span><span class="token keyword">do</span>
  sshpass <span class="token parameter variable">-p</span> ceamg.com ssh-copy-id <span class="token variable">${node}</span> <span class="token parameter variable">-o</span> <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${node}</span> ç§˜é’¥copyå®Œæˆ&quot;</span>
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${node}</span> ç§˜é’¥copyå®Œæˆ,å‡†å¤‡ç¯å¢ƒåˆå§‹åŒ–.....&quot;</span>
   <span class="token function">ssh</span> <span class="token variable">${node}</span> <span class="token string">&quot;mkdir /etc/containerd/certs.d/harbor.ceamg.com -p&quot;</span>
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;Harbor è¯ä¹¦åˆ›å»ºæˆåŠŸ!&quot;</span>
   <span class="token function">scp</span> /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.cert  /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.crt /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.key /etc/containerd/certs.d/harbor.ceamg.com/ca.crt <span class="token variable">${node}</span>:/etc/containerd/certs.d/harbor.ceamg.com/
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Harbor è¯ä¹¦æ‹·è´æˆåŠŸ!&quot;</span>
  <span class="token function">ssh</span> <span class="token variable">${node}</span> <span class="token string">&quot;echo &quot;</span><span class="token number">10.1</span>.0.38 harbor.ceamg.com<span class="token string">&quot; &gt;&gt; /etc/hosts&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;host è§£ææ·»åŠ å®Œæˆ&quot;</span>
<span class="token comment">#scp -r /root/.docker ${node}:/root/</span>
<span class="token comment">#echo &quot;Harbor è®¤è¯ä»¶æ‹·å®Œæˆ!&quot;</span>
<span class="token keyword">else</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${node}</span> ç§˜é’¥copyå¤±è´¥&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">done</span>
<span class="token comment">#æ‰§â¾è„šæœ¬è¿›â¾è¯ä¹¦åˆ†å‘</span>
root@k8s-master1:/etc/kubeasz<span class="token comment"># bash /root/scp-key.sh</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="wVKDt"></a></p><h2 id="_6-æ­¥éª¤3-éƒ¨ç½²è¿è¡Œæ—¶ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#_6-æ­¥éª¤3-éƒ¨ç½²è¿è¡Œæ—¶ç¯å¢ƒ" aria-hidden="true">#</a> 6.æ­¥éª¤3-éƒ¨ç½²è¿è¡Œæ—¶ç¯å¢ƒ</h2><p>é¡¹ç›®æ ¹æ®k8sç‰ˆæœ¬æä¾›ä¸åŒçš„é»˜è®¤å®¹å™¨è¿è¡Œæ—¶ï¼š</p><ul><li>k8s ç‰ˆæœ¬ &lt; 1.24 æ—¶ï¼Œæ”¯æŒdocker containerd å¯é€‰</li><li>k8s ç‰ˆæœ¬ &gt;= 1.24 æ—¶ï¼Œä»…æ”¯æŒ containerd <a name="ELUXT"></a></li></ul><h3 id="_6-1-kubeasz-é›†æˆå®‰è£…-containerd" tabindex="-1"><a class="header-anchor" href="#_6-1-kubeasz-é›†æˆå®‰è£…-containerd" aria-hidden="true">#</a> 6.1 kubeasz é›†æˆå®‰è£… containerd</h3><p><br> æ³¨æ„ï¼šk8s 1.24ä»¥åï¼Œé¡¹ç›®å·²ç»è®¾ç½®é»˜è®¤å®¹å™¨è¿è¡Œæ—¶ä¸º containerdï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./ezctl setup k8s-01 05
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><a name="P0enu"></a></p><h3 id="_6-2-é…ç½®containerd-å¯¹æ¥ç§æœ‰harborä»“åº“" tabindex="-1"><a class="header-anchor" href="#_6-2-é…ç½®containerd-å¯¹æ¥ç§æœ‰harborä»“åº“" aria-hidden="true">#</a> 6.2 é…ç½®containerd å¯¹æ¥ç§æœ‰harborä»“åº“</h3><p>ä¿®æ”¹roleæ¨¡æ¿æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> roles/containerd/templates/config.toml.j2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸»è¦ä¿®æ”¹å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry<span class="token punctuation">]</span>

      <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.auths<span class="token punctuation">]</span>

      <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.configs<span class="token punctuation">]</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.configs.<span class="token string">&quot;https://harbor.ceamg.com&quot;</span><span class="token punctuation">]</span>
           username <span class="token operator">=</span> <span class="token string">&quot;admin&quot;</span>
           password <span class="token operator">=</span> <span class="token string">&quot;ceamg.com&quot;</span>

        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.configs.<span class="token string">&quot;easzlab.io.local:5000&quot;</span>.tls<span class="token punctuation">]</span>
          insecure_skip_verify <span class="token operator">=</span> <span class="token boolean">true</span>

        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.configs.<span class="token string">&quot;harbor.ceamg.com&quot;</span>.tls<span class="token punctuation">]</span>
          insecure_skip_verify <span class="token operator">=</span> <span class="token boolean">true</span>
          ca_file <span class="token operator">=</span> <span class="token string">&quot;/etc/containerd/certs.d/harbor.ceamg.com/ca.crt&quot;</span>
          cert_file <span class="token operator">=</span> <span class="token string">&quot;/etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.cert&quot;</span>
          key_file <span class="token operator">=</span> <span class="token string">&quot;/etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.key&quot;</span>

      <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.headers<span class="token punctuation">]</span>

      <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors<span class="token punctuation">]</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="token string">&quot;easzlab.io.local:5000&quot;</span><span class="token punctuation">]</span>
          endpoint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;http://easzlab.io.local:5000&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="token string">&quot;harbor.ceamg.com&quot;</span><span class="token punctuation">]</span>
          endpoint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://harbor.ceamg.com&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="token string">&quot;docker.io&quot;</span><span class="token punctuation">]</span>
          endpoint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://lc2kkql3.mirror.aliyuncs.com&quot;</span>,<span class="token string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>, <span class="token string">&quot;http://hub-mirror.c.163.com&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="token string">&quot;gcr.io&quot;</span><span class="token punctuation">]</span>
          endpoint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://gcr.mirrors.ustc.edu.cn&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="token string">&quot;k8s.gcr.io&quot;</span><span class="token punctuation">]</span>
          endpoint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://gcr.mirrors.ustc.edu.cn/google-containers/&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="token string">&quot;quay.io&quot;</span><span class="token punctuation">]</span>
          endpoint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://quay.mirrors.ustc.edu.cn&quot;</span><span class="token punctuation">]</span>

      <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.auths.<span class="token string">&quot;https://harbor.ceamg.com&quot;</span><span class="token punctuation">]</span>

    <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.x509_key_pair_streaming<span class="token punctuation">]</span>
      tls_cert_file <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
      tls_key_file <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="xwPVy"></a></p><h3 id="_6-3-containerd-ä½¿ç”¨è¯ä¹¦å¯¹æ¥harborå®ç°ä¸Šä¼ ä¸‹è½½" tabindex="-1"><a class="header-anchor" href="#_6-3-containerd-ä½¿ç”¨è¯ä¹¦å¯¹æ¥harborå®ç°ä¸Šä¼ ä¸‹è½½" aria-hidden="true">#</a> 6.3 containerd ä½¿ç”¨è¯ä¹¦å¯¹æ¥harborå®ç°ä¸Šä¼ ä¸‹è½½</h3><p><a name="maN07"></a></p><h4 id="_6-3-1-ä½¿ç”¨è„šæœ¬åŒæ­¥è¯ä¹¦åˆ°å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#_6-3-1-ä½¿ç”¨è„šæœ¬åŒæ­¥è¯ä¹¦åˆ°å®¢æˆ·ç«¯" aria-hidden="true">#</a> 6.3.1 ä½¿ç”¨è„šæœ¬åŒæ­¥è¯ä¹¦åˆ°å®¢æˆ·ç«¯</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#ç›®æ ‡ä¸»æœºåˆ—è¡¨</span>
<span class="token assign-left variable">IP</span><span class="token operator">=</span><span class="token string">&quot;
10.1.0.32
10.1.0.33
10.1.0.34
10.1.0.35
&quot;</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">node</span> <span class="token keyword">in</span> <span class="token variable">${IP}</span><span class="token punctuation">;</span><span class="token keyword">do</span>
  sshpass <span class="token parameter variable">-p</span> ceamg.com ssh-copy-id <span class="token variable">${node}</span> <span class="token parameter variable">-o</span> <span class="token assign-left variable">StrictHostKeyChecking</span><span class="token operator">=</span>no
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${node}</span> ç§˜é’¥copyå®Œæˆ&quot;</span>
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${node}</span> ç§˜é’¥copyå®Œæˆ,å‡†å¤‡ç¯å¢ƒåˆå§‹åŒ–.....&quot;</span>
   <span class="token function">ssh</span> <span class="token variable">${node}</span> <span class="token string">&quot;mkdir /etc/containerd/certs.d/harbor.ceamg.com -p&quot;</span>
   <span class="token builtin class-name">echo</span> <span class="token string">&quot;Harbor è¯ä¹¦åˆ›å»ºæˆåŠŸ!&quot;</span>
   <span class="token function">scp</span> /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.cert  /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.crt /etc/containerd/certs.d/harbor.ceamg.com/harbor.ceamg.com.key /etc/containerd/certs.d/harbor.ceamg.com/ca.crt <span class="token variable">${node}</span>:/etc/containerd/certs.d/harbor.ceamg.com/
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Harbor è¯ä¹¦æ‹·è´æˆåŠŸ!&quot;</span>
  <span class="token function">ssh</span> <span class="token variable">${node}</span> <span class="token string">&quot;echo &quot;</span><span class="token number">10.1</span>.0.38 harbor.ceamg.com<span class="token string">&quot; &gt;&gt; /etc/hosts&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;host è§£ææ·»åŠ å®Œæˆ&quot;</span>
<span class="token comment">#scp -r /root/.docker ${node}:/root/</span>
<span class="token comment">#echo &quot;Harbor è®¤è¯ä»¶æ‹·å®Œæˆ!&quot;</span>
<span class="token keyword">else</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${node}</span> ç§˜é’¥copyå¤±è´¥&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">done</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="OXGSR"></a></p><h4 id="_6-3-2-æµ‹è¯•containerd-å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ç™»å½•harbor" tabindex="-1"><a class="header-anchor" href="#_6-3-2-æµ‹è¯•containerd-å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ç™»å½•harbor" aria-hidden="true">#</a> 6.3.2 æµ‹è¯•containerd å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ç™»å½•harbor</h4><p>æ¨é€é•œåƒ <br><a href="https://www.yuque.com/attachments/yuque/0/2023/pdf/33538388/1672731322660-c020aeef-2273-40b3-877c-c28089c7d7b0.pdf?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2023%2Fpdf%2F33538388%2F1672731322660-c020aeef-2273-40b3-877c-c28089c7d7b0.pdf%22%2C%22name%22%3A%22nerdctl.pdf%22%2C%22size%22%3A28536832%2C%22ext%22%3A%22pdf%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22download%22%3Atrue%2C%22type%22%3A%22application%2Fpdf%22%2C%22mode%22%3A%22title%22%2C%22taskId%22%3A%22u2d812840-191c-45c4-aec0-85144ca300b%22%2C%22taskType%22%3A%22upload%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22TItzJ%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22card%22%3A%22file%22%7D" target="_blank" rel="noopener noreferrer">nerdctl.pdf<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/containerd/certs.d/harbor.ceamg.com<span class="token comment"># ls</span>
ca.crt  harbor.ceamg.com.cert  harbor.ceamg.com.crt  harbor.ceamg.com.key

root@master01:/etc/containerd/certs.d/harbor.ceamg.com<span class="token comment"># nerdctl login harbor.ceamg.com</span>
WARNING: Your password will be stored unencrypted <span class="token keyword">in</span> /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/<span class="token comment">#credentials-store</span>

Login Succeeded


root@master01:/etc/containerd/certs.d/harbor.ceamg.com<span class="token comment"># nerdctl images</span>
REPOSITORY                        TAG       IMAGE ID        CREATED        PLATFORM       SIZE         BLOB SIZE
nginx                             latest    0047b729188a    <span class="token number">4</span> hours ago    linux/amd64    <span class="token number">149.4</span> MiB    <span class="token number">54.2</span> MiB
harbor.ceamg.com/library/nginx    latest    0047b729188a    <span class="token number">3</span> hours ago    linux/amd64    <span class="token number">149.4</span> MiB    <span class="token number">54.2</span> MiB
root@master01:/etc/containerd/certs.d/harbor.ceamg.com<span class="token comment"># nerdctl push harbor.ceamg.com/library/nginx</span>
INFO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> pushing as a reduced-platform image <span class="token punctuation">(</span>application/vnd.docker.distribution.manifest.list.v2+json, sha256:3f727bfae5cee62f35f014637b350dbc1d0b416bdd1717b61c5ce5b036771aa0<span class="token punctuation">)</span> 
index-sha256:3f727bfae5cee62f35f014637b350dbc1d0b416bdd1717b61c5ce5b036771aa0:    <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span> 
manifest-sha256:9a821cadb1b13cb782ec66445325045b2213459008a41c72d8d87cde94b33c8c: <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span> 
config-sha256:1403e55ab369cd1c8039c34e6b4d47ca40bbde39c371254c7cba14756f472f52:   <span class="token keyword">done</span>           <span class="token operator">|</span>++++++++++++++++++++++++++++++++++++++<span class="token operator">|</span> 
elapsed: <span class="token number">1.1</span> s                                                                    total:  <span class="token number">9.3</span> Ki <span class="token punctuation">(</span><span class="token number">8.5</span> KiB/s<span class="token punctuation">)</span>          
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="fw4ob"></a></p><h2 id="_7-æ­¥éª¤4-éƒ¨ç½²master" tabindex="-1"><a class="header-anchor" href="#_7-æ­¥éª¤4-éƒ¨ç½²master" aria-hidden="true">#</a> 7.æ­¥éª¤4-éƒ¨ç½²master</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> playbooks/04.kube-master.yml
- hosts: kube_master
  roles:
  - kube-lb        <span class="token comment"># å››å±‚è´Ÿè½½å‡è¡¡ï¼Œç›‘å¬åœ¨127.0.0.1:6443ï¼Œè½¬å‘åˆ°çœŸå®masterèŠ‚ç‚¹apiserveræœåŠ¡</span>
  - kube-master    <span class="token comment">#</span>
  - kube-node      <span class="token comment"># å› ä¸ºç½‘ç»œã€ç›‘æ§ç­‰daemonsetç»„ä»¶ï¼ŒmasterèŠ‚ç‚¹ä¹Ÿæ¨èå®‰è£…kubeletå’Œkube-proxyæœåŠ¡</span>
  <span class="token punctuation">..</span>. 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># ./ezctl setup k8s-01 04</span>
ansible-playbook <span class="token parameter variable">-i</span> clusters/k8s-01/hosts <span class="token parameter variable">-e</span> @clusters/k8s-01/config.yml  playbooks/04.kube-master.yml
<span class="token number">2023</span>-01-03 <span class="token number">14</span>:07:04 INFO cluster:k8s-01 setup step:04 begins <span class="token keyword">in</span> 5s, press any key to abort:

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="Kin0Z"></a></p><p><strong>éªŒè¯ master é›†ç¾¤</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€</span>
systemctl status kube-apiserver
systemctl status kube-controller-manager
systemctl status kube-scheduler
<span class="token comment"># æŸ¥çœ‹è¿›ç¨‹è¿è¡Œæ—¥å¿—</span>
journalctl <span class="token parameter variable">-u</span> kube-apiserver
journalctl <span class="token parameter variable">-u</span> kube-controller-manager
journalctl <span class="token parameter variable">-u</span> kube-scheduler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ <code>kubectl get componentstatus</code> å¯ä»¥çœ‹åˆ°</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># kubectl get componentstatus</span>
Warning: v1 ComponentStatus is deprecated <span class="token keyword">in</span> v1.19+
NAME                 STATUS    MESSAGE                         ERROR
scheduler            Healthy   ok                              
controller-manager   Healthy   ok                              
etcd-1               Healthy   <span class="token punctuation">{</span><span class="token string">&quot;health&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;true&quot;</span>,<span class="token string">&quot;reason&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>   
etcd-0               Healthy   <span class="token punctuation">{</span><span class="token string">&quot;health&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;true&quot;</span>,<span class="token string">&quot;reason&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>   

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="bxoWT"></a></p><h2 id="_8-æ­¥éª¤5-éƒ¨ç½²nodeèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_8-æ­¥éª¤5-éƒ¨ç½²nodeèŠ‚ç‚¹" aria-hidden="true">#</a> 8.æ­¥éª¤5-éƒ¨ç½²nodeèŠ‚ç‚¹</h2><p><strong>kube_node</strong> æ˜¯é›†ç¾¤ä¸­è¿è¡Œå·¥ä½œè´Ÿè½½çš„èŠ‚ç‚¹ï¼Œå‰ç½®æ¡ä»¶éœ€è¦å…ˆéƒ¨ç½²å¥½kube_masterèŠ‚ç‚¹ï¼Œå®ƒéœ€è¦éƒ¨ç½²å¦‚ä¸‹ç»„ä»¶ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> playbooks/05.kube-node.yml
- hosts: kube_node
  roles:
  - <span class="token punctuation">{</span> role: kube-lb, when: <span class="token string">&quot;inventory_hostname not in groups[&#39;kube_master&#39;]&quot;</span> <span class="token punctuation">}</span>
  - <span class="token punctuation">{</span> role: kube-node, when: <span class="token string">&quot;inventory_hostname not in groups[&#39;kube_master&#39;]&quot;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>kube-lbï¼šç”±nginxè£å‰ªç¼–è¯‘çš„å››å±‚è´Ÿè½½å‡è¡¡ï¼Œç”¨äºå°†è¯·æ±‚è½¬å‘åˆ°ä¸»èŠ‚ç‚¹çš„ apiserveræœåŠ¡</li><li>kubeletï¼škube_nodeä¸Šæœ€ä¸»è¦çš„ç»„ä»¶</li><li>kube-proxyï¼š å‘å¸ƒåº”ç”¨æœåŠ¡ä¸è´Ÿè½½å‡è¡¡</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># ./ezctl setup k8s-01 05</span>
ansible-playbook <span class="token parameter variable">-i</span> clusters/k8s-01/hosts <span class="token parameter variable">-e</span> @clusters/k8s-01/config.yml  playbooks/05.kube-node.yml
<span class="token number">2023</span>-01-04 09:06:25 INFO cluster:k8s-01 setup step:05 begins <span class="token keyword">in</span> 5s, press any key to abort:
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="vdFZC"></a></p><p><strong>éªŒè¯ node çŠ¶æ€</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl status kubelet	<span class="token comment"># æŸ¥çœ‹çŠ¶æ€</span>
systemctl status kube-proxy
journalctl <span class="token parameter variable">-u</span> kubelet		<span class="token comment"># æŸ¥çœ‹æ—¥å¿—</span>
journalctl <span class="token parameter variable">-u</span> kube-proxy 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œ<code> kubectl get node</code> å¯ä»¥çœ‹åˆ°ç±»ä¼¼</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@worker01:/etc/containerd/certs.d/harbor.ceamg.com<span class="token comment"># kubectl get nodes</span>
NAME        STATUS                     ROLES    AGE   VERSION
<span class="token number">10.1</span>.0.31   Ready,SchedulingDisabled   master   21h   v1.24.2
<span class="token number">10.1</span>.0.32   Ready                      <span class="token function">node</span>     21h   v1.24.2
<span class="token number">10.1</span>.0.33   Ready                      <span class="token function">node</span>     21h   v1.24.2

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="Tikl3"></a></p><h2 id="_9-æ­¥éª¤6-éƒ¨ç½²ç½‘ç»œç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_9-æ­¥éª¤6-éƒ¨ç½²ç½‘ç»œç»„ä»¶" aria-hidden="true">#</a> 9.æ­¥éª¤6-éƒ¨ç½²ç½‘ç»œç»„ä»¶</h2><p>é¦–å…ˆå›é¡¾ä¸‹K8Sç½‘ç»œè®¾è®¡åŸåˆ™ï¼Œåœ¨é…ç½®é›†ç¾¤ç½‘ç»œæ’ä»¶æˆ–è€…å®è·µK8S åº”ç”¨/æœåŠ¡éƒ¨ç½²è¯·ç‰¢è®°è¿™äº›åŸåˆ™ï¼š</p><ul><li>1.æ¯ä¸ªPodéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹IPåœ°å€ï¼ŒPodå†…æ‰€æœ‰å®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´</li><li>2.é›†ç¾¤å†…æ‰€æœ‰Podéƒ½åœ¨ä¸€ä¸ªç›´æ¥è¿é€šçš„æ‰å¹³ç½‘ç»œä¸­ï¼Œå¯é€šè¿‡IPç›´æ¥è®¿é—® <ul><li>æ‰€æœ‰å®¹å™¨ä¹‹é—´æ— éœ€NATå°±å¯ä»¥ç›´æ¥äº’ç›¸è®¿é—®</li><li>æ‰€æœ‰Nodeå’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´æ— éœ€NATå°±å¯ä»¥ç›´æ¥äº’ç›¸è®¿é—®</li><li>å®¹å™¨è‡ªå·±çœ‹åˆ°çš„IPè·Ÿå…¶ä»–å®¹å™¨çœ‹åˆ°çš„ä¸€æ ·</li></ul></li><li>3.Service cluster IPåªå¯åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ï¼Œå¤–éƒ¨è¯·æ±‚éœ€è¦é€šè¿‡NodePortã€LoadBalanceæˆ–è€…Ingressæ¥è®¿é—®</li></ul><p>calico æ˜¯k8sç¤¾åŒºæœ€æµè¡Œçš„ç½‘ç»œæ’ä»¶ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯k8s-conformance test é»˜è®¤ä½¿ç”¨çš„ç½‘ç»œæ’ä»¶ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œæ”¯æŒnetwork policyï¼›æ˜¯å½“å‰kubeaszé¡¹ç›®çš„é»˜è®¤ç½‘ç»œæ’ä»¶ã€‚ <br> å¦‚æœéœ€è¦å®‰è£…calicoï¼Œè¯·åœ¨<strong>clusters/xxxx/hosts</strong>æ–‡ä»¶ä¸­è®¾ç½®å˜é‡ <code>CLUSTER_NETWORK=&quot;calico&quot;</code></p><p><a name="B2TM4"></a></p><h3 id="_9-1-ä½¿ç”¨calicoç½‘ç»œç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_9-1-ä½¿ç”¨calicoç½‘ç»œç»„ä»¶" aria-hidden="true">#</a> 9.1 ä½¿â½¤calicoâ½¹ç»œç»„ä»¶</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> clusters/k8s-01/config.yml
<span class="token comment"># ------------------------------------------- calico</span>
<span class="token comment"># [calico]è®¾ç½® CALICO_IPV4POOL_IPIP=â€œoffâ€,å¯ä»¥æé«˜ç½‘ç»œæ€§èƒ½ï¼Œæ¡ä»¶é™åˆ¶è¯¦è§ docs/setup/calico.md</span>
CALICO_IPV4POOL_IPIP: <span class="token string">&quot;Always&quot;</span>

<span class="token comment"># [calico]è®¾ç½® calico-nodeä½¿ç”¨çš„host IPï¼Œbgpé‚»å±…é€šè¿‡è¯¥åœ°å€å»ºç«‹ï¼Œå¯æ‰‹å·¥æŒ‡å®šä¹Ÿå¯ä»¥è‡ªåŠ¨å‘ç°</span>
IP_AUTODETECTION_METHOD: <span class="token string">&quot;can-reach={{ groups[&#39;kube_master&#39;][0] }}&quot;</span>

<span class="token comment"># [calico]è®¾ç½®calico ç½‘ç»œ backend: brid, vxlan, none</span>
CALICO_NETWORKING_BACKEND: <span class="token string">&quot;brid&quot;</span>

<span class="token comment"># [calico]è®¾ç½®calico æ˜¯å¦ä½¿ç”¨route reflectors</span>
<span class="token comment"># å¦‚æœé›†ç¾¤è§„æ¨¡è¶…è¿‡50ä¸ªèŠ‚ç‚¹ï¼Œå»ºè®®å¯ç”¨è¯¥ç‰¹æ€§</span>
CALICO_RR_ENABLED: <span class="token boolean">false</span>

<span class="token comment"># CALICO_RR_NODES é…ç½®route reflectorsçš„èŠ‚ç‚¹ï¼Œå¦‚æœæœªè®¾ç½®é»˜è®¤ä½¿ç”¨é›†ç¾¤masterèŠ‚ç‚¹ </span>
<span class="token comment"># CALICO_RR_NODES: [&quot;192.168.1.1&quot;, &quot;192.168.1.2&quot;]</span>
CALICO_RR_NODES: <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># [calico]æ›´æ–°æ”¯æŒcalico ç‰ˆæœ¬: [v3.3.x] [v3.4.x] [v3.8.x] [v3.15.x]</span>
calico_ver: <span class="token string">&quot;v3.19.4&quot;</span>

<span class="token comment"># [calico]calico ä¸»ç‰ˆæœ¬</span>
calico_ver_main: <span class="token string">&quot;{{ calico_ver.split(&#39;.&#39;)[0] }}.{{ calico_ver.split(&#39;.&#39;)[1] }}&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./ezctl setup k8s-01 06
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><a name="yQBko"></a></p><h3 id="_9-2-éªŒè¯calicoç½‘ç»œ" tabindex="-1"><a class="header-anchor" href="#_9-2-éªŒè¯calicoç½‘ç»œ" aria-hidden="true">#</a> 9.2 éªŒè¯calicoç½‘ç»œ</h3><p>æ‰§è¡Œcalicoå®‰è£…æˆåŠŸåå¯ä»¥éªŒè¯å¦‚ä¸‹ï¼š(éœ€è¦ç­‰å¾…é•œåƒä¸‹è½½å®Œæˆï¼Œæœ‰æ—¶å€™å³ä¾¿ä¸Šä¸€æ­¥å·²ç»é…ç½®äº†dockerå›½å†…åŠ é€Ÿï¼Œè¿˜æ˜¯å¯èƒ½æ¯”è¾ƒæ…¢ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹å®¹å™¨è¿è¡Œèµ·æ¥ä»¥åï¼Œå†æ‰§è¡Œåç»­éªŒè¯æ­¥éª¤)</p><p><a name="uSZT6"></a></p><h3 id="_9-3-æŸ¥çœ‹æ‰€æœ‰calicoèŠ‚ç‚¹çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#_9-3-æŸ¥çœ‹æ‰€æœ‰calicoèŠ‚ç‚¹çŠ¶æ€" aria-hidden="true">#</a> 9.3 æŸ¥çœ‹æ‰€æœ‰calicoèŠ‚ç‚¹çŠ¶æ€</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># kubectl get pod -A -o wide</span>
NAMESPACE     NAME                                       READY   STATUS    RESTARTS   AGE     IP          NODE        NOMINATED NODE   READINESS GATES
kube-system   calico-kube-controllers-5c8bb696bb-hf2cp   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m10s   <span class="token number">10.1</span>.0.33   <span class="token number">10.1</span>.0.33   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
kube-system   calico-node-6nlt6                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m10s   <span class="token number">10.1</span>.0.32   <span class="token number">10.1</span>.0.32   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
kube-system   calico-node-fd6rj                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m10s   <span class="token number">10.1</span>.0.33   <span class="token number">10.1</span>.0.33   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
kube-system   calico-node-lhgh4                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m10s   <span class="token number">10.1</span>.0.31   <span class="token number">10.1</span>.0.31   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># calicoctl node status</span>
Calico process is running.

IPv4 BGP status
+--------------+-------------------+-------+----------+-------------+
<span class="token operator">|</span> PEER ADDRESS <span class="token operator">|</span>     PEER TYPE     <span class="token operator">|</span> STATE <span class="token operator">|</span>  SINCE   <span class="token operator">|</span>    INFO     <span class="token operator">|</span>
+--------------+-------------------+-------+----------+-------------+
<span class="token operator">|</span> <span class="token number">10.1</span>.0.32    <span class="token operator">|</span> node-to-node mesh <span class="token operator">|</span> up    <span class="token operator">|</span> 04:16:44 <span class="token operator">|</span> Established <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">10.1</span>.0.33    <span class="token operator">|</span> node-to-node mesh <span class="token operator">|</span> up    <span class="token operator">|</span> 04:16:43 <span class="token operator">|</span> Established <span class="token operator">|</span>
+--------------+-------------------+-------+----------+-------------+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="gcdLh"></a></p><h3 id="_9-4-åˆ›å»ºå®¹å™¨æµ‹è¯•ç½‘ç»œé€šä¿¡" tabindex="-1"><a class="header-anchor" href="#_9-4-åˆ›å»ºå®¹å™¨æµ‹è¯•ç½‘ç»œé€šä¿¡" aria-hidden="true">#</a> 9.4 åˆ›å»ºå®¹å™¨æµ‹è¯•ç½‘ç»œé€šä¿¡</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># kubectl run net-test1 --image=harbor.ceamg.com/library/alpine sleep 360000</span>
pod/net-test1 created
root@master01:/etc/kubeasz<span class="token comment"># kubectl run net-test2 --image=harbor.ceamg.com/library/alpine sleep 360000</span>
pod/net-test2 created
root@master01:/etc/kubeasz<span class="token comment"># kubectl run net-test3 --image=harbor.ceamg.com/library/alpine sleep 360000</span>
pod/net-test3 created


root@master01:/etc/kubeasz<span class="token comment"># kubectl get pod -o wide</span>
NAME        READY   STATUS    RESTARTS   AGE   IP            NODE        NOMINATED NODE   READINESS GATES
net-test1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          19s   <span class="token number">10.20</span>.5.3     <span class="token number">10.1</span>.0.32   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
net-test2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          15s   <span class="token number">10.20</span>.30.67   <span class="token number">10.1</span>.0.33   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
net-test3   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12s   <span class="token number">10.20</span>.30.68   <span class="token number">10.1</span>.0.33   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token builtin class-name">test</span>        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          16m   <span class="token number">10.20</span>.5.1     <span class="token number">10.1</span>.0.32   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># kubectl exec -it net-test1 -- sh</span>
/ <span class="token comment"># ping 10.20.30.67</span>
PING <span class="token number">10.20</span>.30.67 <span class="token punctuation">(</span><span class="token number">10.20</span>.30.67<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">10.20</span>.30.67: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">62</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.481</span> ms
^C
--- <span class="token number">10.20</span>.30.67 <span class="token function">ping</span> statistics ---
<span class="token number">1</span> packets transmitted, <span class="token number">1</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.481</span>/0.481/0.481 ms
/ <span class="token comment"># ping 10.20.30.68</span>
PING <span class="token number">10.20</span>.30.68 <span class="token punctuation">(</span><span class="token number">10.20</span>.30.68<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">10.20</span>.30.68: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">62</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.631</span> ms
<span class="token number">64</span> bytes from <span class="token number">10.20</span>.30.68: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">62</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">1.360</span> ms
<span class="token number">64</span> bytes from <span class="token number">10.20</span>.30.68: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">62</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.420</span> ms
^C
--- <span class="token number">10.20</span>.30.68 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.420</span>/0.803/1.360 ms
/ <span class="token comment"># ping 223.5.5.5</span>
PING <span class="token number">223.5</span>.5.5 <span class="token punctuation">(</span><span class="token number">223.5</span>.5.5<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">223.5</span>.5.5: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">114</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">7.597</span> ms
<span class="token number">64</span> bytes from <span class="token number">223.5</span>.5.5: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">114</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">7.072</span> ms
<span class="token number">64</span> bytes from <span class="token number">223.5</span>.5.5: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">114</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">7.583</span> ms
^C
--- <span class="token number">223.5</span>.5.5 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">7.072</span>/7.417/7.597 ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="UB4Vd"></a></p><h2 id="_10-æ­¥éª¤7-å®‰è£…é›†ç¾¤æ’ä»¶-coredns" tabindex="-1"><a class="header-anchor" href="#_10-æ­¥éª¤7-å®‰è£…é›†ç¾¤æ’ä»¶-coredns" aria-hidden="true">#</a> 10.æ­¥éª¤7-å®‰è£…é›†ç¾¤æ’ä»¶-coredns</h2><p>DNS æ˜¯ k8s é›†ç¾¤é¦–è¦éƒ¨ç½²çš„ç»„ä»¶ï¼Œå®ƒä¸ºé›†ç¾¤ä¸­çš„å…¶ä»– pods æä¾›åŸŸåè§£ææœåŠ¡ï¼›ä¸»è¦å¯ä»¥è§£æ é›†ç¾¤æœåŠ¡å SVC å’Œ Pod hostnameï¼›ç›®å‰å»ºè®®éƒ¨ç½² corednsã€‚</p><p><a name="HM66U"></a></p><h3 id="_10-1-ä¸‹è½½äºŒè¿›åˆ¶åŒ…" tabindex="-1"><a class="header-anchor" href="#_10-1-ä¸‹è½½äºŒè¿›åˆ¶åŒ…" aria-hidden="true">#</a> 10.1 ä¸‹è½½äºŒè¿›åˆ¶åŒ…</h3><p><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.24.md#downloads-for-v1249" target="_blank" rel="noopener noreferrer">kubernetes/CHANGELOG-1.24.md at master Â· kubernetes/kubernetes<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/usr/local/src<span class="token comment"># ll</span>
total <span class="token number">489740</span>
drwxr-xr-x  <span class="token number">2</span> root root      <span class="token number">4096</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:09 ./
drwxr-xr-x <span class="token number">13</span> root root      <span class="token number">4096</span> Jan  <span class="token number">1</span> <span class="token number">13</span>:20 <span class="token punctuation">..</span>/
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">30495559</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:09 kubernetes-client-linux-amd64.tar.gz
-rw-r--r--  <span class="token number">1</span> root root <span class="token number">123361203</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:09 kubernetes-node-linux-amd64.tar.gz
-rw-r--r--  <span class="token number">1</span> root root <span class="token number">347075448</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:09 kubernetes-server-linux-amd64.tar.gz
-rw-r--r--  <span class="token number">1</span> root root    <span class="token number">532769</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:09 kubernetes.tar.gz

<span class="token comment">#è§£å‹å</span>
root@master01:/usr/local/src/kubernetes<span class="token comment"># ll</span>
total <span class="token number">36996</span>
drwxr-xr-x <span class="token number">10</span> root root     <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 ./
drwxr-xr-x  <span class="token number">3</span> root root     <span class="token number">4096</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:11 <span class="token punctuation">..</span>/
drwxr-xr-x  <span class="token number">2</span> root root     <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 addons/
drwxr-xr-x  <span class="token number">3</span> root root     <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 client/
drwxr-xr-x  <span class="token number">9</span> root root     <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 cluster/
drwxr-xr-x  <span class="token number">2</span> root root     <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 docs/
drwxr-xr-x  <span class="token number">3</span> root root     <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 hack/
-rw-r--r--  <span class="token number">1</span> root root <span class="token number">37826576</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kubernetes-src.tar.gz
drwxr-xr-x  <span class="token number">4</span> root root     <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 LICENSES/
drwxr-xr-x  <span class="token number">3</span> root root     <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:25 node/
-rw-r--r--  <span class="token number">1</span> root root     <span class="token number">4443</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 README.md
drwxr-xr-x  <span class="token number">3</span> root root     <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 server/
-rw-r--r--  <span class="token number">1</span> root root        <span class="token number">8</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 version

<span class="token comment">#æ’ä»¶ç›®å½•</span>

root@master01:/usr/local/src/kubernetes/cluster/addons<span class="token comment"># ll</span>
total <span class="token number">80</span>
drwxr-xr-x <span class="token number">18</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 ./
drwxr-xr-x  <span class="token number">9</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 <span class="token punctuation">..</span>/
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 addon-manager/
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 calico-policy-controller/
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 cluster-loadbalancing/
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 device-plugins/
drwxr-xr-x  <span class="token number">5</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 dns/
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 dns-horizontal-autoscaler/
drwxr-xr-x  <span class="token number">4</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 fluentd-gcp/
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 ip-masq-agent/
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 kube-proxy/
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 metadata-agent/
drwxr-xr-x  <span class="token number">3</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 metadata-proxy/
drwxr-xr-x  <span class="token number">2</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 metrics-server/
drwxr-xr-x  <span class="token number">5</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 node-problem-detector/
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">104</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 OWNERS
drwxr-xr-x  <span class="token number">8</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 rbac/
-rw-r--r--  <span class="token number">1</span> root root <span class="token number">1655</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 README.md
drwxr-xr-x  <span class="token number">8</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 storage-class/
drwxr-xr-x  <span class="token number">4</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 volumesnapshots/


root@master01:/usr/local/src/kubernetes/cluster/addons/dns/coredns<span class="token comment"># ll</span>
total <span class="token number">44</span>
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 ./
drwxr-xr-x <span class="token number">5</span> root root <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 <span class="token punctuation">..</span>/
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">5060</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 coredns.yaml.base
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">5110</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 coredns.yaml.in
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">5112</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 coredns.yaml.sed
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1075</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 Makefile
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">344</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 transforms2salt.sed
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">287</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 transforms2sed.sed


<span class="token function">cp</span> coredns.yaml.base /root/

<span class="token function">mv</span> /root/coredns.yaml.base  /root/coredns-ceamg.yaml

<span class="token function">vim</span> /root/coredns-ceamg.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="ISh01"></a></p><h3 id="_10-2-ä¿®æ”¹é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_10-2-ä¿®æ”¹é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> 10.2 ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p><strong>ä¸»è¦é…ç½®å‚æ•°ï¼š</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>error: <span class="token comment">#é”™è¯¯â½‡å¿—è¾“å‡ºåˆ°stdoutã€‚</span>
healthï¼š <span class="token comment">#CoreDNSçš„è¿â¾çŠ¶å†µæŠ¥å‘Šä¸ºhttp://localhost:8080/health.</span>
cacheï¼š <span class="token comment">#å¯â½¤corednsç¼“å­˜ã€‚</span>
reloadï¼š<span class="token comment">#é…ç½®â¾ƒåŠ¨é‡æ–°åŠ è½½é…ç½®â½‚ä»¶ï¼Œå¦‚æœä¿®æ”¹äº†ConfigMapçš„é…ç½®ï¼Œä¼šåœ¨ä¸¤åˆ†é’Ÿåâ½£æ•ˆ.</span>
loadbalanceï¼š<span class="token comment">#â¼€ä¸ªåŸŸåæœ‰å¤šä¸ªè®°å½•ä¼šè¢«è½®è¯¢è§£æã€‚</span>
cache <span class="token number">30</span> <span class="token comment">#ç¼“å­˜æ—¶é—´</span>
kubernetesï¼š<span class="token comment">#CoreDNSå°†æ ¹æ®æŒ‡å®šçš„service domainåç§°åœ¨Kubernetes SVCä¸­è¿›â¾åŸŸåè§£æã€‚</span>
forwardï¼š <span class="token comment">#ä¸æ˜¯Kubernetesé›†ç¾¤åŸŸå†…çš„åŸŸåæŸ¥è¯¢éƒ½è¿›â¾è½¬å‘æŒ‡å®šçš„æœåŠ¡å™¨ï¼ˆ/etc/resolv.confï¼‰</span>
prometheusï¼š<span class="token comment">#CoreDNSçš„æŒ‡æ ‡æ•°æ®å¯ä»¥é…ç½®Prometheus è®¿é—®http://coredns svc:9153/metrics è¿›â¾æ”¶é›†ã€‚</span>
readyï¼š<span class="token comment">#å½“coredns æœåŠ¡å¯åŠ¨å®Œæˆåä¼šè¿›â¾åœ¨çŠ¶æ€ç›‘æµ‹ï¼Œä¼šæœ‰ä¸ªURL è·¯å¾„ä¸º/readyè¿”å›200çŠ¶æ€ç ï¼Œå¦åˆ™è¿”å›æŠ¥é”™ã€‚</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>kubernetes __DNS__DOMAIN_</code>æ˜¯ <code>clusters/k8s-01/hosts</code> ä¸­å¡«å†™çš„å†…å®¹<code>CLUSTER_DNS_DOMAIN</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Cluster DNS Domain</span>
<span class="token assign-left variable">CLUSTER_DNS_DOMAIN</span><span class="token operator">=</span><span class="token string">&quot;ceamg.local&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>212 <code>clusterIP: __DNS__SERVER__</code>æ˜¯<code>clusters/k8s-01/hosts</code> ä¸­å¡«å†™çš„å†…å®¹<code>SERVICE_CIDR</code> ç¬¬äºŒä¸ªIP ä¹Ÿå°±æ˜¯ 10.10.0.2</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># K8S Service CIDR, not overlap with node(host) networking</span>
<span class="token assign-left variable">SERVICE_CIDR</span><span class="token operator">=</span>&quot;10.10.0.0/16


/ <span class="token comment"># cat /etc/resolv.conf </span>
search default.svc.ceamg.local svc.ceamg.local ceamg.local
nameserver <span class="token number">10.10</span>.0.2

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹å¦‚ä¸‹è¡Œå†…å®¹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">77</span>         kubernetes ceamg.local in-addr.arpa ip6.arpa <span class="token punctuation">{</span>
<span class="token number">83</span>         forward <span class="token builtin class-name">.</span> <span class="token number">192.168</span>.0.15 <span class="token punctuation">{</span>
<span class="token number">142</span>         image: harbor.ceamg.com/baseimages/coredns:v1.8.6
<span class="token number">145</span>           limits:
<span class="token number">146</span>             memory: 2048Mi
<span class="token number">147</span>           requests:
<span class="token number">148</span>             cpu: 1000m
<span class="token number">149</span>             memory: 1024Mi
<span class="token number">212</span>   clusterIP: <span class="token number">10.10</span>.0.2


<span class="token number">209</span> spec:
<span class="token number">210</span>   type: NodePort
<span class="token number">211</span>   selector:
<span class="token number">212</span>     k8s-app: kube-dns
<span class="token number">213</span>   clusterIP: <span class="token number">10.10</span>.0.2
<span class="token number">214</span>   ports:
<span class="token number">215</span>   - name: dns
<span class="token number">216</span>     port: <span class="token number">53</span>
<span class="token number">217</span>     protocol: UDP
<span class="token number">218</span>   - name: dns-tcp
<span class="token number">219</span>     port: <span class="token number">53</span>
<span class="token number">220</span>     protocol: TCP
<span class="token number">221</span>   - name: metrics
<span class="token number">222</span>     port: <span class="token number">9153</span>
<span class="token number">223</span>     protocol: TCP
<span class="token number">224</span>     targetPort: <span class="token number">9153</span>
<span class="token number">225</span>     nodePort: <span class="token number">30009</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æŸ¥çœ‹èµ„æºæ ¼å¼ï¼š kubectl explain</p></blockquote><p><a name="lxLe9"></a></p><h3 id="_10-3-ä¸‹è½½é•œåƒå¹¶æ¨é€åˆ°harbor" tabindex="-1"><a class="header-anchor" href="#_10-3-ä¸‹è½½é•œåƒå¹¶æ¨é€åˆ°harbor" aria-hidden="true">#</a> 10.3 ä¸‹è½½é•œåƒå¹¶æ¨é€åˆ°harbor</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/usr/local/src/kubernetes/cluster/addons/dns/coredns<span class="token comment"># nerdctl pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.8.6</span>
root@master01:/usr/local/src/kubernetes/cluster/addons/dns/coredns<span class="token comment"># nerdctl tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.8.6 harbor.ceamg.com/baseimages/coredns:v1.8.6</span>
root@master01:/usr/local/src/kubernetes/cluster/addons/dns/coredns<span class="token comment"># nerdctl push harbor.ceamg.com/baseimages/coredns:v1.8.6</span>
INFO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> pushing as a reduced-platform image <span class="token punctuation">(</span>application/vnd.docker.distribution.manifest.list.v2+json, sha256:53011ff05d62cd740ae785a98f646ace63374073b0e564a35d4cea008f040940<span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="wibT3"></a></p><h3 id="_10-4-å®‰è£…coredns" tabindex="-1"><a class="header-anchor" href="#_10-4-å®‰è£…coredns" aria-hidden="true">#</a> 10.4 å®‰è£…coredns</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/usr/local/src/kubernetes/cluster/addons/dns/coredns<span class="token comment"># kubectl apply -f /root/coredns-ceamg.yaml </span>
serviceaccount/coredns created
clusterrole.rbac.authorization.k8s.io/system:coredns created
clusterrolebinding.rbac.authorization.k8s.io/system:coredns created
configmap/coredns created
deployment.apps/coredns created
service/kube-dns created

root@master01:~<span class="token comment"># kubectl get pod -A</span>
NAMESPACE     NAME                                       READY   STATUS    RESTARTS      AGE
default       net-test1                                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>             25m
default       net-test2                                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>             25m
default       net-test3                                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>             25m
default       net-test4                                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>             49m
kube-system   calico-kube-controllers-5c8bb696bb-hf2cp   <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>57m ago<span class="token punctuation">)</span>   151m
kube-system   calico-node-6nlt6                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>             151m
kube-system   calico-node-fd6rj                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>             151m
kube-system   calico-node-lhgh4                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>             151m
kube-system   coredns-6c496b89f6-hd8vf                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>             3s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="cULzt"></a></p><h3 id="_10-5-å¯åŠ¨å®¹å™¨æµ‹è¯•åŸŸåè§£æ" tabindex="-1"><a class="header-anchor" href="#_10-5-å¯åŠ¨å®¹å™¨æµ‹è¯•åŸŸåè§£æ" aria-hidden="true">#</a> 10.5 å¯åŠ¨å®¹å™¨æµ‹è¯•åŸŸåè§£æ</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:~<span class="token comment"># kubectl exec -it net-test1 </span>
error: you must specify at least one <span class="token builtin class-name">command</span> <span class="token keyword">for</span> the container
root@master01:~<span class="token comment"># kubectl exec -it net-test1  -- sh</span>
/ <span class="token comment"># </span>
/ <span class="token comment"># ping www.baidu.com</span>
PING www.baidu.com <span class="token punctuation">(</span><span class="token number">110.242</span>.68.3<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">110.242</span>.68.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">49</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">9.778</span> ms

--- www.baidu.com <span class="token function">ping</span> statistics ---
<span class="token number">1</span> packets transmitted, <span class="token number">1</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">9.778</span>/9.778/9.778 ms
/ <span class="token comment"># </span>
/ <span class="token comment"># cat /etc/resolv.conf </span>
search default.svc.ceamg.local svc.ceamg.local ceamg.local
nameserver <span class="token number">10.10</span>.0.2
options ndots:5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="RvzW5"></a></p><h3 id="_10-6-æµ‹è¯•-prometheus-ç›‘æ§é¡¹" tabindex="-1"><a class="header-anchor" href="#_10-6-æµ‹è¯•-prometheus-ç›‘æ§é¡¹" aria-hidden="true">#</a> 10.6 æµ‹è¯• prometheus ç›‘æ§é¡¹</h3><p><a href="http://10.1.0.31:30009/metrics" target="_blank" rel="noopener noreferrer">http://10.1.0.31:30009/metrics<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><br><img src="http://cdn1.ryanxin.live/1672815227326-157edf5d-ca34-48af-be12-9e8c529e0271.png" alt="prometheusç›‘æ§é¡¹æ¥å£è®¿é—®" loading="lazy"></p><p><a name="qCMg3"></a></p><h2 id="_11-æ­¥éª¤8-å®‰è£…é›†ç¾¤æ’ä»¶-dashboard" tabindex="-1"><a class="header-anchor" href="#_11-æ­¥éª¤8-å®‰è£…é›†ç¾¤æ’ä»¶-dashboard" aria-hidden="true">#</a> 11. æ­¥éª¤8-å®‰è£…é›†ç¾¤æ’ä»¶-dashboard</h2><p><a href="https://github.com/kubernetes/dashboard" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/dashboard<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a name="JL93f"></a></p><h3 id="_11-1-ä¸‹è½½å¯¹åº”kubernetesç‰ˆæœ¬çš„dashboard" tabindex="-1"><a class="header-anchor" href="#_11-1-ä¸‹è½½å¯¹åº”kubernetesç‰ˆæœ¬çš„dashboard" aria-hidden="true">#</a> 11.1 ä¸‹è½½å¯¹åº”kubernetesç‰ˆæœ¬çš„dashboard</h3><p><strong>Compatibility</strong></p><table><thead><tr><th>Kubernetes version</th><th>1.21</th><th>1.22</th><th>1.23</th><th>1.24</th></tr></thead><tbody><tr><td>Compatibility</td><td>?</td><td>?</td><td>?</td><td>âœ“</td></tr></tbody></table><ul><li>âœ“ Fully supported version range.</li><li>? Due to breaking changes between Kubernetes API versions, some features might not work correctly in the Dashboard.</li></ul><figure><img src="http://cdn1.ryanxin.live/1672820696762-d1dfdf70-772d-43c6-9047-43d17459f886.png" alt="2.6.1ç‰ˆæœ¬" tabindex="0" loading="lazy"><figcaption>2.6.1ç‰ˆæœ¬</figcaption></figure><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># Copyright 2017 The Kubernetes Authors.</span>
<span class="token comment">#</span>
<span class="token comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="token comment"># you may not use this file except in compliance with the License.</span>
<span class="token comment"># You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8443</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>certs
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>csrf
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">csrf</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>key<span class="token punctuation">-</span>holder
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>settings
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token comment"># Allow Dashboard to get, update and delete Dashboard exclusive secrets.</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;secrets&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;kubernetes-dashboard-key-holder&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;kubernetes-dashboard-certs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;kubernetes-dashboard-csrf&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span>
    <span class="token comment"># Allow Dashboard to get and update &#39;kubernetes-dashboard-settings&#39; config map.</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;configmaps&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;kubernetes-dashboard-settings&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span>
    <span class="token comment"># Allow Dashboard to get metrics.</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;services&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;heapster&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dashboard-metrics-scraper&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;proxy&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;services/proxy&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;heapster&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http:heapster:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https:heapster:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dashboard-metrics-scraper&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http:dashboard-metrics-scraper&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">]</span>

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token comment"># Allow Metrics Scraper to get metrics from the Metrics server</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;metrics.k8s.io&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pods&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nodes&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">]</span>

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
        <span class="token key atrule">seccompProfile</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> RuntimeDefault
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
          <span class="token key atrule">image</span><span class="token punctuation">:</span> kubernetesui/dashboard<span class="token punctuation">:</span>v2.6.1
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8443</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>auto<span class="token punctuation">-</span>generate<span class="token punctuation">-</span>certificates
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>namespace=kubernetes<span class="token punctuation">-</span>dashboard
            <span class="token comment"># Uncomment the following line to manually specify Kubernetes API server Host</span>
            <span class="token comment"># If not specified, Dashboard will attempt to auto discover the API server and connect</span>
            <span class="token comment"># to it. Uncomment only if the default does not work.</span>
            <span class="token comment"># - --apiserver-host=http://my-address:port</span>
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>certs
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /certs
              <span class="token comment"># Create on-disk volume to store exec logs</span>
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp
              <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp<span class="token punctuation">-</span>volume
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTPS
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8443</span>
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
          <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1001</span>
            <span class="token key atrule">runAsGroup</span><span class="token punctuation">:</span> <span class="token number">2001</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>certs
          <span class="token key atrule">secret</span><span class="token punctuation">:</span>
            <span class="token key atrule">secretName</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>certs
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp<span class="token punctuation">-</span>volume
          <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">&quot;kubernetes.io/os&quot;</span><span class="token punctuation">:</span> linux
      <span class="token comment"># Comment the following tolerations if Dashboard must not be deployed on master</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master
          <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8000</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
        <span class="token key atrule">seccompProfile</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> RuntimeDefault
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
          <span class="token key atrule">image</span><span class="token punctuation">:</span> kubernetesui/metrics<span class="token punctuation">-</span>scraper<span class="token punctuation">:</span>v1.0.8
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8000</span>
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp
            <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp<span class="token punctuation">-</span>volume
          <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1001</span>
            <span class="token key atrule">runAsGroup</span><span class="token punctuation">:</span> <span class="token number">2001</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">&quot;kubernetes.io/os&quot;</span><span class="token punctuation">:</span> linux
      <span class="token comment"># Comment the following tolerations if Dashboard must not be deployed on master</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master
          <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp<span class="token punctuation">-</span>volume
          <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="yuxNQ"></a></p><h3 id="_11-2-ä¿®æ”¹serviceæš´éœ²æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_11-2-ä¿®æ”¹serviceæš´éœ²æ–¹å¼" aria-hidden="true">#</a> 11.2 ä¿®æ”¹serviceæš´éœ²æ–¹å¼</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">32 kind</span><span class="token punctuation">:</span> Service
 <span class="token key atrule">33 apiVersion</span><span class="token punctuation">:</span> v1
 <span class="token key atrule">34 metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">35   labels</span><span class="token punctuation">:</span>
 <span class="token key atrule">36     k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
 <span class="token key atrule">37   name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
 <span class="token key atrule">38   namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
 <span class="token key atrule">39 spec</span><span class="token punctuation">:</span>
 <span class="token key atrule">40   type</span><span class="token punctuation">:</span> NodePort
 <span class="token key atrule">41   ports</span><span class="token punctuation">:</span>
 <span class="token key atrule">42     - port</span><span class="token punctuation">:</span> <span class="token number">443</span>
 <span class="token key atrule">43       targetPort</span><span class="token punctuation">:</span> <span class="token number">8443</span>
 <span class="token key atrule">44       nodePort</span><span class="token punctuation">:</span> <span class="token number">30010</span>
 <span class="token key atrule">45   selector</span><span class="token punctuation">:</span>
 <span class="token key atrule">46     k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="miyGC"></a></p><h3 id="_11-3-ä¸‹è½½é•œåƒæ¨é€åˆ°harbor" tabindex="-1"><a class="header-anchor" href="#_11-3-ä¸‹è½½é•œåƒæ¨é€åˆ°harbor" aria-hidden="true">#</a> 11.3 ä¸‹è½½é•œåƒæ¨é€åˆ°harbor</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>root@master01<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># cat k8s-dashboard-ceamg.yml | grep image</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> kubernetesui/dashboard<span class="token punctuation">:</span>v2.6.1
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
          <span class="token key atrule">image</span><span class="token punctuation">:</span> kubernetesui/metrics<span class="token punctuation">-</span>scraper<span class="token punctuation">:</span>v1.0.8


root@master01<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment">#nerdctl pull kubernetesui/dashboard:v2.6.1</span>
root@master01<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># nerdctl pull kubernetesui/metrics-scraper:v1.0.8</span>


root@master01<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># nerdctl tag kubernetesui/dashboard:v2.6.1 harbor.ceamg.com/baseimages/dashboard:v2.6.1</span>
root@master01<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># nerdctl push harbor.ceamg.com/baseimages/dashboard:v2.6.1</span>
INFO<span class="token punctuation">[</span><span class="token number">0000</span><span class="token punctuation">]</span> pushing as a reduced<span class="token punctuation">-</span>platform image (application/vnd.docker.distribution.manifest.list.v2+json<span class="token punctuation">,</span> sha256<span class="token punctuation">:</span>f12df071f8bad3e1965b5246095bd3f78df0eb76ceabcc0878d42849d33e4a10) 
<span class="token key atrule">index-sha256:f12df071f8bad3e1965b5246095bd3f78df0eb76ceabcc0878d42849d33e4a10</span><span class="token punctuation">:</span>    done           <span class="token punctuation">|</span>++++++++++++++++++++++++++++++++++++++<span class="token punctuation">|</span> 
<span class="token key atrule">manifest-sha256:d95e1adbe846450bf9451f9c95ab33865115909cf3962960af5983bb916cf320</span><span class="token punctuation">:</span> done           <span class="token punctuation">|</span>++++++++++++++++++++++++++++++++++++++<span class="token punctuation">|</span> 
<span class="token key atrule">config-sha256:783e2b6d87ed93a9f9fee34e84c2b029b7a9572b2f41f761437e58af9c26827f</span><span class="token punctuation">:</span>   done           <span class="token punctuation">|</span>++++++++++++++++++++++++++++++++++++++<span class="token punctuation">|</span> 
<span class="token key atrule">elapsed</span><span class="token punctuation">:</span> <span class="token key atrule">3.2 s                                                                    total</span><span class="token punctuation">:</span>  2.5 Ki (814.0 B/s)                                       
root@master01<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># </span>
root@master01<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># nerdctl tag kubernetesui/metrics-scraper:v1.0.8 harbor.ceamg.com/baseimages/metrics-scraper:v1.0.8</span>
root@master01<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># nerdctl push harbor.ceamg.com/baseimages/metrics-scraper:v1.0.8</span>
INFO<span class="token punctuation">[</span><span class="token number">0000</span><span class="token punctuation">]</span> pushing as a reduced<span class="token punctuation">-</span>platform image (application/vnd.docker.distribution.manifest.list.v2+json<span class="token punctuation">,</span> sha256<span class="token punctuation">:</span>9fdef455b4f9a8ee315a0aa3bd71787cfd929e759da3b4d7e65aaa56510d747b) 
<span class="token key atrule">index-sha256:9fdef455b4f9a8ee315a0aa3bd71787cfd929e759da3b4d7e65aaa56510d747b</span><span class="token punctuation">:</span>    done           <span class="token punctuation">|</span>++++++++++++++++++++++++++++++++++++++<span class="token punctuation">|</span> 
<span class="token key atrule">manifest-sha256:43227e8286fd379ee0415a5e2156a9439c4056807e3caa38e1dd413b0644807a</span><span class="token punctuation">:</span> done           <span class="token punctuation">|</span>++++++++++++++++++++++++++++++++++++++<span class="token punctuation">|</span> 
<span class="token key atrule">config-sha256:115053965e86b2df4d78af78d7951b8644839d20a03820c6df59a261103315f7</span><span class="token punctuation">:</span>   done           <span class="token punctuation">|</span>++++++++++++++++++++++++++++++++++++++<span class="token punctuation">|</span> 
<span class="token key atrule">elapsed</span><span class="token punctuation">:</span> <span class="token key atrule">0.8 s        total</span><span class="token punctuation">:</span>  2.2 Ki (2.7 KiB/s)                                   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="j86UC"></a></p><h3 id="_11-4-ä¿®æ”¹é•œåƒåœ°å€" tabindex="-1"><a class="header-anchor" href="#_11-4-ä¿®æ”¹é•œåƒåœ°å€" aria-hidden="true">#</a> 11.4 ä¿®æ”¹é•œåƒåœ°å€</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">195           image</span><span class="token punctuation">:</span> harbor.ceamg.com/baseimages/dashboard<span class="token punctuation">:</span>v2.6.1
<span class="token key atrule">280           image</span><span class="token punctuation">:</span> harbor.ceamg.com/baseimages/metrics<span class="token punctuation">-</span>scraper<span class="token punctuation">:</span>v1.0.8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="KF19j"></a></p><h3 id="_11-5-å®‰è£…dashboardç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_11-5-å®‰è£…dashboardç»„ä»¶" aria-hidden="true">#</a> 11.5 å®‰è£…dashboardç»„ä»¶</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> k8s-dashboard-ceamg.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><a name="HQ93h"></a></p><h3 id="_11-6-æŸ¥çœ‹ç»„ä»¶è¿è¡ŒçŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#_11-6-æŸ¥çœ‹ç»„ä»¶è¿è¡ŒçŠ¶æ€" aria-hidden="true">#</a> 11.6 æŸ¥çœ‹ç»„ä»¶è¿è¡ŒçŠ¶æ€</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>root@master01<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl get pod -A</span>
NAMESPACE              NAME                                        READY   STATUS    RESTARTS       AGE
default                net<span class="token punctuation">-</span>test1                                   1/1     Running   0              99m
default                net<span class="token punctuation">-</span>test2                                   1/1     Running   0              99m
default                net<span class="token punctuation">-</span>test3                                   1/1     Running   0              99m
default                net<span class="token punctuation">-</span>test4                                   1/1     Running   0              123m
kube<span class="token punctuation">-</span>system            calico<span class="token punctuation">-</span>kube<span class="token punctuation">-</span>controllers<span class="token punctuation">-</span>5c8bb696bb<span class="token punctuation">-</span>hf2cp    1/1     Running   1 (131m ago)   3h45m
kube<span class="token punctuation">-</span>system            calico<span class="token punctuation">-</span>node<span class="token punctuation">-</span>6nlt6                           1/1     Running   0              3h45m
kube<span class="token punctuation">-</span>system            calico<span class="token punctuation">-</span>node<span class="token punctuation">-</span>fd6rj                           1/1     Running   0              3h45m
kube<span class="token punctuation">-</span>system            calico<span class="token punctuation">-</span>node<span class="token punctuation">-</span>lhgh4                           1/1     Running   0              3h45m
kube<span class="token punctuation">-</span>system            coredns<span class="token punctuation">-</span>6c496b89f6<span class="token punctuation">-</span>hd8vf                    1/1     Running   0              73m
kubernetes<span class="token punctuation">-</span>dashboard   dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper<span class="token punctuation">-</span>8b9c56ffb<span class="token punctuation">-</span>tjjc4   1/1     Running   0              14s
kubernetes<span class="token punctuation">-</span>dashboard   kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>6f9f585c48<span class="token punctuation">-</span>vv2pz       1/1     Running   0              14s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="BQVpO"></a></p><h3 id="_11-7-è·å–ç™»é™†-token" tabindex="-1"><a class="header-anchor" href="#_11-7-è·å–ç™»é™†-token" aria-hidden="true">#</a> 11.7 è·å–ç™»é™† token</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> admin<span class="token punctuation">-</span>user
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> admin<span class="token punctuation">-</span>user
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>admin
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> admin<span class="token punctuation">-</span>user
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard


root@master01<span class="token punctuation">:</span><span class="token null important">~</span><span class="token comment"># kubectl apply -f admin-user.yml </span>
serviceaccount/admin<span class="token punctuation">-</span>user created
clusterrolebinding.rbac.authorization.k8s.io/admin<span class="token punctuation">-</span>user created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">æ³¨æ„</p><p><strong>æ³¨æ„</strong>ï¼šv1.24.0 æ›´æ–°ä¹‹åè¿›è¡Œåˆ›å»º ServiceAccount ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆ Secret éœ€è¦å¯¹å…¶æ‰‹åŠ¨åˆ›å»º</p></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åˆ›å»ºtoken</span>
root@master01:~<span class="token comment"># kubectl -n kubernetes-dashboard create token admin-user --duration 604800s</span>
eyJhbGciOiJSUzI1NiIsImtpZCI6ImptTldRRDRZZVVSdXRhaU1RNUtyQmJUSmVTbW55VThqNHhLU1l6U3B4R28ifQ.eyJhdWQiOlsiYXBpIiwiaXN0aW8tY2EiXSwiZXhwIjoxNjczNDI1MDI3LCJpYXQiOjE2NzI4MjAyMjcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2YyIsImt1YmVybmV0ZXMuaW8iOnsibmFtZXNwYWNlIjoia3ViZXJuZXRlcy1kYXNoYm9hcmQiLCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiYWRtaW4tdXNlciIsInVpZCI6IjdhNTAzN2E4LTQ2MGEtNGM3YS05NWQ5LTNjM2JkNGQ0YTUyZSJ9fSwibmJmIjoxNjcyODIwMjI3LCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.ciX6c6hUe8NqPHWp7GteAecZ75L50sKL0l0jk6hETJM9xUVkE-knhm-wQWogOCq1vJMWtg_qeYqsyxfFAMbXdnGgXUXH3tuLVe0NcSHfGVa0BBfjUqODODoAcKdEWJJqdTO_QCfzHTTGkBDZoPgqjALBFzMVh_anlUdeSehRtTh6y2L0dsMRbWuEp1YI8phXumRGIbsrRDOenCycfyPh2AUEChMhD_uYS85z2tDVbno-1y4sSoSiPPn-awUEAxo-ly7zIOUz_b6ZiMhM6nGTuJ-7Jyxq4A8f2pj-iyXA_ve3g1Y4AaInd1aaZhCQ_82rOpmHP0Idyzg_lqEneltBaw
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–¹å¼äºŒ<br>æ‰‹åŠ¨åˆ›å»ºsecrit</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/zookeeper<span class="token comment"># kubectl apply -f secrit </span>
secret/admin-user created

apiVersion: v1
kind: Secret
type: kubernetes.io/service-account-token
metadata:
  name: admin-user
  namespace: kubernetes-dashboard
  annotations:
    kubernetes.io/service-account.name: <span class="token string">&quot;admin-user&quot;</span>



root@master01:/zookeeper<span class="token comment"># kubectl -n kubernetes-dashboard describe sa admin-user</span>
Name:                admin-user
Namespace:           kubernetes-dashboard
Labels:              <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Image pull secrets:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Mountable secrets:   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Tokens:              admin-user
Events:              <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
root@master01:/zookeeper<span class="token comment"># kubectl -n kubernetes-dashboard describe secrets admin-user</span>
Name:         admin-user
Namespace:    kubernetes-dashboard
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  kubernetes.io/service-account.name: admin-user
              kubernetes.io/service-account.uid: 7a5037a8-460a-4c7a-95d9-3c3bd4d4a52e

Type:  kubernetes.io/service-account-token

Data
<span class="token operator">==</span><span class="token operator">==</span>
namespace:  <span class="token number">20</span> bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6ImptTldRRDRZZVVSdXRhaU1RNUtyQmJUSmVTbW55VThqNHhLU1l6U3B4R28ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI3YTUwMzdhOC00NjBhLTRjN2EtOTVkOS0zYzNiZDRkNGE1MmUiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.YIZ1UepKs7WzebxKMOVIPkmz0KLkIyV59S7D0x4sBpefqseX6lSfV_YbhDjQv0dm6ne9HJ85dHzF1-qmSJEO_EW3m-aNOfmem7jkqr8XDUIgHceeKZimauTodKvApsWWD_Flsk7r2nin-MoNkOJ5mi6g5Pu3iQuKhQINl3G9Wwch5c-5FV0l-RBWR1rw9rVby6fh1jfkAhMWGL7lWKJeAA6fE2dTJVSJ-ZhW_bzwPTTDKNhIlpRsyKEnFXwWmK9Jqoxq8y5H0iJIhbvkYCxwUG2Gjjfi6jIWhJvWo20_kTq5Cy-7BNXafBI5D6VKmFwHFyOLBQcvkntN2IpVRNcfbA
ca.crt:     <span class="token number">1302</span> bytes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://blog.csdn.net/qq_41619571/article/details/127217339" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_41619571/article/details/127217339<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a name="LVYtG"></a></p><h3 id="_11-8-ç™»å½•æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_11-8-ç™»å½•æµ‹è¯•" aria-hidden="true">#</a> 11.8 ç™»å½•æµ‹è¯•</h3><figure><img src="http://cdn1.ryanxin.live/1672820370137-de794fe7-65da-418b-85a4-b92f3b8b3e42.png" alt="è¾“å…¥token" tabindex="0" loading="lazy"><figcaption>è¾“å…¥token</figcaption></figure><figure><img src="http://cdn1.ryanxin.live/1672820388726-cab07cf9-cbb9-4db3-bb1d-ef6ecfab21ff.png" alt="ç•Œé¢å±•ç¤º" tabindex="0" loading="lazy"><figcaption>ç•Œé¢å±•ç¤º</figcaption></figure><p><a name="F03jb"></a></p><h2 id="_12-é›†ç¾¤ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#_12-é›†ç¾¤ç®¡ç†" aria-hidden="true">#</a> 12. é›†ç¾¤ç®¡ç†</h2><p>é›†ç¾¤ç®¡ç†ä¸»è¦æ˜¯æ·»åŠ masterã€æ·»åŠ nodeã€åˆ é™¤masterä¸åˆ é™¤nodeç­‰èŠ‚ç‚¹ç®¡ç†åŠç›‘æ§</p><p><a name="K5WEr"></a></p><h3 id="_12-1-æ·»åŠ nodeèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_12-1-æ·»åŠ nodeèŠ‚ç‚¹" aria-hidden="true">#</a> 12.1 æ·»åŠ nodeèŠ‚ç‚¹</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./ezctl add-node k8s-01 <span class="token number">10.1</span>.0.39
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><a name="wkLu3"></a></p><h3 id="_12-2-æ·»åŠ master-èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_12-2-æ·»åŠ master-èŠ‚ç‚¹" aria-hidden="true">#</a> 12.2 æ·»åŠ master èŠ‚ç‚¹</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/etc/kubeasz<span class="token comment"># ./ezctl add-master k8s-01 10.1.0.30</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>master èŠ‚ç‚¹æ·»åŠ åä¼šå‘ nodeèŠ‚ç‚¹ <code>/etc/kube-lb/conf/kube-lb.conf</code> ä¸­æ·»åŠ åå‘ä»£ç†èŠ‚ç‚¹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>user root<span class="token punctuation">;</span>
worker_processes <span class="token number">1</span><span class="token punctuation">;</span>

error_log  /etc/kube-lb/logs/error.log warn<span class="token punctuation">;</span>

events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">3000</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

stream <span class="token punctuation">{</span>
    upstream backend <span class="token punctuation">{</span>
        server <span class="token number">10.1</span>.0.30:6443    <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>3s<span class="token punctuation">;</span>
        server <span class="token number">10.1</span>.0.31:6443    <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>3s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    server <span class="token punctuation">{</span>
        listen <span class="token number">127.0</span>.0.1:6443<span class="token punctuation">;</span>
        proxy_connect_timeout 1s<span class="token punctuation">;</span>
        proxy_pass backend<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="laKNR"></a></p><h3 id="_12-3-éªŒè¯å½“å‰èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_12-3-éªŒè¯å½“å‰èŠ‚ç‚¹" aria-hidden="true">#</a> 12.3 éªŒè¯å½“å‰èŠ‚ç‚¹</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master02:~<span class="token comment"># kubectl get nodes</span>
NAME        STATUS                     ROLES    AGE   VERSION
<span class="token number">10.1</span>.0.30   Ready,SchedulingDisabled   master   15m   v1.24.2
<span class="token number">10.1</span>.0.31   Ready,SchedulingDisabled   master   44h   v1.24.2
<span class="token number">10.1</span>.0.32   Ready                      <span class="token function">node</span>     44h   v1.24.2
<span class="token number">10.1</span>.0.33   Ready                      <span class="token function">node</span>     44h   v1.24.2


root@master02:~<span class="token comment"># calicoctl node status</span>
Calico process is running.

IPv4 BGP status
+--------------+-------------------+-------+----------+-------------+
<span class="token operator">|</span> PEER ADDRESS <span class="token operator">|</span>     PEER TYPE     <span class="token operator">|</span> STATE <span class="token operator">|</span>  SINCE   <span class="token operator">|</span>    INFO     <span class="token operator">|</span>
+--------------+-------------------+-------+----------+-------------+
<span class="token operator">|</span> <span class="token number">10.1</span>.0.31    <span class="token operator">|</span> node-to-node mesh <span class="token operator">|</span> up    <span class="token operator">|</span> 02:47:43 <span class="token operator">|</span> Established <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">10.1</span>.0.32    <span class="token operator">|</span> node-to-node mesh <span class="token operator">|</span> up    <span class="token operator">|</span> 02:47:12 <span class="token operator">|</span> Established <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">10.1</span>.0.33    <span class="token operator">|</span> node-to-node mesh <span class="token operator">|</span> up    <span class="token operator">|</span> 02:47:31 <span class="token operator">|</span> Established <span class="token operator">|</span>
+--------------+-------------------+-------+----------+-------------+

IPv6 BGP status
No IPv6 peers found.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="pHeKZ"></a></p><h2 id="_13-é›†ç¾¤å‡çº§" tabindex="-1"><a class="header-anchor" href="#_13-é›†ç¾¤å‡çº§" aria-hidden="true">#</a> 13. é›†ç¾¤å‡çº§</h2><p>å…ˆå‡çº§master ä¿è¯é›†ç¾¤ä¸­è‡³å°‘æœ‰ä¸€ä¸ªmasterèŠ‚ç‚¹å¯ç”¨ ï¼Œåœ¨nodeèŠ‚ç‚¹nginxåå‘ä»£ç†ä¸­æ³¨é‡Šæ‰è¦å‡çº§çš„masterèŠ‚ç‚¹ã€‚</p><figure><img src="http://cdn1.ryanxin.live/1672892592550-0602394c-6d2e-4912-b773-459e3460253a.jpg" alt="1672892592550-0602394c-6d2e-4912-b773-459e3460253a" tabindex="0" loading="lazy"><figcaption>1672892592550-0602394c-6d2e-4912-b773-459e3460253a</figcaption></figure><p><a name="ZaisC"></a></p><h3 id="_13-1-å‡çº§masterèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_13-1-å‡çº§masterèŠ‚ç‚¹" aria-hidden="true">#</a> 13.1 å‡çº§masterèŠ‚ç‚¹</h3><p>åœ¨å„ä¸ªnodeèŠ‚ç‚¹åå‘ä»£ç†é…ç½®ä¸­æ³¨é‡Šæ‰è¦å‡çº§çš„masterèŠ‚ç‚¹</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/kube-lb/conf/kube-lb.conf

user root<span class="token punctuation">;</span>
worker_processes <span class="token number">1</span><span class="token punctuation">;</span>

error_log  /etc/kube-lb/logs/error.log warn<span class="token punctuation">;</span>

events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">3000</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

stream <span class="token punctuation">{</span>
    upstream backend <span class="token punctuation">{</span>
        <span class="token comment">#server 10.1.0.30:6443    max_fails=2 fail_timeout=3s;</span>
        server <span class="token number">10.1</span>.0.31:6443    <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>3s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    server <span class="token punctuation">{</span>
        listen <span class="token number">127.0</span>.0.1:6443<span class="token punctuation">;</span>
        proxy_connect_timeout 1s<span class="token punctuation">;</span>
        proxy_pass backend<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#é‡å¯æœåŠ¡</span>
root@worker01:~<span class="token comment"># systemctl restart kube-lb.service</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>nodeèŠ‚ç‚¹å‡çº§éœ€è¦åœæœåŠ¡ï¼Œéœ€è¦å…³é—­kubelet å’Œ kube-proxyæœåŠ¡æ›¿æ¢äºŒè¿›åˆ¶æ–‡ä»¶</p><ul><li>kube-apiserver</li><li>kube-controller-manager</li><li>kubectl</li><li>kubelet</li><li>kube-proxy</li><li>kube-scheduler</li></ul><p>å»githubæ‰¾åˆ°æƒ³è¦å‡çº§çš„ç‰ˆæœ¬ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼š</p><p><a href="https://github.com/kubernetes/kubernetes/releases" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/kubernetes/releases<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/usr/local/src<span class="token comment"># ll</span>
total <span class="token number">489744</span>
drwxr-xr-x  <span class="token number">3</span> root root      <span class="token number">4096</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:11 ./
drwxr-xr-x <span class="token number">13</span> root root      <span class="token number">4096</span> Jan  <span class="token number">1</span> <span class="token number">13</span>:20 <span class="token punctuation">..</span>/
drwxr-xr-x <span class="token number">10</span> root root      <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 kubernetes/
-rw-r--r--  <span class="token number">1</span> root root  <span class="token number">30495559</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:09 kubernetes-client-linux-amd64.tar.gz
-rw-r--r--  <span class="token number">1</span> root root <span class="token number">123361203</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:09 kubernetes-node-linux-amd64.tar.gz
-rw-r--r--  <span class="token number">1</span> root root <span class="token number">347075448</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:09 kubernetes-server-linux-amd64.tar.gz
-rw-r--r--  <span class="token number">1</span> root root    <span class="token number">532769</span> Jan  <span class="token number">4</span> <span class="token number">13</span>:09 kubernetes.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>äºŒè¿›åˆ¶æ–‡ä»¶åœ¨/server/binç›®å½•ä¸‹é¢</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/usr/local/src/kubernetes/server/bin<span class="token comment"># ll -ls</span>
total <span class="token number">1090008</span>
     <span class="token number">4</span> drwxr-xr-x <span class="token number">2</span> root root      <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 ./
     <span class="token number">4</span> drwxr-xr-x <span class="token number">3</span> root root      <span class="token number">4096</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:31 <span class="token punctuation">..</span>/
 <span class="token number">54176</span> -rwxr-xr-x <span class="token number">1</span> root root  <span class="token number">55476224</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 apiextensions-apiserver*
 <span class="token number">43380</span> -rwxr-xr-x <span class="token number">1</span> root root  <span class="token number">44421120</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kubeadm*
 <span class="token number">48408</span> -rwxr-xr-x <span class="token number">1</span> root root  <span class="token number">49569792</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kube-aggregator*
<span class="token number">123032</span> -rwxr-xr-x <span class="token number">1</span> root root <span class="token number">125980672</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kube-apiserver*
     <span class="token number">4</span> -rw-r--r-- <span class="token number">1</span> root root         <span class="token number">8</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:25 kube-apiserver.docker_tag
<span class="token number">128092</span> -rw------- <span class="token number">1</span> root root <span class="token number">131165184</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:25 kube-apiserver.tar
<span class="token number">112896</span> -rwxr-xr-x <span class="token number">1</span> root root <span class="token number">115605504</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kube-controller-manager*
     <span class="token number">4</span> -rw-r--r-- <span class="token number">1</span> root root         <span class="token number">8</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:25 kube-controller-manager.docker_tag
<span class="token number">117960</span> -rw------- <span class="token number">1</span> root root <span class="token number">120790016</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:25 kube-controller-manager.tar
 <span class="token number">44680</span> -rwxr-xr-x <span class="token number">1</span> root root  <span class="token number">45752320</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kubectl*
 <span class="token number">53796</span> -rwxr-xr-x <span class="token number">1</span> root root  <span class="token number">55085992</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kubectl-convert*
<span class="token number">113376</span> -rwxr-xr-x <span class="token number">1</span> root root <span class="token number">116095704</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kubelet*
  <span class="token number">1452</span> -rwxr-xr-x <span class="token number">1</span> root root   <span class="token number">1486848</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kube-log-runner*
 <span class="token number">40820</span> -rwxr-xr-x <span class="token number">1</span> root root  <span class="token number">41799680</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kube-proxy*
     <span class="token number">4</span> -rw-r--r-- <span class="token number">1</span> root root         <span class="token number">8</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:25 kube-proxy.docker_tag
<span class="token number">109280</span> -rw------- <span class="token number">1</span> root root <span class="token number">111901184</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:25 kube-proxy.tar
 <span class="token number">46096</span> -rwxr-xr-x <span class="token number">1</span> root root  <span class="token number">47202304</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 kube-scheduler*
     <span class="token number">4</span> -rw-r--r-- <span class="token number">1</span> root root         <span class="token number">8</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:25 kube-scheduler.docker_tag
 <span class="token number">51160</span> -rw------- <span class="token number">1</span> root root  <span class="token number">52386816</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:25 kube-scheduler.tar
  <span class="token number">1380</span> -rwxr-xr-x <span class="token number">1</span> root root   <span class="token number">1413120</span> Dec  <span class="token number">8</span> <span class="token number">18</span>:26 mounter*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/usr/local/src/kubernetes/server/bin<span class="token comment"># ./kube-apiserver --version</span>
Kubernetes v1.24.9
<span class="token comment">#å½“å‰ç‰ˆæœ¬</span>
root@master01:/usr/local/src/kubernetes/server/bin<span class="token comment"># /etc/kubeasz/bin/kube-apiserver --version</span>
Kubernetes v1.24.2


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœæ­¢æœåŠ¡</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl stop kube-proxy kube-controller-manager kubelet kube-scheduler kube-apiserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ›¿æ¢äºŒè¿›åˆ¶æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/usr/local/src/kubernetes/server/bin<span class="token comment"># scp kube-apiserver kube-controller-manager kubelet kube-scheduler kube-proxy 10.1.0.30:/usr/local/bin</span>
kube-apiserver                                                                                                                                                                              <span class="token number">100</span>%  120MB <span class="token number">129</span>.5MB/s   00:00    
kube-controller-manager                                                                                                                                                                     <span class="token number">100</span>%  110MB <span class="token number">128</span>.8MB/s   00:00    
kubelet                                                                                                                                                                                     <span class="token number">100</span>%  111MB <span class="token number">137</span>.1MB/s   00:00    
kube-scheduler                                                                                                                                                                              <span class="token number">100</span>%   45MB <span class="token number">128</span>.5MB/s   00:00    
kube-proxy                                                                                                                                                                                  <span class="token number">100</span>%   40MB <span class="token number">132</span>.0MB/s   00:00
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨æœåŠ¡</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl start kube-proxy kube-controller-manager kubelet kube-scheduler kube-apiserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>éªŒè¯ç‰ˆæœ¬</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master02:~<span class="token comment"># kubectl get nodes</span>
NAME        STATUS                     ROLES    AGE    VERSION
<span class="token number">10.1</span>.0.30   Ready,SchedulingDisabled   master   136m   v1.24.9
<span class="token number">10.1</span>.0.31   Ready,SchedulingDisabled   master   46h    v1.24.2
<span class="token number">10.1</span>.0.32   Ready                      <span class="token function">node</span>     46h    v1.24.2
<span class="token number">10.1</span>.0.33   Ready                      <span class="token function">node</span>     46h    v1.24.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¦å¤–çš„masterèŠ‚ç‚¹ä¸Šé‡å¤ä»¥ä¸Šæ“ä½œ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/usr/local/src/kubernetes/server/bin<span class="token comment"># systemctl stop kube-proxy kube-controller-manager kubelet kube-scheduler kube-apiserver</span>
root@master01:/usr/local/src/kubernetes/server/bin<span class="token comment"># \cp kube-apiserver kube-controller-manager kubelet kube-scheduler kube-proxy /usr/local/bin</span>


root@master01:/usr/local/src/kubernetes/server/bin<span class="token comment"># kubectl get nodes</span>
NAME        STATUS                     ROLES    AGE    VERSION
<span class="token number">10.1</span>.0.30   Ready,SchedulingDisabled   master   142m   v1.24.9
<span class="token number">10.1</span>.0.31   Ready,SchedulingDisabled   master   47h    v1.24.9
<span class="token number">10.1</span>.0.32   Ready                      <span class="token function">node</span>     46h    v1.24.2
<span class="token number">10.1</span>.0.33   Ready                      <span class="token function">node</span>     46h    v1.24.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å„nodeèŠ‚ç‚¹kube-lbå–æ¶ˆupstreamæ³¨é‡Š</p><p><a name="z1OjH"></a></p><h3 id="_13-2-å‡çº§nodeèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_13-2-å‡çº§nodeèŠ‚ç‚¹" aria-hidden="true">#</a> 13.2 å‡çº§nodeèŠ‚ç‚¹</h3><p>nodeèŠ‚ç‚¹åªéœ€è¦æ›¿æ¢kubelet å’Œ kube-proxy ä¸¤ä¸ª</p><p>å…³é—­æœåŠ¡</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@worker01:~<span class="token comment"># systemctl stop kubelet.service kube-proxy.service</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ›¿æ¢äºŒè¿›åˆ¶æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/usr/local/src/kubernetes/server/bin<span class="token comment"># scp kubelet kube-proxy 10.1.0.32:/usr/local/bin</span>
kubelet                                                                                                                                                                                     <span class="token number">100</span>%  111MB <span class="token number">134</span>.8MB/s   00:00    
kube-proxy      <span class="token number">100</span>%   40MB <span class="token number">139</span>.3MB/s   00:00

root@master01:/usr/local/src/kubernetes/server/bin<span class="token comment"># scp kubelet kube-proxy 10.1.0.33:/usr/local/bin</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨æœåŠ¡</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@worker01:~<span class="token comment"># systemctl start kubelet.service kube-proxy.service</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>éªŒè¯ç‰ˆæœ¬</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master02:~<span class="token comment"># kubectl get nodes</span>
NAME        STATUS                     ROLES    AGE    VERSION
<span class="token number">10.1</span>.0.30   Ready,SchedulingDisabled   master   157m   v1.24.9
<span class="token number">10.1</span>.0.31   Ready,SchedulingDisabled   master   47h    v1.24.9
<span class="token number">10.1</span>.0.32   Ready                      <span class="token function">node</span>     46h    v1.24.9
<span class="token number">10.1</span>.0.33   Ready                      <span class="token function">node</span>     46h    v1.24.9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: ryanxin@xx9z@outlook.com">Ryanxin</span>,<!--]--><!--[--><span class="contributor" title="email: xinxincn0506@outlook.com">ryanxin7</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/k8s/log/" class="nav-link active prev" aria-label="K8S ç®€ä»‹"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon iconfont icon-creative" style=""></span>K8S ç®€ä»‹</div></a><a href="/k8s/log/kubernetes-2.html" class="nav-link next" aria-label="2.etcd å®¢æˆ·ç«¯ä½¿ç”¨ã€æ•°æ®å¤‡ä»½ä¸æ¢å¤"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">2.etcd å®¢æˆ·ç«¯ä½¿ç”¨ã€æ•°æ®å¤‡ä»½ä¸æ¢å¤<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Ryan's Notebook</div><div class="copyright">Copyright Â© 2023 Ryan</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-d46a28fe.js" defer></script>
  </body>
</html>

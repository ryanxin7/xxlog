<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/k8s/log/kubernetes-4.html"><meta property="og:site_name" content="Ryan's Notebook"><meta property="og:title" content="4.kubernetesAPIèµ„æºå¯¹è±¡"><meta property="og:description" content="èµ„æºå¯¹è±¡ å¸¸ç”¨å‘½ä»¤ å¸¸ç”¨å‘½ä»¤"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-03-01T10:28:19.000Z"><meta property="article:tag" content="k8sè¿›é˜¶è®­ç»ƒè¥"><meta property="article:published_time" content="2022-06-04T12:12:22.000Z"><meta property="article:modified_time" content="2023-03-01T10:28:19.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"4.kubernetesAPIèµ„æºå¯¹è±¡","image":[""],"datePublished":"2022-06-04T12:12:22.000Z","dateModified":"2023-03-01T10:28:19.000Z","author":[]}</script><title>4.kubernetesAPIèµ„æºå¯¹è±¡ | Ryan's Notebook</title><meta name="description" content="èµ„æºå¯¹è±¡ å¸¸ç”¨å‘½ä»¤ å¸¸ç”¨å‘½ä»¤">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-e9ac4e0d.css" as="style"><link rel="stylesheet" href="/assets/style-e9ac4e0d.css">
    <link rel="modulepreload" href="/assets/app-f755490f.js"><link rel="modulepreload" href="/assets/framework-91fce522.js"><link rel="modulepreload" href="/assets/kubernetes-4.html-6f85bc43.js"><link rel="modulepreload" href="/assets/kubernetes-4.html-18fbc919.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Ryan&#39;s Notebook"><!----><span class="site-name hide-in-pad">Ryan&#39;s Notebook</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="æ¿¼é‘«çš„çŸ¥è¯†åº“"><span class="font-icon icon iconfont icon-home" style=""></span>æ¿¼é‘«çš„çŸ¥è¯†åº“<!----></a></div><div class="nav-item hide-in-mobile"><a href="/category/" class="nav-link" aria-label="å½’æ¡£ğŸ—‚ï¸"><span class="font-icon icon iconfont icon-beaker" style=""></span>å½’æ¡£ğŸ—‚ï¸<!----></a></div><div class="nav-item hide-in-mobile"><a href="/article/" class="nav-link" aria-label="æ–‡ç« ğŸŒ±"><span class="font-icon icon iconfont icon-beaker" style=""></span>æ–‡ç« ğŸŒ±<!----></a></div><div class="nav-item hide-in-mobile"><a href="/timeline/" class="nav-link" aria-label="æ—¶é—´çº¿â°"><span class="font-icon icon iconfont icon-beaker" style=""></span>æ—¶é—´çº¿â°<!----></a></div><div class="nav-item hide-in-mobile"><a href="/about/" class="nav-link" aria-label="å…³äºğŸ¤·"><span class="font-icon icon iconfont icon-beaker" style=""></span>å…³äºğŸ¤·<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å°è®°ğŸ“Œ"><span class="title"><!---->å°è®°ğŸ“Œ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å°è®°</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/xj/" class="nav-link" aria-label="å°è®°"><span class="font-icon icon iconfont icon-exercise" style=""></span>å°è®°<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å¸¸ç”¨å·¥å…·</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://imageresizer.com/" rel="noopener noreferrer" target="_blank" aria-label="å›¾ç‰‡å‹ç¼©" class="nav-link"><span class="font-icon icon iconfont icon-more" style=""></span>å›¾ç‰‡å‹ç¼©<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://www.flaticon.com/" rel="noopener noreferrer" target="_blank" aria-label="å…è´¹å›¾æ ‡ç´ æ" class="nav-link"><span class="font-icon icon iconfont icon-more" style=""></span>å…è´¹å›¾æ ‡ç´ æ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://emojipedia.org/" rel="noopener noreferrer" target="_blank" aria-label="emojipedia" class="nav-link"><span class="font-icon icon iconfont icon-more" style=""></span>emojipedia<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/ryanxin7/xxlog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">æœç´¢</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/" class="nav-link sidebar-link sidebar-page" aria-label="æ¿¼é‘«çš„çŸ¥è¯†åº“"><span class="font-icon icon iconfont icon-home" style=""></span>æ¿¼é‘«çš„çŸ¥è¯†åº“<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading active"><span class="font-icon icon iconfont icon-discover" style=""></span><span class="title"></span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/k8s/log/" class="nav-link sidebar-link sidebar-page" aria-label="K8S ç®€ä»‹"><span class="font-icon icon iconfont icon-creative" style=""></span>K8S ç®€ä»‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-1.html" class="nav-link sidebar-link sidebar-page" aria-label="1.kubernetes äºŒè¿›åˆ¶éƒ¨ç½²"><!---->1.kubernetes äºŒè¿›åˆ¶éƒ¨ç½²<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-2.html" class="nav-link sidebar-link sidebar-page" aria-label="2.etcd å®¢æˆ·ç«¯ä½¿ç”¨ã€æ•°æ®å¤‡ä»½ä¸æ¢å¤"><!---->2.etcd å®¢æˆ·ç«¯ä½¿ç”¨ã€æ•°æ®å¤‡ä»½ä¸æ¢å¤<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-3.html" class="nav-link sidebar-link sidebar-page" aria-label="3. yamlæ–‡ä»¶è¯­æ³•åŸºç¡€"><!---->3. yamlæ–‡ä»¶è¯­æ³•åŸºç¡€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/k8s/log/kubernetes-4.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="4.kubernetesAPIèµ„æºå¯¹è±¡"><!---->4.kubernetesAPIèµ„æºå¯¹è±¡<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-4.html#å¸¸ç”¨å‘½ä»¤" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¸¸ç”¨å‘½ä»¤"><!---->å¸¸ç”¨å‘½ä»¤<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-4.html#k8sçš„å‡ ä¸ªé‡è¦æ¦‚å¿µ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="K8Sçš„å‡ ä¸ªé‡è¦æ¦‚å¿µ"><!---->K8Sçš„å‡ ä¸ªé‡è¦æ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-4.html#pod-æ¦‚è¿°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Pod æ¦‚è¿°"><!---->Pod æ¦‚è¿°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-4.html#service" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Service"><!---->Service<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-4.html#" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label><!----><!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-4.html#volume" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Volume"><!---->Volume<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-4.html#configmap" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="configmap"><!---->configmap<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-4.html#statefulset" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Statefulset"><!---->Statefulset<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-4.html#daemonset" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="DaemonSet"><!---->DaemonSet<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/k8s/log/kubernetes-4.html#pv-pvc" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="PV/PVC"><!---->PV/PVC<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-5.html" class="nav-link sidebar-link sidebar-page" aria-label="5.k8så®æˆ˜æ¡ˆä¾‹-nginxä¸tomcatå®ç°åŠ¨é™åˆ†ç¦»"><!---->5.k8så®æˆ˜æ¡ˆä¾‹-nginxä¸tomcatå®ç°åŠ¨é™åˆ†ç¦»<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-6.html" class="nav-link sidebar-link sidebar-page" aria-label="6.k8sä½¿ç”¨cephå®ç°æ•°æ®æŒä¹…åŒ–"><!---->6.k8sä½¿ç”¨cephå®ç°æ•°æ®æŒä¹…åŒ–<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-7.html" class="nav-link sidebar-link sidebar-page" aria-label="7.Podçš„çŠ¶æ€å’Œæ¢é’ˆ"><!---->7.Podçš„çŠ¶æ€å’Œæ¢é’ˆ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-8.html" class="nav-link sidebar-link sidebar-page" aria-label="8.å®æˆ˜æ¡ˆä¾‹-åŸºäºStatefulSetMySQLä¸»ä»æ¶æ„"><!---->8.å®æˆ˜æ¡ˆä¾‹-åŸºäºStatefulSetMySQLä¸»ä»æ¶æ„<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-9.html" class="nav-link sidebar-link sidebar-page" aria-label="9.å®æˆ˜æ¡ˆä¾‹-è¿è¡Œjavaåº”ç”¨"><!---->9.å®æˆ˜æ¡ˆä¾‹-è¿è¡Œjavaåº”ç”¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-10.html" class="nav-link sidebar-link sidebar-page" aria-label="10.å®æˆ˜æ¡ˆä¾‹-WordPress"><!---->10.å®æˆ˜æ¡ˆä¾‹-WordPress<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-11.html" class="nav-link sidebar-link sidebar-page" aria-label="11.å®æˆ˜æ¡ˆä¾‹-åŸºäºzookeeperå®ç°å¾®æœåŠ¡åŠ¨æ€æ³¨å†Œå’Œå‘ç°"><!---->11.å®æˆ˜æ¡ˆä¾‹-åŸºäºzookeeperå®ç°å¾®æœåŠ¡åŠ¨æ€æ³¨å†Œå’Œå‘ç°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-12.html" class="nav-link sidebar-link sidebar-page" aria-label="12.ingress å®ç°åŸºäºåŸŸåçš„å¤šè™šæ‹Ÿä¸»æœº,URLè½¬å‘åŠå¤šåŸŸåHTTPSå®ç°æ¡ˆä¾‹"><!---->12.ingress å®ç°åŸºäºåŸŸåçš„å¤šè™šæ‹Ÿä¸»æœº,URLè½¬å‘åŠå¤šåŸŸåHTTPSå®ç°æ¡ˆä¾‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-13.html" class="nav-link sidebar-link sidebar-page" aria-label="13.HPAè‡ªåŠ¨ä¼¸ç¼©podæ•°é‡"><!---->13.HPAè‡ªåŠ¨ä¼¸ç¼©podæ•°é‡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/k8s/log/kubernetes-14.html" class="nav-link sidebar-link sidebar-page" aria-label="14.K8S æŒç»­é›†æˆä¸éƒ¨ç½²"><!---->14.K8S æŒç»­é›†æˆä¸éƒ¨ç½²<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->4.kubernetesAPIèµ„æºå¯¹è±¡</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="http://ryanxin.live" target="_blank" rel="noopener noreferrer">Ryan</a></span><span property="author" content="Ryan"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-06-04T12:12:22.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 17 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT17M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category7 clickable" role="navigation">k8s</span><meta property="articleSection" content="k8s"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag5 clickable" role="navigation">k8sè¿›é˜¶è®­ç»ƒè¥</span><meta property="keywords" content="k8sè¿›é˜¶è®­ç»ƒè¥"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-4.html#å¸¸ç”¨å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level2">å¸¸ç”¨å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-4.html#k8sçš„å‡ ä¸ªé‡è¦æ¦‚å¿µ" class="router-link-active router-link-exact-active toc-link level2">K8Sçš„å‡ ä¸ªé‡è¦æ¦‚å¿µ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-4.html#pod-æ¦‚è¿°" class="router-link-active router-link-exact-active toc-link level3">Pod æ¦‚è¿°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-4.html#service" class="router-link-active router-link-exact-active toc-link level3">Service</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-4.html#" class="router-link-active router-link-exact-active toc-link level3"></a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-4.html#volume" class="router-link-active router-link-exact-active toc-link level3">Volume</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-4.html#configmap" class="router-link-active router-link-exact-active toc-link level3">configmap</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-4.html#statefulset" class="router-link-active router-link-exact-active toc-link level3">Statefulset</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-4.html#daemonset" class="router-link-active router-link-exact-active toc-link level3">DaemonSet</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/log/kubernetes-4.html#pv-pvc" class="router-link-active router-link-exact-active toc-link level3">PV/PVC</a></li><!----><!--]--></ul><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><figure><img src="http://cdn1.ryanxin.live/1673335368520-3d26b509-0ef8-42a6-8744-fcce0df96dee.png" alt="èµ„æºå¯¹è±¡" tabindex="0" loading="lazy"><figcaption>èµ„æºå¯¹è±¡</figcaption></figure><p><a name="jzmM9"></a></p><h2 id="å¸¸ç”¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤" aria-hidden="true">#</a> å¸¸ç”¨å‘½ä»¤</h2><figure><img src="http://cdn1.ryanxin.live/1673335468699-d16c69d0-45ec-4c1e-8088-800238d2db49.png" alt="å¸¸ç”¨å‘½ä»¤" tabindex="0" loading="lazy"><figcaption>å¸¸ç”¨å‘½ä»¤</figcaption></figure><p><a name="MKdje"></a></p><h2 id="k8sçš„å‡ ä¸ªé‡è¦æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#k8sçš„å‡ ä¸ªé‡è¦æ¦‚å¿µ" aria-hidden="true">#</a> K8Sçš„å‡ ä¸ªé‡è¦æ¦‚å¿µ</h2><p>1.ç”¨ä»€ä¹ˆå’Œk8sæ‰“äº¤é“ï¼Ÿ é€šè¿‡k8så£°æ˜å¼API è°ƒç”¨K8Sèµ„æºå¯¹è±¡ã€‚<br>2.æ€ä¹ˆæ‰“äº¤é“ï¼Ÿ é€šè¿‡å†™yamlæ–‡ä»¶è°ƒç”¨å£°æ˜å¼APIã€‚<br>3.æ€ä¹ˆå£°æ˜ï¼Ÿ yamlä¸­å¿…éœ€çš„å­—æ®µï¼š</p><ul><li>apiVersion - åˆ›å»ºè¯¥å¯¹è±¡æ‰€ä½¿ç”¨çš„Kubernetes APIçš„ç‰ˆæœ¬</li><li>kind- æƒ³è¦åˆ›å»ºçš„å¯¹è±¡çš„ç±»å‹</li><li>metadata- å¸®åŠ©è¯†åˆ«å¯¹è±¡å”¯ä¸€æ€§çš„æ•°æ®ï¼Œ åŒ…æ‹¬ä¸€ä¸ªnameåç§°ã€å¯é€‰çš„namespace</li><li>spec æœŸæœ›çŠ¶æ€</li><li>status (Podåˆ›å»ºå®Œæˆåk8sè‡ªåŠ¨ç”ŸæˆstatusçŠ¶æ€)</li></ul><p><strong>specå’Œstatusçš„åŒºåˆ«:</strong><br>specæ˜¯æœŸæœ›çŠ¶æ€<br>statusæ˜¯å®é™…çŠ¶æ€</p><p><a name="Sl2Mt"></a></p><h3 id="pod-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#pod-æ¦‚è¿°" aria-hidden="true">#</a> Pod æ¦‚è¿°</h3><ol><li>podæ˜¯k8sä¸­çš„æœ€å°å•å…ƒã€‚</li><li>ä¸€ä¸ªpodä¸­å¯ä»¥è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œ ä¹Ÿå¯ä»¥è¿è¡Œå¤šä¸ªå®¹å™¨ã€‚</li><li>è¿è¡Œå¤šä¸ªå®¹å™¨çš„è¯ï¼Œè¿™äº›å®¹å™¨æ˜¯ä¸€èµ·è¢«è°ƒåº¦çš„ã€‚</li><li>Podçš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼Œ ä¸ä¼šè‡ªæ„ˆï¼Œ æ˜¯ç”¨å®Œå°±é”€æ¯çš„å®ä½“ã€‚</li><li>ä¸€èˆ¬æˆ‘ä»¬æ˜¯é€šè¿‡Controlleræ¥åˆ›å»ºå’Œç®¡ç†podçš„ã€‚</li></ol><p><a name="aUTxs"></a></p><h4 id="podç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#podç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> Podç”Ÿå‘½å‘¨æœŸ</h4><p>åˆå§‹åŒ–å®¹å™¨ã€å¯åŠ¨å‰æ“ä½œã€å°±ç»ªæ¢é’ˆã€å­˜æ´»æ¢é’ˆã€åˆ é™¤podæ“ä½œ<br><img src="http://cdn1.ryanxin.live/1673336189572-84786ce3-c99e-464f-aafa-b05287a15d02.png" alt="ç”Ÿå‘½å‘¨æœŸ" loading="lazy"></p><p><a name="YWK1X"></a></p><h4 id="livenessprobeå’Œreadinessprobe-æ¢é’ˆ" tabindex="-1"><a class="header-anchor" href="#livenessprobeå’Œreadinessprobe-æ¢é’ˆ" aria-hidden="true">#</a> livenessProbeå’ŒreadinessProbe æ¢é’ˆ</h4><ul><li><strong>livenessProbe</strong>ï¼šå­˜æ´»æ¢é’ˆï¼Œæ£€æµ‹åº”ç”¨å‘ç”Ÿæ•…éšœæ—¶ä½¿ç”¨ï¼Œä¸èƒ½æä¾›æœåŠ¡ã€è¶…æ—¶ç­‰æ£€æµ‹å¤±è´¥é‡å¯pod</li><li><strong>readinessProbe</strong>ï¼šå°±ç»ªæ¢é’ˆï¼Œæ£€æµ‹podå¯åŠ¨ä¹‹ååº”ç”¨æ˜¯å¦å°±ç»ªï¼Œæ˜¯å¦å¯ä»¥æä¾›æœåŠ¡ï¼Œæ£€æµ‹æˆåŠŸï¼Œpodæ‰å¼€å§‹æ¥æ”¶æµé‡ã€‚</li></ul><p><a name="d3P2G"></a></p><h4 id="controller-æ§åˆ¶å™¨" tabindex="-1"><a class="header-anchor" href="#controller-æ§åˆ¶å™¨" aria-hidden="true">#</a> Controller æ§åˆ¶å™¨</h4><p><strong>Replication Controller</strong> ç¬¬ä¸€ä»£podå‰¯æœ¬æ§åˆ¶å™¨<br>**ReplicaSet ** ç¬¬äºŒä»£podå‰¯æœ¬æ§åˆ¶å™¨<br><strong>Deployment</strong> ç¬¬ä¸‰ä»£podæ§åˆ¶å™¨</p><p><a name="N8PFX"></a></p><h4 id="rc-rs-å’Œdeployment-åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#rc-rs-å’Œdeployment-åŒºåˆ«" aria-hidden="true">#</a> Rc,Rs å’ŒDeployment åŒºåˆ«ï¼š</h4><p><strong>Replication Controller</strong>ï¼šå‰¯æœ¬æ§åˆ¶å™¨ï¼ˆselector = !=ï¼‰<br><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/replicationcontroller/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/replicationcontroller/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><br>â€¢ <a href="https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/labels/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>ReplicaSet</strong>ï¼šå‰¯æœ¬æ§åˆ¶é›†ï¼Œå’Œå‰¯æœ¬æ§åˆ¶å™¨çš„åŒºåˆ«æ˜¯ï¼šå¯¹é€‰æ‹©å™¨çš„æ”¯æŒï¼ˆselector è¿˜æ”¯æŒin notinï¼‰<br>â€¢ <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/replicaset/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh/docs/concepts/workloads/controllers/replicaset/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>Deployment</strong>ï¼šæ¯”rsæ›´é«˜ä¸€çº§çš„æ§åˆ¶å™¨ï¼Œé™¤äº†æœ‰rsçš„åŠŸèƒ½ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šé«˜çº§åŠŸèƒ½,ï¼Œæ¯”å¦‚è¯´æœ€é‡è¦çš„ï¼šæ»šåŠ¨å‡çº§ã€å›æ»šç­‰<br>â€¢ <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>ä»¥ä¸‹æ˜¯ Deployments çš„å…¸å‹ç”¨ä¾‹ï¼š</strong></p><p>:::tips <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#creating-a-deployment" target="_blank" rel="noopener noreferrer">åˆ›å»º Deployment ä»¥å°† ReplicaSet ä¸Šçº¿<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚ReplicaSet åœ¨åå°åˆ›å»º Podã€‚ æ£€æŸ¥ ReplicaSet çš„ä¸Šçº¿çŠ¶æ€ï¼ŒæŸ¥çœ‹å…¶æ˜¯å¦æˆåŠŸã€‚</p><ol><li><p>é€šè¿‡æ›´æ–° Deployment çš„ PodTemplateSpecï¼Œ<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#updating-a-deployment" target="_blank" rel="noopener noreferrer">å£°æ˜ Pod çš„æ–°çŠ¶æ€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ã€‚ æ–°çš„ ReplicaSet ä¼šè¢«åˆ›å»ºï¼ŒDeployment ä»¥å—æ§é€Ÿç‡å°† Pod ä»æ—§ ReplicaSet è¿ç§»åˆ°æ–° ReplicaSetã€‚ æ¯ä¸ªæ–°çš„ ReplicaSet éƒ½ä¼šæ›´æ–° Deployment çš„ä¿®è®¢ç‰ˆæœ¬ã€‚</p></li><li><p>å¦‚æœ Deployment çš„å½“å‰çŠ¶æ€ä¸ç¨³å®šï¼Œ<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#rolling-back-a-deployment" target="_blank" rel="noopener noreferrer">å›æ»šåˆ°è¾ƒæ—©çš„ Deployment ç‰ˆæœ¬<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚ æ¯æ¬¡å›æ»šéƒ½ä¼šæ›´æ–° Deployment çš„ä¿®è®¢ç‰ˆæœ¬ã€‚</p></li><li><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#scaling-a-deployment" target="_blank" rel="noopener noreferrer">æ‰©å¤§ Deployment è§„æ¨¡ä»¥æ‰¿æ‹…æ›´å¤šè´Ÿè½½<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p></li><li><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#pausing-and-resuming-a-deployment" target="_blank" rel="noopener noreferrer">æš‚åœ Deployment çš„ä¸Šçº¿<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä»¥åº”ç”¨å¯¹ PodTemplateSpec æ‰€ä½œçš„å¤šé¡¹ä¿®æ”¹ï¼Œ ç„¶åæ¢å¤å…¶æ‰§è¡Œä»¥å¯åŠ¨æ–°çš„ä¸Šçº¿ç‰ˆæœ¬ã€‚</p></li><li><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#deployment-status" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ Deployment çŠ¶æ€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ¥åˆ¤å®šä¸Šçº¿è¿‡ç¨‹æ˜¯å¦å‡ºç°åœæ»ã€‚</p></li><li><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/#clean-up-policy" target="_blank" rel="noopener noreferrer">æ¸…ç†è¾ƒæ—§çš„ä¸å†éœ€è¦çš„ ReplicaSet<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ã€‚ :::</p></li></ol><p><a name="K5fxk"></a></p><h3 id="service" tabindex="-1"><a class="header-anchor" href="#service" aria-hidden="true">#</a> Service</h3><p>podé‡å¯åipåœ°å€å°±å˜äº†ï¼Œå¦‚ä½•ä¿è¯podé—´è®¿é—®ä¸å—å½±å“ï¼Ÿ</p><p>é€šè¿‡å£°æ˜ä¸€ä¸ªserviceå¯¹è±¡ï¼ŒæœåŠ¡å’Œåº”ç”¨è¿›è¡Œè§£è€¦ã€‚</p><p><strong>ä¸€èˆ¬å¸¸ç”¨çš„æœ‰ä¸¤ç§ï¼š</strong></p><ol><li>k8sé›†ç¾¤å†…çš„serviceï¼šselectoræŒ‡å®špodï¼Œè‡ªåŠ¨åˆ›å»ºEndpoints</li><li>k8sé›†ç¾¤å¤–çš„serviceï¼šæ‰‹åŠ¨åˆ›å»ºEndpointsï¼ŒæŒ‡å®šå¤–éƒ¨æœåŠ¡çš„ipï¼Œç«¯å£å’Œåè®®</li></ol><p><a name="JreXo"></a></p><h4 id="kube-proxyå’Œserviceçš„å…³ç³»" tabindex="-1"><a class="header-anchor" href="#kube-proxyå’Œserviceçš„å…³ç³»" aria-hidden="true">#</a> kube-proxyå’Œserviceçš„å…³ç³»</h4><p>kube-proxy ç›‘å¬ç€<strong>k8s-apiserver</strong>ï¼Œä¸€æ—¦serviceèµ„æºå‘ç”Ÿå˜åŒ–ï¼ˆè°ƒç”¨k8s-apiä¿®æ”¹serviceä¿¡æ¯ï¼‰ï¼Œkube-proxyå°±ä¼šç”Ÿæˆå¯¹åº”çš„è´Ÿè½½è°ƒåº¦çš„è°ƒæ•´ï¼Œè¿™æ ·å°±ä¿è¯serviceçš„æœ€æ–°çŠ¶æ€ã€‚</p><p><strong>kube-proxyæœ‰ä¸‰ç§è°ƒåº¦æ¨¡å‹ï¼š</strong></p><ul><li><strong>userspace</strong>ï¼šk8s1.1ä¹‹å‰</li><li><strong>iptables</strong>ï¼š1.2-k8s1.11ä¹‹å‰</li><li><strong>ipvs</strong>ï¼šk8s 1.11ä¹‹åï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ipvsï¼Œåˆ™è‡ªåŠ¨é™çº§ä¸ºiptables</li></ul><p><a name="svKrO"></a></p><h3 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h3><p><a name="KgaaS"></a></p><h3 id="volume" tabindex="-1"><a class="header-anchor" href="#volume" aria-hidden="true">#</a> Volume</h3><p>k8s æŠ½è±¡å‡ºçš„ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥ä¿å­˜æ•°æ®ï¼Œè§£è€¦æ•°æ®å’Œé•œåƒï¼ˆæ•°æ®å­˜é•œåƒé‡Œé¢æ¯æ¬¡æ›´æ–°é•œåƒä¼šç‰¹åˆ«å¤§ï¼‰ï¼Œå®ç°å®¹å™¨é—´æ•°æ®å…±äº«ã€‚</p><p><strong>å¸¸ç”¨çš„å‡ ç§å·ï¼š</strong></p><ul><li><strong>emptyDir</strong>ï¼šæœ¬åœ°ä¸´æ—¶å·</li><li><strong>hostPath</strong>ï¼šæœ¬åœ°å·</li><li><strong>nfs</strong>ç­‰ï¼šå…±äº«å·</li><li><strong>configmap</strong>: é…ç½®æ–‡ä»¶</li></ul><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a name="yxkwB"></a></p><h4 id="emptydir" tabindex="-1"><a class="header-anchor" href="#emptydir" aria-hidden="true">#</a> emptyDir</h4><p>å½“ Pod è¢«åˆ†é…ç»™èŠ‚ç‚¹æ—¶ï¼Œé¦–å…ˆåˆ›å»º emptyDir å·ï¼Œå¹¶ä¸”åªè¦è¯¥Pod åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè¯¥å·å°±ä¼šå­˜åœ¨ã€‚æ­£å¦‚å·çš„åå­—æ‰€è¿°ï¼Œå®ƒæœ€åˆæ˜¯ç©ºçš„ã€‚<br>Pod ä¸­çš„å®¹å™¨å¯ä»¥è¯»å–å’Œå†™å…¥ emptyDir å·ä¸­çš„ç›¸åŒæ–‡ä»¶ï¼Œå°½ç®¡è¯¥å·å¯ä»¥æŒ‚è½½åˆ°æ¯ä¸ªå®¹å™¨ä¸­çš„ç›¸åŒæˆ–ä¸åŒè·¯å¾„ä¸Šã€‚<br>å½“å‡ºäºä»»ä½•åŸå› ä»èŠ‚ç‚¹ä¸­åˆ é™¤ Pod æ—¶ï¼ŒemptyDir ä¸­çš„æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚</p><p><a name="oa5jV"></a></p><h4 id="hostpath" tabindex="-1"><a class="header-anchor" href="#hostpath" aria-hidden="true">#</a> hostPath</h4><p>hostPath å·å°†ä¸»æœºèŠ‚ç‚¹çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æˆ–ç›®å½•æŒ‚è½½åˆ°é›†ç¾¤ä¸­ï¼Œpodåˆ é™¤çš„æ—¶å€™ï¼Œå·ä¸ä¼šè¢«åˆ é™¤ï¼Œä½†æ˜¯podå¯èƒ½è°ƒåº¦åˆ°ä¸åŒçš„node æ•°æ®ä¼šå‡ºç°ä¸¢å¤±ã€‚</p><p><a name="G3hMk"></a></p><h4 id="nfsç­‰å…±äº«å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#nfsç­‰å…±äº«å­˜å‚¨" aria-hidden="true">#</a> nfsç­‰å…±äº«å­˜å‚¨</h4><p>nfs å·å…è®¸å°†ç°æœ‰çš„ NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰å…±äº«æŒ‚è½½åˆ°æ‚¨çš„å®¹å™¨ä¸­ã€‚<br>ä¸åƒ emptyDirï¼Œå½“åˆ é™¤ Pod æ—¶ï¼Œnfs å·çš„å†…å®¹è¢«ä¿ç•™ï¼Œå·ä»…ä»…æ˜¯è¢«å¸è½½ã€‚<br>è¿™æ„å‘³ç€ NFS å·å¯ä»¥é¢„å¡«å……æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ pod ä¹‹é—´â€œåˆ‡æ¢â€æ•°æ®ã€‚ NFSå¯ä»¥è¢«å¤šä¸ªå†™å…¥è€…åŒæ—¶æŒ‚è½½ã€‚</p><p><a name="AENtM"></a></p><h5 id="åˆ›å»ºå¤šä¸ªpodæµ‹è¯•æŒ‚è½½åŒä¸€ä¸ªnfs" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºå¤šä¸ªpodæµ‹è¯•æŒ‚è½½åŒä¸€ä¸ªnfs" aria-hidden="true">#</a> åˆ›å»ºå¤šä¸ªpodæµ‹è¯•æŒ‚è½½åŒä¸€ä¸ªNFS</h5><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx 
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html/mysite
          <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>volume
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>volume
        <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
          <span class="token key atrule">server</span><span class="token punctuation">:</span> 172.31.7.109
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/magedu/n56
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">81</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30016</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="huf2m"></a></p><h5 id="åˆ›å»ºå¤šä¸ªpodæµ‹è¯•æ¯ä¸ªpodæŒ‚è½½å¤šä¸ªnfs" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºå¤šä¸ªpodæµ‹è¯•æ¯ä¸ªpodæŒ‚è½½å¤šä¸ªnfs" aria-hidden="true">#</a> åˆ›å»ºå¤šä¸ªpodæµ‹è¯•æ¯ä¸ªpodæŒ‚è½½å¤šä¸ªNFS</h5><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx 
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html/mysite
          <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>volume
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /usr/share/nginx/html/js
          <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>js
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>volume
        <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
          <span class="token key atrule">server</span><span class="token punctuation">:</span> 172.31.7.109
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/magedu/n56
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nfs<span class="token punctuation">-</span>js
        <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
          <span class="token key atrule">server</span><span class="token punctuation">:</span> 172.31.7.109
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/magedu/js
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">81</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30016</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡ç‚¹ï¼š</p><p>service è®¿é—®æµç¨‹ï¼š</p><p>k8så†…éƒ¨æœåŠ¡å¯¹å¤–å‘å¸ƒä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼Œnodeportå’Œingress ï¼Œå¦‚æœä½¿ç”¨nodeportæ–¹å¼å°±ä¼šåœ¨æ¯å°nodeèŠ‚ç‚¹éƒ½ä¼šç›‘å¬ä¸€ä¸ªç«¯å£é€šå¸¸æ˜¯30000ä»¥ä¸Šï¼Œnodeportä¸ºä»€ä¹ˆä¸ç›´æ¥è½¬å‘ç»™pod ï¼Ÿ å› ä¸ºç»´æŠ¤nodeportå’Œpodç»‘å®šå…³ç³»æ¯”è¾ƒéš¾ï¼Œé€šè¿‡éœ€è¦serviceè¿›è¡Œè½¬å‘ï¼Œserviceç›¸å½“äºk8så†…éƒ¨çš„è´Ÿè½½å‡è¡¡å™¨è´Ÿè´£è½¬å‘ï¼ŒåŸºäºlabelæ ‡ç­¾åŒ¹é…å’Œç­›é€‰é‚£äº›å…·æœ‰æ ‡ç­¾çš„podã€‚ é»˜è®¤ä½¿ç”¨è½®è¯¢è°ƒåº¦æ–¹å¼</p><figure><img src="http://cdn1.ryanxin.live/1673402165869-231b571d-0e9f-46fa-bb0c-8931d2a1cc9d.png" alt="svcè®¿é—®æµç¨‹" tabindex="0" loading="lazy"><figcaption>svcè®¿é—®æµç¨‹</figcaption></figure><p><a name="qoJQC"></a></p><h3 id="configmap" tabindex="-1"><a class="header-anchor" href="#configmap" aria-hidden="true">#</a> configmap</h3><p><strong>åŠŸèƒ½</strong>ï¼šå°†é…ç½®ä¿¡æ¯å’Œé•œåƒè§£è€¦<br>å°†é…ç½®ä¿¡æ¯æ”¾åˆ°<strong>configmap</strong>å¯¹è±¡ä¸­ï¼Œç„¶ååœ¨podçš„å¯¹è±¡ä¸­å¯¼å…¥configmapå¯¹è±¡ï¼Œå®ç°å¯¼å…¥é…ç½®æ–‡ä»¶çš„æ“ä½œã€‚<br>yamlå£°æ˜ä¸€ä¸ªConfigMapçš„å¯¹è±¡ï¼Œä½œä¸ºVolumeæŒ‚è½½åˆ°podä¸­</p><p><a name="Ct99F"></a></p><h4 id="ä½¿ç”¨-configmap-æŒ‚è½½nginx-é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-configmap-æŒ‚è½½nginx-é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> ä½¿ç”¨ Configmap æŒ‚è½½nginx é…ç½®æ–‡ä»¶</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>config
<span class="token key atrule">data</span><span class="token punctuation">:</span>
 <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    server {
       listen       80;
       server_name  www.mysite.com;
       index        index.html;</span>

       location / <span class="token punctuation">{</span>
           root /data/nginx/html;
           if (<span class="token tag">!-e</span> $request_filename) <span class="token punctuation">{</span>
               rewrite ^/(.<span class="token important">*)</span> /index.html last;
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">---</span>
<span class="token comment">#apiVersion: extensions/v1beta1</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx 
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data/nginx/html
          <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>static<span class="token punctuation">-</span>dir
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>config
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span>  /etc/nginx/conf.d
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>static<span class="token punctuation">-</span>dir
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/nginx/linux39
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>config
        <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>config
          <span class="token key atrule">items</span><span class="token punctuation">:</span>
             <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> default
               <span class="token key atrule">path</span><span class="token punctuation">:</span> mysite.conf

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">81</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30019</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="fiv8m"></a></p><h4 id="ä½¿ç”¨-configmap-æŒ‚è½½ç¯å¢ƒå˜é‡åˆ°pod" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-configmap-æŒ‚è½½ç¯å¢ƒå˜é‡åˆ°pod" aria-hidden="true">#</a> ä½¿ç”¨ Configmap æŒ‚è½½ç¯å¢ƒå˜é‡åˆ°pod</h4><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>config
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> user1


<span class="token punctuation">---</span>
<span class="token comment">#apiVersion: extensions/v1beta1</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx 
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> MY_PASSWD
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;123123&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> MY_USERNAME
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>config
              <span class="token key atrule">key</span><span class="token punctuation">:</span> username
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="B0vUf"></a></p><h3 id="statefulset" tabindex="-1"><a class="header-anchor" href="#statefulset" aria-hidden="true">#</a> Statefulset</h3><p><strong>åŠŸèƒ½</strong>ï¼š ä¸ºäº†è§£å†³æœ‰çŠ¶æ€æœåŠ¡çš„é—®é¢˜ <br>æ— çŠ¶æ€æœåŠ¡ï¼ˆæœ‰ä¸»ä»å…³ç³»ã€é›†ç¾¤éƒ¨ç½² ï¼‰</p><p>å®ƒæ‰€ç®¡ç†çš„Podæ‹¥æœ‰å›ºå®šçš„Podåç§°ï¼Œä¸»æœºåï¼Œå¯åœé¡ºåº <br>å’Œ <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">Deployment<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ç±»ä¼¼ï¼Œ StatefulSet ç®¡ç†åŸºäºç›¸åŒå®¹å™¨è§„çº¦çš„ä¸€ç»„ Podã€‚ä½†å’Œ Deployment ä¸åŒçš„æ˜¯ï¼Œ StatefulSet ä¸ºå®ƒä»¬çš„æ¯ä¸ª Pod ç»´æŠ¤äº†ä¸€ä¸ªæœ‰ç²˜æ€§çš„ IDã€‚è¿™äº› Pod æ˜¯åŸºäºç›¸åŒçš„è§„çº¦æ¥åˆ›å»ºçš„ï¼Œ ä½†æ˜¯ä¸èƒ½ç›¸äº’æ›¿æ¢ï¼šæ— è®ºæ€ä¹ˆè°ƒåº¦ï¼Œæ¯ä¸ª Pod éƒ½æœ‰ä¸€ä¸ªæ°¸ä¹…ä¸å˜çš„ IDã€‚</p><p><a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a name="L5ZXz"></a></p><h3 id="daemonset" tabindex="-1"><a class="header-anchor" href="#daemonset" aria-hidden="true">#</a> DaemonSet</h3><p><a name="ufnck"></a></p><h3 id="pv-pvc" tabindex="-1"><a class="header-anchor" href="#pv-pvc" aria-hidden="true">#</a> PV/PVC</h3><p>å¯¹å­˜å‚¨æŠ½è±¡ ä¸ç›´æ¥å­˜å‚¨æ•°æ®è€Œæ˜¯åœ¨k8så±‚é¢åšäº†ä¸€ä¸ªéš”ç¦»ï¼Œæƒé™æ§åˆ¶ã€ä¸šåŠ¡éš”ç¦»ï¼ŒæŠŠä¸åŒæ˜¯podæ•°æ®åˆ†å¼€</p><p>ç”¨nfsæŒ‚è½½ é‚£ä¹ˆæ¯ä¸ªpodéƒ½èƒ½çœ‹åˆ°ç›¸åŒæ•°æ®ï¼Œå¦‚ä½•åšæ•°æ®éš”ç¦»ï¼Ÿ</p><p>åœ¨å­˜å‚¨å’Œk8sç›´æ¥å°è£…ä¸€å±‚ PV/PVC</p><figure><img src="http://cdn1.ryanxin.live/1673413439244-b1ef9fc6-ac17-42c4-8bbd-92d13d4a6504.png" alt="pv" tabindex="0" loading="lazy"><figcaption>pv</figcaption></figure><p><strong>PVæ˜¯å¯¹åº•å±‚â½¹ç»œå­˜å‚¨çš„æŠ½è±¡ï¼Œå³å°†â½¹ç»œå­˜å‚¨å®šä¹‰ä¸ºâ¼€ç§å­˜å‚¨èµ„æº</strong>ï¼Œå°†â¼€ä¸ªæ•´ä½“çš„å­˜å‚¨èµ„æºæ‹†åˆ†æˆå¤šä»½åç»™ä¸åŒçš„ä¸šåŠ¡ä½¿ç”¨ã€‚ PVæ˜¯ç”±ç®¡ç†å‘˜æ·»åŠ çš„çš„â¼€ä¸ªå­˜å‚¨çš„æè¿°ï¼Œæ˜¯â¼€ä¸ªå…¨å±€èµ„æºå³<strong>ä¸â¾ªå±äºä»»ä½•namespace</strong>ï¼ŒåŒ…å«å­˜å‚¨çš„ç±»å‹ï¼Œå­˜å‚¨çš„â¼¤â¼©å’Œè®¿é—®æ¨¡å¼ç­‰ï¼Œå®ƒçš„â½£å‘½å‘¨æœŸç‹¬â½´äºPodï¼Œä¾‹å¦‚å½“ä½¿â½¤å®ƒçš„Podé”€æ¯æ—¶å¯¹PVæ²¡æœ‰å½±å“ã€‚</p><p>**PersistentVolumeClaimï¼ˆPVCï¼‰**æ˜¯â½¤æˆ·å­˜å‚¨çš„è¯·æ±‚ï¼Œå®ƒç±»ä¼¼äºpodï¼ŒPodæ¶ˆè€—èŠ‚ç‚¹èµ„æºï¼ŒPVCæ¶ˆè€—å­˜å‚¨èµ„æºï¼Œ å°±åƒ podå¯ä»¥è¯·æ±‚ç‰¹å®šçº§åˆ«çš„èµ„æºï¼ˆCPUå’Œå†…å­˜ï¼‰ï¼ŒPVCæ˜¯namespaceä¸­çš„èµ„æºï¼Œå¯ä»¥è®¾ç½®ç‰¹å®šçš„ç©ºé—´å¤§å°å’Œè®¿é—®æ¨¡å¼ã€‚ podæ˜¯é€šè¿‡PVCå°†æ•°æ®ä¿å­˜â¾„PVï¼ŒPVåœ¨ä¿å­˜â¾„å­˜å‚¨ã€‚ <br> <br><img src="http://cdn1.ryanxin.live/1673420707945-cbb3d3e9-e20f-4a43-9e5d-57aeef5dfc16.png" alt="pvc" loading="lazy"></p><p><a name="IemzW"></a></p><h4 id="persistentvolumeå‚æ•°" tabindex="-1"><a class="header-anchor" href="#persistentvolumeå‚æ•°" aria-hidden="true">#</a> PersistentVolumeå‚æ•°ï¼š</h4><p><a name="KH2id"></a></p><h5 id="è®¿é—®æ¨¡å¼-accessmodes" tabindex="-1"><a class="header-anchor" href="#è®¿é—®æ¨¡å¼-accessmodes" aria-hidden="true">#</a> è®¿é—®æ¨¡å¼ accessModes</h5><p>PersistentVolume å·å¯ä»¥ç”¨èµ„æºæä¾›è€…æ‰€æ”¯æŒçš„ä»»ä½•æ–¹å¼æŒ‚è½½åˆ°å®¿ä¸»ç³»ç»Ÿä¸Šã€‚ å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œæä¾›è€…ï¼ˆé©±åŠ¨ï¼‰çš„èƒ½åŠ›ä¸åŒï¼Œæ¯ä¸ª PV å·çš„è®¿é—®æ¨¡å¼éƒ½ä¼šè®¾ç½®ä¸ºå¯¹åº”å·æ‰€æ”¯æŒçš„æ¨¡å¼å€¼ã€‚<br> ä¾‹å¦‚ï¼ŒNFS å¯ä»¥æ”¯æŒå¤šä¸ªè¯»å†™å®¢æˆ·ï¼Œä½†æ˜¯æŸä¸ªç‰¹å®šçš„ NFS PV å·å¯èƒ½åœ¨æœåŠ¡å™¨ä¸Šä»¥åªè¯»çš„æ–¹å¼å¯¼å‡ºã€‚<br> æ¯ä¸ª PV å·éƒ½ä¼šè·å¾—è‡ªèº«çš„è®¿é—®æ¨¡å¼é›†åˆï¼Œæè¿°çš„æ˜¯ç‰¹å®š PV å·çš„èƒ½åŠ›ã€‚</p><p><strong>è®¿é—®æ¨¡å¼æœ‰ï¼š</strong><br><strong>ReadWriteOnce</strong><br>å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ã€‚ ReadWriteOnce è®¿é—®æ¨¡å¼ä¹Ÿå…è®¸è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹ä¸Šçš„å¤šä¸ª Pod è®¿é—®å·ã€‚<br><strong>ReadOnlyMany</strong><br>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ–¹å¼æŒ‚è½½ã€‚<br><strong>ReadWriteMany</strong><br>å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½ã€‚<br><strong>ReadWriteOncePod</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># kubectl explain PersistentVolume</span>
Capacityï¼š <span class="token comment">#å½“å‰PVç©ºé—´â¼¤â¼©ï¼Œkubectl explain PersistentVolume.spec.capacity</span>
accessModes ï¼šè®¿é—®æ¨¡å¼ï¼Œ<span class="token comment">#kubectl explain PersistentVolume.spec.accessModes</span>
ReadWriteOnce â€“ PVåªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æƒé™æŒ‚è½½ï¼ŒRWO
ReadOnlyMany â€“ PVä»¥å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½ä½†æ˜¯æƒé™æ˜¯åªè¯»çš„,ROX
ReadWriteMany â€“ PVå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æ˜¯è¯»å†™â½…å¼æŒ‚è½½ä½¿â½¤,RWX
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#access-modes" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#access-modes<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>å®˜â½…æä¾›çš„åŸºäºå„åç«¯å­˜å‚¨åˆ›å»ºçš„PVâ½€æŒçš„è®¿é—®æ¨¡å¼</strong></p><figure><img src="http://cdn1.ryanxin.live/1673421868807-b85faeed-f417-408f-8c0b-92bb351f28e4.png" alt="â½€æŒçš„è®¿é—®æ¨¡å¼" tabindex="0" loading="lazy"><figcaption>â½€æŒçš„è®¿é—®æ¨¡å¼</figcaption></figure><p><a name="hymYN"></a></p><h5 id="å›æ”¶æœºåˆ¶-persistentvolumereclaimpolicy" tabindex="-1"><a class="header-anchor" href="#å›æ”¶æœºåˆ¶-persistentvolumereclaimpolicy" aria-hidden="true">#</a> å›æ”¶æœºåˆ¶ persistentVolumeReclaimPolicy</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>persistentVolumeReclaimPolicy <span class="token comment">#åˆ é™¤æœºåˆ¶å³åˆ é™¤å­˜å‚¨å·å·æ—¶å€™ï¼Œå·²ç»åˆ›å»ºå¥½çš„å­˜å‚¨å·ç”±ä»¥ä¸‹åˆ é™¤æ“ä½œï¼š</span>

<span class="token comment">#kubectl explain PersistentVolume.spec.persistentVolumeReclaimPolicy</span>
 Retain â€“ åˆ é™¤PVåä¿æŒåŸè£…ï¼Œæœ€åéœ€è¦ç®¡ç†å‘˜â¼¿åŠ¨åˆ é™¤
 Recycle â€“ ç©ºé—´å›æ”¶ï¼ŒåŠåˆ é™¤å­˜å‚¨å·ä¸Šçš„æ‰€æœ‰æ•°æ®<span class="token punctuation">(</span>åŒ…æ‹¬â½¬å½•å’Œéšè—â½‚ä»¶<span class="token punctuation">)</span>,â½¬å‰ä»…â½€æŒNFSå’ŒhostPath
 Delete â€“ â¾ƒåŠ¨åˆ é™¤å­˜å‚¨å·


mountOptions <span class="token comment">#é™„åŠ çš„æŒ‚è½½é€‰é¡¹åˆ—è¡¨ï¼Œå®ç°æ›´ç²¾ç»†çš„æƒé™æ§åˆ¶</span>
 ro <span class="token comment">#ç­‰</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#reclaim-policy<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a name="n5UOP"></a></p><h5 id="å·æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å·æ¨¡å¼" aria-hidden="true">#</a> å·æ¨¡å¼</h5><p>é’ˆå¯¹ PV æŒä¹…å·ï¼ŒKubernetes æ”¯æŒä¸¤ç§å·æ¨¡å¼ï¼ˆvolumeModesï¼‰ï¼šFilesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ å’Œ Blockï¼ˆå—ï¼‰ã€‚ volumeMode æ˜¯ä¸€ä¸ªå¯é€‰çš„ API å‚æ•°ã€‚ å¦‚æœè¯¥å‚æ•°è¢«çœç•¥ï¼Œé»˜è®¤çš„å·æ¨¡å¼æ˜¯ Filesystemã€‚<br>volumeMode å±æ€§è®¾ç½®ä¸º Filesystem çš„å·ä¼šè¢« Pod <strong>æŒ‚è½½ï¼ˆMountï¼‰</strong> åˆ°æŸä¸ªç›®å½•ã€‚ å¦‚æœå·çš„å­˜å‚¨æ¥è‡ªæŸå—è®¾å¤‡è€Œè¯¥è®¾å¤‡ç›®å‰ä¸ºç©ºï¼ŒKuberneretes ä¼šåœ¨ç¬¬ä¸€æ¬¡æŒ‚è½½å·ä¹‹å‰åœ¨è®¾å¤‡ä¸Šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>volumeMode <span class="token comment">#å·ç±»å‹</span>
kubectl explain PersistentVolume.spec.volumeMode
å®šä¹‰å­˜å‚¨å·ä½¿â½¤çš„â½‚ä»¶ç³»ç»Ÿæ˜¯å—è®¾å¤‡è¿˜æ˜¯â½‚ä»¶ç³»ç»Ÿï¼Œé»˜è®¤ä¸ºâ½‚ä»¶ç³»ç»Ÿ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#volume-mode" target="_blank" rel="noopener noreferrer">https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#volume-mode<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a name="TOaVN"></a></p><h5 id="-1" tabindex="-1"><a class="header-anchor" href="#-1" aria-hidden="true">#</a></h5><p><img src="http://cdn1.ryanxin.live/1673421245380-7d31902c-15fe-438e-bbb0-903154cceac9.png" alt="" loading="lazy"><a name="IRoju"></a></p><h4 id="persistentvolumeclaim-å‚æ•°" tabindex="-1"><a class="header-anchor" href="#persistentvolumeclaim-å‚æ•°" aria-hidden="true">#</a> PersistentVolumeClaim å‚æ•°</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#kubectl explain PersistentVolumeClaim</span>

accessModes ï¼šPVC è®¿é—®æ¨¡å¼ï¼Œ<span class="token comment">#kubectl explain PersistentVolumeClaim.spec.volumeMode</span>
ReadWriteOnce â€“ PVCåªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æƒé™æŒ‚è½½ï¼ŒRWO
ReadOnlyMany â€“ PVCä»¥å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½ä½†æ˜¯æƒé™æ˜¯åªè¯»çš„,ROX
ReadWriteMany â€“ PVCå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æ˜¯è¯»å†™â½…å¼æŒ‚è½½ä½¿â½¤,RWX

resourcesï¼š <span class="token comment">#å®šä¹‰PVCåˆ›å»ºå­˜å‚¨å·çš„ç©ºé—´â¼¤â¼©</span>
selectorï¼š <span class="token comment">#æ ‡ç­¾é€‰æ‹©å™¨ï¼Œé€‰æ‹©è¦ç»‘å®šçš„PV</span>

 matchLabels <span class="token comment">#åŒ¹é…æ ‡ç­¾åç§°</span>
 matchExpressions <span class="token comment">#åŸºäºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span>

volumeName <span class="token comment">#è¦ç»‘å®šçš„PVåç§°</span>

volumeMode <span class="token comment">#å·ç±»å‹</span>
å®šä¹‰PVCä½¿â½¤çš„â½‚ä»¶ç³»ç»Ÿæ˜¯å—è®¾å¤‡è¿˜æ˜¯â½‚ä»¶ç³»ç»Ÿï¼Œé»˜è®¤ä¸ºâ½‚ä»¶ç³»ç»Ÿ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="y3crT"></a></p><h4 id="pvåŠpvcå®æˆ˜æ¡ˆä¾‹ä¹‹zookeeperé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#pvåŠpvcå®æˆ˜æ¡ˆä¾‹ä¹‹zookeeperé›†ç¾¤" aria-hidden="true">#</a> PVåŠPVCå®æˆ˜æ¡ˆä¾‹ä¹‹zookeeperé›†ç¾¤</h4><p>åŸºäºPVå’ŒPVCä½œä¸ºåç«¯å­˜å‚¨ï¼Œå®ç°zookeeperé›†ç¾¤</p><p><a name="yoVLV"></a></p><h5 id="_1-ä¸‹è½½jdk-é•œåƒ" tabindex="-1"><a class="header-anchor" href="#_1-ä¸‹è½½jdk-é•œåƒ" aria-hidden="true">#</a> 1.ä¸‹è½½JDK é•œåƒ<br><br></h5><p><a href="https://www.oracle.com/java/technologies/javase/javase8u211-later-archive-downloads.html#license-lightbox" target="_blank" rel="noopener noreferrer">https://www.oracle.com/java/technologies/javase/javase8u211-later-archive-downloads.html#license-lightbox<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull elevy/slim_java:8
<span class="token function">docker</span> tag elevy/slim_java:8 harbor.ceamg.com/baseimages/slim_java:8
<span class="token function">docker</span> push harbor.ceamg.com/baseimages/slim_java:8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="IPZyn"></a></p><h5 id="_2-æ„å»ºzookeeper-é•œåƒ" tabindex="-1"><a class="header-anchor" href="#_2-æ„å»ºzookeeper-é•œåƒ" aria-hidden="true">#</a> 2.æ„å»ºzookeeper é•œåƒ</h5><figure><img src="http://cdn1.ryanxin.live/1673486581523-20c135bc-2fde-45aa-bc2b-c3fb840e5e15.png" alt="zookeeperé•œåƒ" tabindex="0" loading="lazy"><figcaption>zookeeperé•œåƒ</figcaption></figure><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">chmod</span> a+x *.sh
<span class="token function">chmod</span> a+x bin/*.sh
<span class="token function">bash</span> build-command.sh  <span class="token function">bash</span> build-command.sh <span class="token number">2022</span>-1-12_9_16_32
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#FROM harbor-linux38.local.com/linux38/slim_java:8 </span>
FROM harbor.ceamg.com/baseimages/slim_java:8

ENV ZK_VERSION <span class="token number">3.4</span>.14
ADD repositories /etc/apk/repositories 
<span class="token comment"># Download Zookeeper</span>
COPY zookeeper-3.4.14.tar.gz /tmp/zk.tgz
COPY zookeeper-3.4.14.tar.gz.asc /tmp/zk.tgz.asc
COPY KEYS /tmp/KEYS
RUN apk <span class="token function">add</span> --no-cache <span class="token parameter variable">--virtual</span> .build-deps <span class="token punctuation">\</span>
      ca-certificates   <span class="token punctuation">\</span>
      gnupg             <span class="token punctuation">\</span>
      <span class="token function">tar</span>               <span class="token punctuation">\</span>
      <span class="token function">wget</span> <span class="token operator">&amp;&amp;</span>           <span class="token punctuation">\</span>
    <span class="token comment">#</span>
    <span class="token comment"># Install dependencies</span>
    apk <span class="token function">add</span> --no-cache  <span class="token punctuation">\</span>
      <span class="token function">bash</span> <span class="token operator">&amp;&amp;</span>           <span class="token punctuation">\</span>
    <span class="token comment">#</span>
    <span class="token comment">#</span>
    <span class="token comment"># Verify the signature</span>
    <span class="token builtin class-name">export</span> <span class="token assign-left variable">GNUPGHOME</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>mktemp <span class="token parameter variable">-d</span><span class="token variable">)</span></span>&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    gpg <span class="token parameter variable">-q</span> <span class="token parameter variable">--batch</span> <span class="token parameter variable">--import</span> /tmp/KEYS <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    gpg <span class="token parameter variable">-q</span> <span class="token parameter variable">--batch</span> --no-auto-key-retrieve <span class="token parameter variable">--verify</span> /tmp/zk.tgz.asc /tmp/zk.tgz <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token comment">#</span>
    <span class="token comment"># Set up directories</span>
    <span class="token comment">#</span>
    <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /zookeeper/data /zookeeper/wal /zookeeper/log <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token comment">#</span>
    <span class="token comment"># Install</span>
    <span class="token function">tar</span> <span class="token parameter variable">-x</span> <span class="token parameter variable">-C</span> /zookeeper --strip-components<span class="token operator">=</span><span class="token number">1</span> --no-same-owner <span class="token parameter variable">-f</span> /tmp/zk.tgz <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token comment">#</span>
    <span class="token comment"># Slim down</span>
    <span class="token builtin class-name">cd</span> /zookeeper <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">cp</span> dist-maven/zookeeper-<span class="token variable">${ZK_VERSION}</span>.jar <span class="token builtin class-name">.</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token punctuation">\</span>
      *.txt <span class="token punctuation">\</span>
      *.xml <span class="token punctuation">\</span>
      bin/README.txt <span class="token punctuation">\</span>
      bin/*.cmd <span class="token punctuation">\</span>
      conf/* <span class="token punctuation">\</span>
      contrib <span class="token punctuation">\</span>
      dist-maven <span class="token punctuation">\</span>
      docs <span class="token punctuation">\</span>
      lib/*.txt <span class="token punctuation">\</span>
      lib/cobertura <span class="token punctuation">\</span>
      lib/jdiff <span class="token punctuation">\</span>
      recipes <span class="token punctuation">\</span>
      src <span class="token punctuation">\</span>
      zookeeper-*.asc <span class="token punctuation">\</span>
      zookeeper-*.md5 <span class="token punctuation">\</span>
      zookeeper-*.sha1 <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token comment">#</span>
    <span class="token comment"># Clean up</span>
    apk del .build-deps <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /tmp/* <span class="token string">&quot;<span class="token variable">$GNUPGHOME</span>&quot;</span>

COPY conf /zookeeper/conf/
COPY bin/zkReady.sh /zookeeper/bin/
COPY entrypoint.sh /

ENV <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/zookeeper/bin:<span class="token variable">${<span class="token environment constant">PATH</span>}</span> <span class="token punctuation">\</span>
    <span class="token assign-left variable">ZOO_LOG_DIR</span><span class="token operator">=</span>/zookeeper/log <span class="token punctuation">\</span>
    <span class="token assign-left variable">ZOO_LOG4J_PROP</span><span class="token operator">=</span><span class="token string">&quot;INFO, CONSOLE, ROLLINGFILE&quot;</span> <span class="token punctuation">\</span>
    <span class="token assign-left variable">JMXPORT</span><span class="token operator">=</span><span class="token number">9010</span>

ENTRYPOINT <span class="token punctuation">[</span> <span class="token string">&quot;/entrypoint.sh&quot;</span> <span class="token punctuation">]</span>

CMD <span class="token punctuation">[</span> <span class="token string">&quot;zkServer.sh&quot;</span>, <span class="token string">&quot;start-foreground&quot;</span> <span class="token punctuation">]</span>

EXPOSE <span class="token number">2181</span> <span class="token number">2888</span> <span class="token number">3888</span> <span class="token number">9010</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">echo</span> <span class="token variable">${MYID<span class="token operator">:-</span>1}</span> <span class="token operator">&gt;</span> /zookeeper/data/myid

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$SERVERS</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token punctuation">\</span>, <span class="token builtin class-name">read</span> <span class="token parameter variable">-a</span> servers <span class="token operator">&lt;&lt;&lt;</span><span class="token string">&quot;<span class="token variable">$SERVERS</span>&quot;</span>
	<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token string">&quot;<span class="token variable">${<span class="token operator">!</span>servers<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">do</span> 
		<span class="token builtin class-name">printf</span> <span class="token string">&quot;<span class="token entity" title="\n">\n</span>server.%i=%s:2888:3888&quot;</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$((</span><span class="token number">1</span> <span class="token operator">+</span> $i<span class="token variable">))</span></span>&quot;</span> <span class="token string">&quot;<span class="token variable">${servers<span class="token punctuation">[</span>$i<span class="token punctuation">]</span>}</span>&quot;</span> <span class="token operator">&gt;&gt;</span> /zookeeper/conf/zoo.cfg
	<span class="token keyword">done</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">cd</span> /zookeeper
<span class="token builtin class-name">exec</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>https://mirrors.tuna.tsinghua.edu.cn/alpine/v3.6/main/
https://mirrors.tuna.tsinghua.edu.cn/alpine/v3.6/community/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">TAG</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> harbor.ceamg.com/baseimages/zookeeper:<span class="token variable">${TAG}</span> <span class="token builtin class-name">.</span>
<span class="token function">sleep</span> <span class="token number">1</span>
<span class="token function">docker</span> push  harbor.ceamg.com/baseimages/zookeeper:<span class="token variable">${TAG}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="v45qt"></a></p><h5 id="æµ‹è¯•é•œåƒ" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•é•œåƒ" aria-hidden="true">#</a> æµ‹è¯•é•œåƒ</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@harbor01:~/zookeeper<span class="token comment"># docker run -it --rm -p 2181:2181 harbor.ceamg.com/baseimages/zookeeper:2023-1-12_10_58_34</span>
ZooKeeper JMX enabled by default
ZooKeeper remote JMX Port <span class="token builtin class-name">set</span> to <span class="token number">9010</span>
ZooKeeper remote JMX authenticate <span class="token builtin class-name">set</span> to <span class="token boolean">false</span>
ZooKeeper remote JMX ssl <span class="token builtin class-name">set</span> to <span class="token boolean">false</span>
ZooKeeper remote JMX log4j <span class="token builtin class-name">set</span> to <span class="token boolean">true</span>
Using config: /zookeeper/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
<span class="token number">2023</span>-01-12 03:07:17,632 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:QuorumPeerConfig@136<span class="token punctuation">]</span> - Reading configuration from: /zookeeper/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
<span class="token number">2023</span>-01-12 03:07:17,638 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:DatadirCleanupManager@78<span class="token punctuation">]</span> - autopurge.snapRetainCount <span class="token builtin class-name">set</span> to <span class="token number">3</span>
<span class="token number">2023</span>-01-12 03:07:17,638 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:DatadirCleanupManager@79<span class="token punctuation">]</span> - autopurge.purgeInterval <span class="token builtin class-name">set</span> to <span class="token number">1</span>
<span class="token number">2023</span>-01-12 03:07:17,640 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - WARN  <span class="token punctuation">[</span>main:QuorumPeerMain@116<span class="token punctuation">]</span> - Either no config or no quorum defined <span class="token keyword">in</span> config, running  <span class="token keyword">in</span> standalone mode
<span class="token number">2023</span>-01-12 03:07:17,640 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>PurgeTask:DatadirCleanupManager<span class="token variable">$PurgeTask</span>@138<span class="token punctuation">]</span> - Purge task started.
<span class="token number">2023</span>-01-12 03:07:17,641 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:QuorumPeerConfig@136<span class="token punctuation">]</span> - Reading configuration from: /zookeeper/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
<span class="token number">2023</span>-01-12 03:07:17,642 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:ZooKeeperServerMain@98<span class="token punctuation">]</span> - Starting server
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token number">2023</span>-01-12 03:07:17,654 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>PurgeTask:DatadirCleanupManager<span class="token variable">$PurgeTask</span>@144<span class="token punctuation">]</span> - Purge task completed.
<span class="token number">2023</span>-01-12 03:07:17,654 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:Environment@100<span class="token punctuation">]</span> - Server environment:user.dir<span class="token operator">=</span>/zookeeper
<span class="token number">2023</span>-01-12 03:07:17,657 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:ZooKeeperServer@836<span class="token punctuation">]</span> - tickTime <span class="token builtin class-name">set</span> to <span class="token number">2000</span>
<span class="token number">2023</span>-01-12 03:07:17,657 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:ZooKeeperServer@845<span class="token punctuation">]</span> - minSessionTimeout <span class="token builtin class-name">set</span> to <span class="token parameter variable">-1</span>
<span class="token number">2023</span>-01-12 03:07:17,658 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:ZooKeeperServer@854<span class="token punctuation">]</span> - maxSessionTimeout <span class="token builtin class-name">set</span> to <span class="token parameter variable">-1</span>
<span class="token number">2023</span>-01-12 03:07:17,666 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:ServerCnxnFactory@117<span class="token punctuation">]</span> - Using org.apache.zookeeper.server.NIOServerCnxnFactory as server connection factory
<span class="token number">2023</span>-01-12 03:07:17,671 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:NIOServerCnxnFactory@89<span class="token punctuation">]</span> - binding to port <span class="token number">0.0</span>.0.0/0.0.0.0:2181
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="ThYAY"></a></p><h5 id="k8s-è¿è¡ŒzookeeperæœåŠ¡" tabindex="-1"><a class="header-anchor" href="#k8s-è¿è¡ŒzookeeperæœåŠ¡" aria-hidden="true">#</a> k8s è¿è¡ŒzookeeperæœåŠ¡</h5><p><a name="nGOsI"></a></p><h5 id="é€šè¿‡yamlæ–‡ä»¶å°†zookeeperé›†ç¾¤æœåŠ¡è¿è¡Œk8sç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡yamlæ–‡ä»¶å°†zookeeperé›†ç¾¤æœåŠ¡è¿è¡Œk8sç¯å¢ƒ" aria-hidden="true">#</a> é€šè¿‡yamlâ½‚ä»¶å°†zookeeperé›†ç¾¤æœåŠ¡è¿â¾k8sç¯å¢ƒ <br><br></h5><p><a name="kiXtn"></a></p><h5 id="ç¼–å†™yamlæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¼–å†™yamlæ–‡ä»¶" aria-hidden="true">#</a> ç¼–å†™yamlæ–‡ä»¶</h5><p><a name="W3Fzv"></a></p><h5 id="nfsæœåŠ¡" tabindex="-1"><a class="header-anchor" href="#nfsæœåŠ¡" aria-hidden="true">#</a> nfsæœåŠ¡</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/exports 
/data/k8s/xinzk *<span class="token punctuation">(</span>rw,sync,no_root_squash<span class="token punctuation">)</span>

root@harbor01:~<span class="token comment"># systemctl start nfs-kernel-server.service</span>


root@harbor01:~<span class="token comment"># showmount -e</span>
Export list <span class="token keyword">for</span> harbor01:
/data/k8s/xinzk *


root@master01:~<span class="token comment"># showmount -e 10.1.0.38</span>
Export list <span class="token keyword">for</span> <span class="token number">10.1</span>.0.38:
/data/k8s/xinzk *


æµ‹è¯•æŒ‚è½½
root@master01:~<span class="token comment"># mount 10.1.0.38:/data/k8s/xinzk /mnt</span>


root@harbor01:/data/k8s/xinzk<span class="token comment"># mkdir zookeeper-datadir-1</span>
root@harbor01:/data/k8s/xinzk<span class="token comment"># mkdir zookeeper-datadir-2</span>
root@harbor01:/data/k8s/xinzk<span class="token comment"># mkdir zookeeper-datadir-3</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>/data/k8s/xinzk</code>ï¼šæŒ‡ç¤ºè¦å…±äº«çš„ç›®å½•ï¼›â€œ<code>/data/k8s/xinzk</code>â€ç›®å½•éœ€è¦è‡ªå·±åˆ›å»ºã€‚</li><li><code>*</code>ï¼šä»£è¡¨å…è®¸æ‰€æœ‰çš„ç½‘ç»œæ®µè®¿é—®ã€‚</li><li><code>rw</code>ï¼šæŒ‡ç¤ºå…·æœ‰å¯è¯»å†™çš„æƒé™ã€‚</li><li><code>sync</code>ï¼šæŒ‡ç¤ºèµ„æ–™åŒæ­¥å†™å…¥å†…å­˜å’Œç¡¬ç›˜</li><li><code>no_root_squash</code>ï¼šæ˜¯ Ubuntu nfs å®¢æˆ·ç«¯åˆ†äº«ç›®å½•ä½¿ç”¨è€…çš„æƒé™ã€‚</li><li>ä¾‹å¦‚ï¼šå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯ root ç”¨æˆ·ï¼Œé‚£ä¹ˆå¯¹äºè¯¥å…±äº«ç›®å½•è€Œè¨€ï¼Œè¯¥å®¢æˆ·ç«¯å°±å…·æœ‰ root æƒé™ã€‚</li></ul><p><a name="zLFdw"></a></p><h5 id="åˆ›å»ºpv" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºpv" aria-hidden="true">#</a> åˆ›å»ºpv</h5><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pv<span class="token punctuation">-</span><span class="token number">1</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 20Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce 
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 10.1.0.38
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/k8s/xinzk/zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span><span class="token number">1</span> 

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pv<span class="token punctuation">-</span><span class="token number">2</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 20Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 10.1.0.38 
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/k8s/xinzk/zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span><span class="token number">2</span> 

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pv<span class="token punctuation">-</span><span class="token number">3</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 20Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 10.1.0.38
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/k8s/xinzk/zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span><span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/zookeeper<span class="token comment"># kubectl apply -f zookeeper-persistentvolume.yaml </span>
persistentvolume/zookeeper-datadir-pv-1 created
persistentvolume/zookeeper-datadir-pv-2 created
persistentvolume/zookeeper-datadir-pv-3 created

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="fsPn9"></a></p><h5 id="éªŒè¯pv" tabindex="-1"><a class="header-anchor" href="#éªŒè¯pv" aria-hidden="true">#</a> éªŒè¯pv</h5><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>root@master01<span class="token punctuation">:</span>/zookeeper<span class="token comment"># kubectl get pv </span>
NAME                     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>1   20Gi       RWO            Retain           Available                                   101s
zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>2   20Gi       RWO            Retain           Available                                   101s
zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>3   20Gi       RWO            Retain           Available                                   101s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="RXjU5"></a></p><h5 id="åˆ›å»ºpvc" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºpvc" aria-hidden="true">#</a> åˆ›å»ºpvc</h5><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pvc<span class="token punctuation">-</span><span class="token number">1</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> xin<span class="token punctuation">-</span>zk
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">volumeName</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pv<span class="token punctuation">-</span><span class="token number">1</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 10Gi
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pvc<span class="token punctuation">-</span><span class="token number">2</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> xin<span class="token punctuation">-</span>zk
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">volumeName</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pv<span class="token punctuation">-</span><span class="token number">2</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 10Gi
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pvc<span class="token punctuation">-</span><span class="token number">3</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> xin<span class="token punctuation">-</span>zk
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">volumeName</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">-</span>datadir<span class="token punctuation">-</span>pv<span class="token punctuation">-</span><span class="token number">3</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 10Gi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/zookeeper<span class="token comment"># kubectl create ns xin-zk</span>
namespace/xin-zk created
root@master01:/zookeeper<span class="token comment"># kubectl apply -f zookeeper-persistentvolumeclaim.yaml </span>
persistentvolumeclaim/zookeeper-datadir-pvc-1 created
persistentvolumeclaim/zookeeper-datadir-pvc-2 created
persistentvolumeclaim/zookeeper-datadir-pvc-3 created

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="DczvS"></a></p><h5 id="éªŒè¯pvc" tabindex="-1"><a class="header-anchor" href="#éªŒè¯pvc" aria-hidden="true">#</a> éªŒè¯pvc</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/zookeeper<span class="token comment"># kubectl get pvc -n xin-zk</span>
NAME                      STATUS   VOLUME                   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
zookeeper-datadir-pvc-1   Bound    zookeeper-datadir-pv-1   20Gi       RWO                           16s
zookeeper-datadir-pvc-2   Bound    zookeeper-datadir-pv-2   20Gi       RWO                           16s
zookeeper-datadir-pvc-3   Bound    zookeeper-datadir-pv-3   20Gi       RWO                           16s

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="yDhMn"></a></p><h5 id="è¿è¡Œzookeeperé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œzookeeperé›†ç¾¤" aria-hidden="true">#</a> è¿è¡Œzookeeperé›†ç¾¤</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/zookeeper<span class="token comment"># kubectl apply -f zookeeper.yaml </span>
service/zookeeper1 created
service/zookeeper2 created
service/zookeeper3 created
deployment.apps/zookeeper1 created
deployment.apps/zookeeper2 created
deployment.apps/zookeeper3 created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="YOdjQ"></a></p><h5 id="éªŒè¯zookeeperé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#éªŒè¯zookeeperé›†ç¾¤" aria-hidden="true">#</a> éªŒè¯zookeeperé›†ç¾¤</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@master01:/zookeeper<span class="token comment"># kubectl get svc -A</span>
NAMESPACE              NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                                        AGE
default                kubernetes                  ClusterIP   <span class="token number">10.10</span>.0.1       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP                                        8d
kube-system            kube-dns                    NodePort    <span class="token number">10.10</span>.0.2       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">53</span>:65421/UDP,53:65421/TCP,9153:30009/TCP       7d22h
kubernetes-dashboard   dashboard-metrics-scraper   ClusterIP   <span class="token number">10.10</span>.123.158   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8000</span>/TCP                                       7d20h
kubernetes-dashboard   kubernetes-dashboard        NodePort    <span class="token number">10.10</span>.92.205    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>:30010/TCP                                  7d20h
xin-zk                 zookeeper1                  NodePort    <span class="token number">10.10</span>.233.13    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">2181</span>:42181/TCP,2888:44954/TCP,3888:65337/TCP   28s
xin-zk                 zookeeper2                  NodePort    <span class="token number">10.10</span>.101.183   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">2181</span>:42182/TCP,2888:51171/TCP,3888:60008/TCP   27s
xin-zk                 zookeeper3                  NodePort    <span class="token number">10.10</span>.176.183   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">2181</span>:42183/TCP,2888:47408/TCP,3888:39107/TCP   27s


root@master01:/zookeeper<span class="token comment"># kubectl get deployments.apps -A</span>
NAMESPACE              NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
kube-system            calico-kube-controllers     <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           8d
kube-system            coredns                     <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           7d22h
kubernetes-dashboard   dashboard-metrics-scraper   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           7d21h
kubernetes-dashboard   kubernetes-dashboard        <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           7d21h
xin-zk                 zookeeper1                  <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           31m
xin-zk                 zookeeper2                  <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           31m
xin-zk                 zookeeper3                  <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           31m


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://cdn1.ryanxin.live/1673500958747-eff6d385-4fe1-40ed-b37f-7cf55130f909.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="http://cdn1.ryanxin.live/1673501722922-ecbd4d14-94cb-4e72-a577-8cdb28e7450e.png" alt="zookeeperæµ‹è¯•" tabindex="0" loading="lazy"><figcaption>zookeeperæµ‹è¯•</figcaption></figure></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: ryanxin@xx9z@outlook.com">Ryanxin</span>,<!--]--><!--[--><span class="contributor" title="email: xinxincn0506@outlook.com">ryanxin7</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/k8s/log/kubernetes-3.html" class="nav-link prev" aria-label="3. yamlæ–‡ä»¶è¯­æ³•åŸºç¡€"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->3. yamlæ–‡ä»¶è¯­æ³•åŸºç¡€</div></a><a href="/k8s/log/kubernetes-5.html" class="nav-link next" aria-label="5.k8så®æˆ˜æ¡ˆä¾‹-nginxä¸tomcatå®ç°åŠ¨é™åˆ†ç¦»"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">5.k8så®æˆ˜æ¡ˆä¾‹-nginxä¸tomcatå®ç°åŠ¨é™åˆ†ç¦»<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Ryan's Notebook</div><div class="copyright">Copyright Â© 2023 Ryan</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-f755490f.js" defer></script>
  </body>
</html>
